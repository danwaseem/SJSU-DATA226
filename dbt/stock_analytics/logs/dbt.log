[0m02:58:25.403143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e29ad7f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e2857ef60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e28d543e0>]}


============================== 02:58:25.414597 | c350c80f-6d25-46d3-adc8-675a55a7dc48 ==============================
[0m02:58:25.414597 [info ] [MainThread]: Running with dbt=1.8.8
[0m02:58:25.416795 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt clean', 'send_anonymous_usage_stats': 'True'}
[0m02:58:25.735752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c350c80f-6d25-46d3-adc8-675a55a7dc48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e2948c470>]}
[0m02:58:25.769977 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.5378424, "process_user_time": 4.369135, "process_kernel_time": 2.095867, "process_mem_max_rss": "103352", "process_out_blocks": "2195", "process_in_blocks": "0"}
[0m02:58:25.781191 [debug] [MainThread]: Command `dbt clean` succeeded at 02:58:25.780925 after 0.55 seconds
[0m02:58:25.782711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e280fbfb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e281c5580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9e2806bec0>]}
[0m02:58:25.784073 [debug] [MainThread]: Flushing usage events
[0m02:58:30.679116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f06a250a2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f06a1db9d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f06a250b860>]}


============================== 02:58:30.689525 | 0cb53b8d-ae25-45df-b993-242fba95f0fb ==============================
[0m02:58:30.689525 [info ] [MainThread]: Running with dbt=1.8.8
[0m02:58:30.691335 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m02:58:30.949466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0cb53b8d-ae25-45df-b993-242fba95f0fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f06a19a34d0>]}
[0m02:58:30.975215 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m02:58:30.979582 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m02:58:30.982419 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.39390755, "process_user_time": 4.112401, "process_kernel_time": 0.251186, "process_mem_max_rss": "103288", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m02:58:30.987088 [debug] [MainThread]: Command `dbt deps` succeeded at 02:58:30.986029 after 0.40 seconds
[0m02:58:30.988537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f06a1db9d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f06a1850620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f06a20c1eb0>]}
[0m02:58:30.990232 [debug] [MainThread]: Flushing usage events
[0m02:58:35.215293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a168dfec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a16c0daf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a143181a0>]}


============================== 02:58:35.225819 | ab495403-5ae6-4f80-ab2f-e510ea43b284 ==============================
[0m02:58:35.225819 [info ] [MainThread]: Running with dbt=1.8.8
[0m02:58:35.227619 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --target prod --profiles-dir /opt/airflow/dbt', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:58:38.664318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ab495403-5ae6-4f80-ab2f-e510ea43b284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a158c3d70>]}
[0m02:58:38.801306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ab495403-5ae6-4f80-ab2f-e510ea43b284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a14accce0>]}
[0m02:58:38.803070 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m02:58:38.890352 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m02:58:38.896812 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m02:58:38.899410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ab495403-5ae6-4f80-ab2f-e510ea43b284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a0056f110>]}
[0m02:58:44.530303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ab495403-5ae6-4f80-ab2f-e510ea43b284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89fb9258b0>]}
[0m02:58:44.822268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ab495403-5ae6-4f80-ab2f-e510ea43b284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89fbba99d0>]}
[0m02:58:44.823859 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m02:58:44.826085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab495403-5ae6-4f80-ab2f-e510ea43b284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a006e7ad0>]}
[0m02:58:44.831912 [info ] [MainThread]: 
[0m02:58:44.838977 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:58:44.856204 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m02:58:44.896207 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m02:58:44.897959 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m02:58:44.899309 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:45.415225 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.516 seconds
[0m02:58:45.434456 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m02:58:45.552508 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS)
[0m02:58:45.561963 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS'
[0m02:58:45.597518 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m02:58:45.598562 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"
[0m02:58:45.599323 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m02:58:45.600482 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS limit 10000
[0m02:58:45.601829 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:58:45.604413 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:46.216515 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.612 seconds
[0m02:58:46.226921 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: Close
[0m02:58:46.238167 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.636 seconds
[0m02:58:46.250045 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m02:58:46.594006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ab495403-5ae6-4f80-ab2f-e510ea43b284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f89fba80fe0>]}
[0m02:58:46.596070 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m02:58:46.597752 [info ] [MainThread]: 
[0m02:58:46.636431 [debug] [Thread-1 (]: Began running node model.stock_analytics.stg_market_data
[0m02:58:46.639384 [info ] [Thread-1 (]: 1 of 4 START sql view model ANALYTICS_ANALYTICS.stg_market_data ................ [RUN]
[0m02:58:46.642847 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now model.stock_analytics.stg_market_data)
[0m02:58:46.645068 [debug] [Thread-1 (]: Began compiling node model.stock_analytics.stg_market_data
[0m02:58:46.684879 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_analytics.stg_market_data"
[0m02:58:46.699859 [debug] [Thread-1 (]: Began executing node model.stock_analytics.stg_market_data
[0m02:58:46.776877 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_analytics.stg_market_data"
[0m02:58:46.788554 [debug] [Thread-1 (]: Using snowflake connection "model.stock_analytics.stg_market_data"
[0m02:58:46.790918 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.stg_market_data"} */
create or replace   view USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
  
   as (
    -- Staging view over RAW.MARKET_DATA
-- Keep it simple to avoid casting issues: RAW table already has proper types.

with src as (
  select * from USER_DB_HEDGEHOG.RAW.market_data
)

select
  date::date        as date,
  upper(symbol)     as symbol,
  open              as open,
  high              as high,
  low               as low,
  close             as close,
  volume            as volume
from src
  );
[0m02:58:46.795559 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:58:47.401058 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.605 seconds
[0m02:58:47.449703 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: Close
[0m02:58:47.571224 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab495403-5ae6-4f80-ab2f-e510ea43b284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a00720170>]}
[0m02:58:47.573347 [info ] [Thread-1 (]: 1 of 4 OK created sql view model ANALYTICS_ANALYTICS.stg_market_data ........... [[32mSUCCESS 1[0m in 0.93s]
[0m02:58:47.575646 [debug] [Thread-1 (]: Finished running node model.stock_analytics.stg_market_data
[0m02:58:47.579507 [debug] [Thread-3 (]: Began running node model.stock_analytics.dim_calendar
[0m02:58:47.581038 [debug] [Thread-4 (]: Began running node model.stock_analytics.fact_prices
[0m02:58:47.586442 [debug] [Thread-2 (]: Began running node model.stock_analytics.indicators_ma_rsi
[0m02:58:47.589477 [info ] [Thread-3 (]: 2 of 4 START sql table model ANALYTICS_ANALYTICS.dim_calendar .................. [RUN]
[0m02:58:47.593116 [info ] [Thread-4 (]: 3 of 4 START sql table model ANALYTICS_ANALYTICS.fact_prices ................... [RUN]
[0m02:58:47.597093 [info ] [Thread-2 (]: 4 of 4 START sql table model ANALYTICS_ANALYTICS.indicators_ma_rsi ............. [RUN]
[0m02:58:47.601117 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.stock_analytics.dim_calendar'
[0m02:58:47.602887 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.stock_analytics.fact_prices'
[0m02:58:47.604628 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS, now model.stock_analytics.indicators_ma_rsi)
[0m02:58:47.606479 [debug] [Thread-3 (]: Began compiling node model.stock_analytics.dim_calendar
[0m02:58:47.610942 [debug] [Thread-4 (]: Began compiling node model.stock_analytics.fact_prices
[0m02:58:47.613237 [debug] [Thread-2 (]: Began compiling node model.stock_analytics.indicators_ma_rsi
[0m02:58:47.623216 [debug] [Thread-3 (]: Writing injected SQL for node "model.stock_analytics.dim_calendar"
[0m02:58:47.635390 [debug] [Thread-4 (]: Writing injected SQL for node "model.stock_analytics.fact_prices"
[0m02:58:47.648210 [debug] [Thread-2 (]: Writing injected SQL for node "model.stock_analytics.indicators_ma_rsi"
[0m02:58:47.656533 [debug] [Thread-3 (]: Began executing node model.stock_analytics.dim_calendar
[0m02:58:47.664726 [debug] [Thread-2 (]: Began executing node model.stock_analytics.indicators_ma_rsi
[0m02:58:47.761755 [debug] [Thread-4 (]: Began executing node model.stock_analytics.fact_prices
[0m02:58:47.829805 [debug] [Thread-3 (]: Writing runtime sql for node "model.stock_analytics.dim_calendar"
[0m02:58:47.831316 [debug] [Thread-2 (]: Writing runtime sql for node "model.stock_analytics.indicators_ma_rsi"
[0m02:58:47.837316 [debug] [Thread-4 (]: Writing runtime sql for node "model.stock_analytics.fact_prices"
[0m02:58:47.849701 [debug] [Thread-3 (]: Using snowflake connection "model.stock_analytics.dim_calendar"
[0m02:58:47.851175 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.dim_calendar"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.dim_calendar
         as
        (-- Simple calendar table covering ~2 years from the min date in staging data.

with bounds as (
  select
    min(date) as min_date
  from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
),
base as (
  select
    dateadd(day, seq4(), min_date) as date
  from bounds,
       table(generator(rowcount => 730)) -- 2 years
)

select
  date,
  year(date)              as year,
  month(date)             as month,
  day(date)               as day_of_month,
  dayname(date)           as day_name,
  week(date)              as week_of_year,
  to_char(date, 'YYYY-MM-DD') as date_key
from base
        );
[0m02:58:47.856800 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:58:47.855448 [debug] [Thread-4 (]: Using snowflake connection "model.stock_analytics.fact_prices"
[0m02:58:47.861093 [debug] [Thread-2 (]: Using snowflake connection "model.stock_analytics.indicators_ma_rsi"
[0m02:58:47.863016 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.fact_prices"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.fact_prices
         as
        (-- Fact table: daily prices per symbol.

select
  m.date,
  m.symbol,
  m.open,
  m.high,
  m.low,
  m.close,
  m.volume
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data m
        );
[0m02:58:47.868065 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.indicators_ma_rsi"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.indicators_ma_rsi
         as
        (-- Indicators: Moving Averages and RSI (14-day)
--
-- This is used for the BI dashboard (Lab 2 requirement).

with src as (
  select * from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
),
ma as (
  select
    date,
    symbol,
    close,
    avg(close) over (
      partition by symbol
      order by date
      rows between 6 preceding and current row
    ) as ma_7,
    avg(close) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as ma_14,
    avg(close) over (
      partition by symbol
      order by date
      rows between 29 preceding and current row
    ) as ma_30,
    lag(close) over (
      partition by symbol
      order by date
    ) as prev_close
  from src
),
gains_losses as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    iff(prev_close is null, null, greatest(close - prev_close, 0)) as gain,
    iff(prev_close is null, null, greatest(prev_close - close, 0)) as loss
  from ma
),
rsi_window as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    avg(gain) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_gain_14,
    avg(loss) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_loss_14
  from gains_losses
)

select
  date,
  symbol,
  close,
  ma_7,
  ma_14,
  ma_30,
  case
    when avg_loss_14 is null or avg_loss_14 = 0 then null
    else 100 - (100 / (1 + (avg_gain_14 / avg_loss_14)))
  end as rsi_14
from rsi_window
        );
[0m02:58:47.870650 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:58:47.872235 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:58:49.693385 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.837 seconds
[0m02:58:49.695625 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.825 seconds
[0m02:58:49.702373 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: Close
[0m02:58:49.704509 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.832 seconds
[0m02:58:49.710085 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: Close
[0m02:58:49.727179 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: Close
[0m02:58:49.850624 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab495403-5ae6-4f80-ab2f-e510ea43b284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a004a6060>]}
[0m02:58:49.853249 [info ] [Thread-3 (]: 2 of 4 OK created sql table model ANALYTICS_ANALYTICS.dim_calendar ............. [[32mSUCCESS 1[0m in 2.25s]
[0m02:58:49.856618 [debug] [Thread-3 (]: Finished running node model.stock_analytics.dim_calendar
[0m02:58:49.861968 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab495403-5ae6-4f80-ab2f-e510ea43b284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a003c8140>]}
[0m02:58:49.869514 [info ] [Thread-2 (]: 4 of 4 OK created sql table model ANALYTICS_ANALYTICS.indicators_ma_rsi ........ [[32mSUCCESS 1[0m in 2.26s]
[0m02:58:49.871564 [debug] [Thread-2 (]: Finished running node model.stock_analytics.indicators_ma_rsi
[0m02:58:50.142705 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ab495403-5ae6-4f80-ab2f-e510ea43b284', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a004d1a00>]}
[0m02:58:50.145263 [info ] [Thread-4 (]: 3 of 4 OK created sql table model ANALYTICS_ANALYTICS.fact_prices .............. [[32mSUCCESS 1[0m in 2.54s]
[0m02:58:50.148281 [debug] [Thread-4 (]: Finished running node model.stock_analytics.fact_prices
[0m02:58:50.153940 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:58:50.157205 [debug] [MainThread]: Connection 'model.stock_analytics.stg_market_data' was properly closed.
[0m02:58:50.160252 [debug] [MainThread]: Connection 'model.stock_analytics.indicators_ma_rsi' was properly closed.
[0m02:58:50.163680 [debug] [MainThread]: Connection 'model.stock_analytics.dim_calendar' was properly closed.
[0m02:58:50.165191 [debug] [MainThread]: Connection 'model.stock_analytics.fact_prices' was properly closed.
[0m02:58:50.166514 [info ] [MainThread]: 
[0m02:58:50.167829 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 5.33 seconds (5.33s).
[0m02:58:50.173094 [debug] [MainThread]: Command end result
[0m02:58:50.313444 [info ] [MainThread]: 
[0m02:58:50.316792 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:58:50.320280 [info ] [MainThread]: 
[0m02:58:50.331048 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m02:58:50.336920 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 15.209159, "process_user_time": 12.56215, "process_kernel_time": 2.398879, "process_mem_max_rss": "226180", "process_out_blocks": "2866", "process_in_blocks": "0"}
[0m02:58:50.340165 [debug] [MainThread]: Command `dbt run` succeeded at 02:58:50.339839 after 15.21 seconds
[0m02:58:50.342539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a168dfec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a15231e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8a18217110>]}
[0m02:58:50.344125 [debug] [MainThread]: Flushing usage events
[0m02:58:55.401071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d0416efc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d04c6afc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d04b17350>]}


============================== 02:58:55.411355 | 2372fe46-0552-4a66-8513-c452da2a2fc1 ==============================
[0m02:58:55.411355 [info ] [MainThread]: Running with dbt=1.8.8
[0m02:58:55.413169 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --target prod --profiles-dir /opt/airflow/dbt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:58:57.130566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2372fe46-0552-4a66-8513-c452da2a2fc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d054bfbc0>]}
[0m02:58:57.223071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2372fe46-0552-4a66-8513-c452da2a2fc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1cf2224bf0>]}
[0m02:58:57.224633 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m02:58:57.253943 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m02:58:57.548340 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:58:57.549395 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:58:57.674814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2372fe46-0552-4a66-8513-c452da2a2fc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1cebf28470>]}
[0m02:58:57.912942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2372fe46-0552-4a66-8513-c452da2a2fc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1cebe85850>]}
[0m02:58:57.914091 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m02:58:57.915425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2372fe46-0552-4a66-8513-c452da2a2fc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d0401e000>]}
[0m02:58:57.920822 [info ] [MainThread]: 
[0m02:58:57.926893 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:58:57.931196 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m02:58:57.973893 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m02:58:57.974999 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m02:58:57.975988 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:58.474500 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.498 seconds
[0m02:58:58.479765 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m02:58:58.608645 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS)
[0m02:58:58.618528 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS'
[0m02:58:58.645640 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m02:58:58.651367 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"
[0m02:58:58.652250 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m02:58:58.653406 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS limit 10000
[0m02:58:58.654851 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:58:58.655970 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:58:59.119012 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.464 seconds
[0m02:58:59.123192 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m02:58:59.139923 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.484 seconds
[0m02:58:59.143315 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: Close
[0m02:58:59.294565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2372fe46-0552-4a66-8513-c452da2a2fc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d03bfa960>]}
[0m02:58:59.296378 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m02:58:59.298075 [info ] [MainThread]: 
[0m02:58:59.325764 [debug] [Thread-1 (]: Began running node snapshot.stock_analytics.snap_market_data
[0m02:58:59.332254 [info ] [Thread-1 (]: 1 of 1 START snapshot ANALYTICS.snap_market_data ............................... [RUN]
[0m02:58:59.336195 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now snapshot.stock_analytics.snap_market_data)
[0m02:58:59.338073 [debug] [Thread-1 (]: Began compiling node snapshot.stock_analytics.snap_market_data
[0m02:58:59.379492 [debug] [Thread-1 (]: Began executing node snapshot.stock_analytics.snap_market_data
[0m02:58:59.538494 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m02:58:59.540163 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        select close, volume from (
                



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m02:58:59.541426 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:59:00.060706 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.519 seconds
[0m02:59:00.086969 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m02:59:00.089348 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m02:59:00.186136 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.094 seconds
[0m02:59:00.204426 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m02:59:00.205777 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m02:59:00.296896 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.090 seconds
[0m02:59:00.375489 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m02:59:00.377637 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
create or replace temporary table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
         as
        (

    with snapshot_query as (

        



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data


    ),

    snapshotted_data as (

        select *,
            snapshot_key as dbt_unique_key

        from "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(snapshot_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m02:59:00.545897 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01c09e53-0307-1f66-000f-c0df00959e96
[0m02:59:00.547586 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 26 at position 12
invalid identifier 'SNAPSHOT_KEY'
[0m02:59:00.549163 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: Close
[0m02:59:00.693400 [debug] [Thread-1 (]: Database Error in snapshot snap_market_data (snapshots/snap_market_data.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'SNAPSHOT_KEY'
[0m02:59:00.696861 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2372fe46-0552-4a66-8513-c452da2a2fc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1ceb344f80>]}
[0m02:59:00.699251 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting ANALYTICS.snap_market_data ........................... [[31mERROR[0m in 1.36s]
[0m02:59:00.701875 [debug] [Thread-1 (]: Finished running node snapshot.stock_analytics.snap_market_data
[0m02:59:00.714083 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:59:00.715473 [debug] [MainThread]: Connection 'snapshot.stock_analytics.snap_market_data' was properly closed.
[0m02:59:00.717322 [debug] [MainThread]: Connection 'list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS' was properly closed.
[0m02:59:00.719108 [info ] [MainThread]: 
[0m02:59:00.721690 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.79 seconds (2.79s).
[0m02:59:00.725396 [debug] [MainThread]: Command end result
[0m02:59:00.864392 [info ] [MainThread]: 
[0m02:59:00.868117 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m02:59:00.870905 [info ] [MainThread]: 
[0m02:59:00.875089 [error] [MainThread]:   Database Error in snapshot snap_market_data (snapshots/snap_market_data.sql)
  000904 (42000): SQL compilation error: error line 26 at position 12
  invalid identifier 'SNAPSHOT_KEY'
[0m02:59:00.878601 [info ] [MainThread]: 
[0m02:59:00.887305 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m02:59:00.902938 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 5.590343, "process_user_time": 7.057751, "process_kernel_time": 0.876417, "process_mem_max_rss": "219100", "process_out_blocks": "1909", "command_success": false, "process_in_blocks": "0"}
[0m02:59:00.924047 [debug] [MainThread]: Command `dbt snapshot` failed at 02:59:00.921495 after 5.61 seconds
[0m02:59:00.931970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d0416efc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d04b17350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1d053ec380>]}
[0m02:59:00.933438 [debug] [MainThread]: Flushing usage events
[0m02:59:05.582642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff2856aea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff2872b590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff28569d00>]}


============================== 02:59:05.598324 | 21db752a-2705-487a-a988-7006610089c6 ==============================
[0m02:59:05.598324 [info ] [MainThread]: Running with dbt=1.8.8
[0m02:59:05.602168 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt test --target prod --profiles-dir /opt/airflow/dbt', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m02:59:07.713108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '21db752a-2705-487a-a988-7006610089c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff28e55f10>]}
[0m02:59:07.815126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '21db752a-2705-487a-a988-7006610089c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff14dd1250>]}
[0m02:59:07.816924 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m02:59:07.852315 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m02:59:08.539234 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m02:59:08.553477 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m02:59:08.678051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '21db752a-2705-487a-a988-7006610089c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff14339ca0>]}
[0m02:59:09.251786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '21db752a-2705-487a-a988-7006610089c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff0fca0170>]}
[0m02:59:09.254865 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m02:59:09.257036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '21db752a-2705-487a-a988-7006610089c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff0fda6d50>]}
[0m02:59:09.280916 [info ] [MainThread]: 
[0m02:59:09.284794 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m02:59:09.320903 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m02:59:09.333285 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS'
[0m02:59:09.475842 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m02:59:09.478748 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"
[0m02:59:09.480168 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m02:59:09.482315 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS limit 10000
[0m02:59:09.484039 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:59:09.485849 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:59:10.380983 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.895 seconds
[0m02:59:10.387453 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: Close
[0m02:59:10.395524 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.911 seconds
[0m02:59:10.399352 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m02:59:10.513515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '21db752a-2705-487a-a988-7006610089c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff0ff4a480>]}
[0m02:59:10.516076 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m02:59:10.517539 [info ] [MainThread]: 
[0m02:59:10.552472 [debug] [Thread-1 (]: Began running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m02:59:10.558995 [debug] [Thread-2 (]: Began running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m02:59:10.561219 [debug] [Thread-3 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m02:59:10.565239 [debug] [Thread-4 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m02:59:10.563194 [info ] [Thread-1 (]: 1 of 7 START test not_null_fact_prices_date .................................... [RUN]
[0m02:59:10.569235 [info ] [Thread-2 (]: 2 of 7 START test not_null_fact_prices_symbol .................................. [RUN]
[0m02:59:10.571157 [info ] [Thread-3 (]: 3 of 7 START test not_null_indicators_ma_rsi_date .............................. [RUN]
[0m02:59:10.583860 [info ] [Thread-4 (]: 4 of 7 START test not_null_indicators_ma_rsi_symbol ............................ [RUN]
[0m02:59:10.590246 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5)
[0m02:59:10.592273 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS, now test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1)
[0m02:59:10.600041 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207'
[0m02:59:10.602240 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94'
[0m02:59:10.604544 [debug] [Thread-1 (]: Began compiling node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m02:59:10.606809 [debug] [Thread-2 (]: Began compiling node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m02:59:10.608142 [debug] [Thread-3 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m02:59:10.613424 [debug] [Thread-4 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m02:59:10.708397 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m02:59:10.705286 [debug] [Thread-3 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m02:59:10.711403 [debug] [Thread-2 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m02:59:10.721481 [debug] [Thread-4 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m02:59:10.727916 [debug] [Thread-3 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m02:59:10.736040 [debug] [Thread-4 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m02:59:10.776757 [debug] [Thread-1 (]: Began executing node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m02:59:10.808927 [debug] [Thread-2 (]: Began executing node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m02:59:10.821237 [debug] [Thread-3 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m02:59:10.822753 [debug] [Thread-4 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m02:59:10.830834 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m02:59:10.836319 [debug] [Thread-2 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m02:59:10.843816 [debug] [Thread-3 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m02:59:10.845652 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.indicators_ma_rsi
where date is null



      
    ) dbt_internal_test
[0m02:59:10.847214 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m02:59:10.852419 [debug] [Thread-4 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m02:59:10.854231 [debug] [Thread-2 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m02:59:10.856815 [debug] [Thread-1 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m02:59:10.858712 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.indicators_ma_rsi
where symbol is null



      
    ) dbt_internal_test
[0m02:59:10.860906 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.fact_prices
where symbol is null



      
    ) dbt_internal_test
[0m02:59:10.863050 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.fact_prices
where date is null



      
    ) dbt_internal_test
[0m02:59:10.865830 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m02:59:10.868531 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:59:10.870483 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:59:11.708046 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.840 seconds
[0m02:59:11.730801 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.865 seconds
[0m02:59:11.734111 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.887 seconds
[0m02:59:11.736386 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.866 seconds
[0m02:59:11.780876 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: Close
[0m02:59:11.784608 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: Close
[0m02:59:11.786291 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: Close
[0m02:59:11.791203 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: Close
[0m02:59:11.946147 [info ] [Thread-2 (]: 2 of 7 PASS not_null_fact_prices_symbol ........................................ [[32mPASS[0m in 1.35s]
[0m02:59:11.954924 [debug] [Thread-2 (]: Finished running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m02:59:11.973383 [info ] [Thread-4 (]: 4 of 7 PASS not_null_indicators_ma_rsi_symbol .................................. [[32mPASS[0m in 1.36s]
[0m02:59:12.058638 [info ] [Thread-3 (]: 3 of 7 PASS not_null_indicators_ma_rsi_date .................................... [[32mPASS[0m in 1.44s]
[0m02:59:12.168979 [debug] [Thread-2 (]: Began running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m02:59:12.166747 [info ] [Thread-1 (]: 1 of 7 PASS not_null_fact_prices_date .......................................... [[32mPASS[0m in 1.54s]
[0m02:59:12.164095 [debug] [Thread-4 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m02:59:12.236827 [debug] [Thread-4 (]: Began running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m02:59:12.238742 [info ] [Thread-4 (]: 6 of 7 START test not_null_stg_market_data_date ................................ [RUN]
[0m02:59:12.210304 [debug] [Thread-1 (]: Finished running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m02:59:12.270929 [debug] [Thread-1 (]: Began running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m02:59:12.189488 [info ] [Thread-2 (]: 5 of 7 START test not_null_snap_market_data_snapshot_key ....................... [RUN]
[0m02:59:12.259102 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94, now test.stock_analytics.not_null_stg_market_data_date.fb73c94489)
[0m02:59:12.282876 [debug] [Thread-4 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m02:59:12.277764 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1, now test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0)
[0m02:59:12.275068 [info ] [Thread-1 (]: 7 of 7 START test not_null_stg_market_data_symbol .............................. [RUN]
[0m02:59:12.172444 [debug] [Thread-3 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m02:59:12.302231 [debug] [Thread-2 (]: Began compiling node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m02:59:12.312091 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5, now test.stock_analytics.not_null_stg_market_data_symbol.478198cf66)
[0m02:59:12.332421 [debug] [Thread-1 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m02:59:12.330890 [debug] [Thread-2 (]: Writing injected SQL for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m02:59:12.315865 [debug] [Thread-4 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m02:59:12.347992 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m02:59:12.356229 [debug] [Thread-4 (]: Began executing node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m02:59:12.367374 [debug] [Thread-1 (]: Began executing node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m02:59:12.364777 [debug] [Thread-2 (]: Began executing node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m02:59:12.389057 [debug] [Thread-4 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m02:59:12.400532 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m02:59:12.411755 [debug] [Thread-2 (]: Writing runtime sql for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m02:59:12.437659 [debug] [Thread-4 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m02:59:12.444047 [debug] [Thread-4 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
where date is null



      
    ) dbt_internal_test
[0m02:59:12.469314 [debug] [Thread-1 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m02:59:12.472182 [debug] [Thread-2 (]: Using snowflake connection "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m02:59:12.474347 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m02:59:12.478265 [debug] [Thread-1 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
where symbol is null



      
    ) dbt_internal_test
[0m02:59:12.481102 [debug] [Thread-2 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select snapshot_key
from USER_DB_HEDGEHOG.ANALYTICS.snap_market_data
where snapshot_key is null



      
    ) dbt_internal_test
[0m02:59:12.486076 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:59:12.489786 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m02:59:13.043429 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01c09e53-0307-1f0e-000f-c0df0095b962
[0m02:59:13.044761 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 12 at position 7
invalid identifier 'SNAPSHOT_KEY'
[0m02:59:13.046123 [debug] [Thread-2 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: Close
[0m02:59:13.126208 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.640 seconds
[0m02:59:13.134939 [debug] [Thread-1 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: Close
[0m02:59:13.159063 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.685 seconds
[0m02:59:13.186884 [debug] [Thread-2 (]: Database Error in test not_null_snap_market_data_snapshot_key (models/schema.yml)
  000904 (42000): SQL compilation error: error line 12 at position 7
  invalid identifier 'SNAPSHOT_KEY'
  compiled code at target/run/stock_analytics/models/schema.yml/not_null_snap_market_data_snapshot_key.sql
[0m02:59:13.188739 [debug] [Thread-4 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: Close
[0m02:59:13.190934 [error] [Thread-2 (]: 5 of 7 ERROR not_null_snap_market_data_snapshot_key ............................ [[31mERROR[0m in 0.91s]
[0m02:59:13.208677 [debug] [Thread-2 (]: Finished running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m02:59:13.282529 [info ] [Thread-1 (]: 7 of 7 PASS not_null_stg_market_data_symbol .................................... [[32mPASS[0m in 0.97s]
[0m02:59:13.286172 [debug] [Thread-1 (]: Finished running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m02:59:13.346612 [info ] [Thread-4 (]: 6 of 7 PASS not_null_stg_market_data_date ...................................... [[32mPASS[0m in 1.09s]
[0m02:59:13.349185 [debug] [Thread-4 (]: Finished running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m02:59:13.381963 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:59:13.394291 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_symbol.478198cf66' was properly closed.
[0m02:59:13.398634 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0' was properly closed.
[0m02:59:13.400724 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207' was properly closed.
[0m02:59:13.402520 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_date.fb73c94489' was properly closed.
[0m02:59:13.404017 [info ] [MainThread]: 
[0m02:59:13.407517 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 4.12 seconds (4.12s).
[0m02:59:13.418677 [debug] [MainThread]: Command end result
[0m02:59:13.590753 [info ] [MainThread]: 
[0m02:59:13.592184 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m02:59:13.593911 [info ] [MainThread]: 
[0m02:59:13.595819 [error] [MainThread]:   Database Error in test not_null_snap_market_data_snapshot_key (models/schema.yml)
  000904 (42000): SQL compilation error: error line 12 at position 7
  invalid identifier 'SNAPSHOT_KEY'
  compiled code at target/run/stock_analytics/models/schema.yml/not_null_snap_market_data_snapshot_key.sql
[0m02:59:13.597279 [info ] [MainThread]: 
[0m02:59:13.604386 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m02:59:13.608071 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 8.178276, "process_user_time": 8.959947, "process_kernel_time": 1.329298, "process_mem_max_rss": "222912", "process_out_blocks": "1945", "command_success": false, "process_in_blocks": "0"}
[0m02:59:13.617705 [debug] [MainThread]: Command `dbt test` failed at 02:59:13.617232 after 8.19 seconds
[0m02:59:13.619475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff28b38560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff27f24320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eff2bde7110>]}
[0m02:59:13.621659 [debug] [MainThread]: Flushing usage events
[0m03:03:23.689731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f5a418f20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f5a48d760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f5a453920>]}


============================== 03:03:23.706354 | 01d9d425-ee4b-4525-9ee4-f6c8d900f0fa ==============================
[0m03:03:23.706354 [info ] [MainThread]: Running with dbt=1.8.8
[0m03:03:23.709877 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt clean', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:03:24.122439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01d9d425-ee4b-4525-9ee4-f6c8d900f0fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f5b15f7a0>]}
[0m03:03:24.219814 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.6904743, "process_user_time": 4.461634, "process_kernel_time": 0.480953, "process_mem_max_rss": "103336", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m03:03:24.325953 [debug] [MainThread]: Command `dbt clean` succeeded at 03:03:24.325666 after 0.80 seconds
[0m03:03:24.336385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f5a062b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f5ab9a150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7f597177a0>]}
[0m03:03:24.338854 [debug] [MainThread]: Flushing usage events
[0m03:03:29.392383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eafd29970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eafa05dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eafd2acf0>]}


============================== 03:03:29.402709 | 07c0433d-452c-4f76-ae4e-e8ec2b1ca8ed ==============================
[0m03:03:29.402709 [info ] [MainThread]: Running with dbt=1.8.8
[0m03:03:29.404595 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m03:03:29.626284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07c0433d-452c-4f76-ae4e-e8ec2b1ca8ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eb0213650>]}
[0m03:03:29.649893 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m03:03:29.660571 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m03:03:29.669216 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.37029365, "process_user_time": 4.20986, "process_kernel_time": 0.255017, "process_mem_max_rss": "103548", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m03:03:29.671073 [debug] [MainThread]: Command `dbt deps` succeeded at 03:03:29.670530 after 0.37 seconds
[0m03:03:29.673785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eb01ab740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eafa506e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1eaf503860>]}
[0m03:03:29.675371 [debug] [MainThread]: Flushing usage events
[0m03:03:33.914429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd679a3df70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6797d2180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6797f1d90>]}


============================== 03:03:33.930502 | 84ceacf5-9af2-41d2-8f42-47a7729fc52a ==============================
[0m03:03:33.930502 [info ] [MainThread]: Running with dbt=1.8.8
[0m03:03:33.932894 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --target prod --profiles-dir /opt/airflow/dbt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:03:35.874912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84ceacf5-9af2-41d2-8f42-47a7729fc52a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6656f9e80>]}
[0m03:03:36.056593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '84ceacf5-9af2-41d2-8f42-47a7729fc52a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd666a584a0>]}
[0m03:03:36.058680 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:03:36.133675 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m03:03:36.141301 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m03:03:36.143365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '84ceacf5-9af2-41d2-8f42-47a7729fc52a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd666a5d730>]}
[0m03:03:43.080949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '84ceacf5-9af2-41d2-8f42-47a7729fc52a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6645aff80>]}
[0m03:03:43.405894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '84ceacf5-9af2-41d2-8f42-47a7729fc52a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd664801f40>]}
[0m03:03:43.407711 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m03:03:43.410699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84ceacf5-9af2-41d2-8f42-47a7729fc52a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6647fd370>]}
[0m03:03:43.421651 [info ] [MainThread]: 
[0m03:03:43.441399 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:03:43.467904 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m03:03:43.505792 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m03:03:43.507314 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m03:03:43.509626 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:03:44.096571 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.588 seconds
[0m03:03:44.102140 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m03:03:44.228578 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS)
[0m03:03:44.240851 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m03:03:44.277866 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"
[0m03:03:44.279794 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m03:03:44.280810 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS limit 10000
[0m03:03:44.282784 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m03:03:44.284519 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:03:44.285950 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:03:45.196407 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.912 seconds
[0m03:03:45.203386 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: Close
[0m03:03:45.214333 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.928 seconds
[0m03:03:45.222997 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m03:03:45.431125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84ceacf5-9af2-41d2-8f42-47a7729fc52a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd67a768b30>]}
[0m03:03:45.447124 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m03:03:45.457488 [info ] [MainThread]: 
[0m03:03:45.526954 [debug] [Thread-1 (]: Began running node model.stock_analytics.stg_market_data
[0m03:03:45.531121 [info ] [Thread-1 (]: 1 of 4 START sql view model ANALYTICS_ANALYTICS.stg_market_data ................ [RUN]
[0m03:03:45.535891 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS, now model.stock_analytics.stg_market_data)
[0m03:03:45.538928 [debug] [Thread-1 (]: Began compiling node model.stock_analytics.stg_market_data
[0m03:03:45.580423 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_analytics.stg_market_data"
[0m03:03:45.596322 [debug] [Thread-1 (]: Began executing node model.stock_analytics.stg_market_data
[0m03:03:45.689087 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_analytics.stg_market_data"
[0m03:03:45.697940 [debug] [Thread-1 (]: Using snowflake connection "model.stock_analytics.stg_market_data"
[0m03:03:45.699525 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.stg_market_data"} */
create or replace   view USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
  
   as (
    -- Staging view over RAW.MARKET_DATA
-- Keep it simple to avoid casting issues: RAW table already has proper types.

with src as (
  select * from USER_DB_HEDGEHOG.RAW.market_data
)

select
  date::date        as date,
  upper(symbol)     as symbol,
  open              as open,
  high              as high,
  low               as low,
  close             as close,
  volume            as volume
from src
  );
[0m03:03:45.700990 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:03:46.430134 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.729 seconds
[0m03:03:46.489488 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: Close
[0m03:03:46.607655 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84ceacf5-9af2-41d2-8f42-47a7729fc52a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd665550380>]}
[0m03:03:46.609987 [info ] [Thread-1 (]: 1 of 4 OK created sql view model ANALYTICS_ANALYTICS.stg_market_data ........... [[32mSUCCESS 1[0m in 1.07s]
[0m03:03:46.613059 [debug] [Thread-1 (]: Finished running node model.stock_analytics.stg_market_data
[0m03:03:46.616105 [debug] [Thread-3 (]: Began running node model.stock_analytics.dim_calendar
[0m03:03:46.618036 [debug] [Thread-4 (]: Began running node model.stock_analytics.fact_prices
[0m03:03:46.621303 [info ] [Thread-3 (]: 2 of 4 START sql table model ANALYTICS_ANALYTICS.dim_calendar .................. [RUN]
[0m03:03:46.628028 [debug] [Thread-2 (]: Began running node model.stock_analytics.indicators_ma_rsi
[0m03:03:46.629573 [info ] [Thread-4 (]: 3 of 4 START sql table model ANALYTICS_ANALYTICS.fact_prices ................... [RUN]
[0m03:03:46.635059 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.stock_analytics.dim_calendar'
[0m03:03:46.637506 [info ] [Thread-2 (]: 4 of 4 START sql table model ANALYTICS_ANALYTICS.indicators_ma_rsi ............. [RUN]
[0m03:03:46.640429 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.stock_analytics.fact_prices'
[0m03:03:46.641941 [debug] [Thread-3 (]: Began compiling node model.stock_analytics.dim_calendar
[0m03:03:46.644127 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now model.stock_analytics.indicators_ma_rsi)
[0m03:03:46.647499 [debug] [Thread-4 (]: Began compiling node model.stock_analytics.fact_prices
[0m03:03:46.660820 [debug] [Thread-3 (]: Writing injected SQL for node "model.stock_analytics.dim_calendar"
[0m03:03:46.662261 [debug] [Thread-2 (]: Began compiling node model.stock_analytics.indicators_ma_rsi
[0m03:03:46.671984 [debug] [Thread-4 (]: Writing injected SQL for node "model.stock_analytics.fact_prices"
[0m03:03:46.684952 [debug] [Thread-2 (]: Writing injected SQL for node "model.stock_analytics.indicators_ma_rsi"
[0m03:03:46.691083 [debug] [Thread-3 (]: Began executing node model.stock_analytics.dim_calendar
[0m03:03:46.723534 [debug] [Thread-2 (]: Began executing node model.stock_analytics.indicators_ma_rsi
[0m03:03:46.727462 [debug] [Thread-4 (]: Began executing node model.stock_analytics.fact_prices
[0m03:03:46.840041 [debug] [Thread-2 (]: Writing runtime sql for node "model.stock_analytics.indicators_ma_rsi"
[0m03:03:46.862909 [debug] [Thread-3 (]: Writing runtime sql for node "model.stock_analytics.dim_calendar"
[0m03:03:46.884580 [debug] [Thread-4 (]: Writing runtime sql for node "model.stock_analytics.fact_prices"
[0m03:03:46.893451 [debug] [Thread-2 (]: Using snowflake connection "model.stock_analytics.indicators_ma_rsi"
[0m03:03:46.900070 [debug] [Thread-3 (]: Using snowflake connection "model.stock_analytics.dim_calendar"
[0m03:03:46.901730 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.indicators_ma_rsi"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.indicators_ma_rsi
         as
        (-- Indicators: Moving Averages and RSI (14-day)
--
-- This is used for the BI dashboard (Lab 2 requirement).

with src as (
  select * from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
),
ma as (
  select
    date,
    symbol,
    close,
    avg(close) over (
      partition by symbol
      order by date
      rows between 6 preceding and current row
    ) as ma_7,
    avg(close) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as ma_14,
    avg(close) over (
      partition by symbol
      order by date
      rows between 29 preceding and current row
    ) as ma_30,
    lag(close) over (
      partition by symbol
      order by date
    ) as prev_close
  from src
),
gains_losses as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    iff(prev_close is null, null, greatest(close - prev_close, 0)) as gain,
    iff(prev_close is null, null, greatest(prev_close - close, 0)) as loss
  from ma
),
rsi_window as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    avg(gain) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_gain_14,
    avg(loss) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_loss_14
  from gains_losses
)

select
  date,
  symbol,
  close,
  ma_7,
  ma_14,
  ma_30,
  case
    when avg_loss_14 is null or avg_loss_14 = 0 then null
    else 100 - (100 / (1 + (avg_gain_14 / avg_loss_14)))
  end as rsi_14
from rsi_window
        );
[0m03:03:46.903849 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.dim_calendar"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.dim_calendar
         as
        (-- Simple calendar table covering ~2 years from the min date in staging data.

with bounds as (
  select
    min(date) as min_date
  from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
),
base as (
  select
    dateadd(day, seq4(), min_date) as date
  from bounds,
       table(generator(rowcount => 730)) -- 2 years
)

select
  date,
  year(date)              as year,
  month(date)             as month,
  day(date)               as day_of_month,
  dayname(date)           as day_name,
  week(date)              as week_of_year,
  to_char(date, 'YYYY-MM-DD') as date_key
from base
        );
[0m03:03:46.906046 [debug] [Thread-4 (]: Using snowflake connection "model.stock_analytics.fact_prices"
[0m03:03:46.907504 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:03:46.910677 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m03:03:46.913242 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.fact_prices"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.fact_prices
         as
        (-- Fact table: daily prices per symbol.

select
  m.date,
  m.symbol,
  m.open,
  m.high,
  m.low,
  m.close,
  m.volume
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data m
        );
[0m03:03:46.926013 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m03:03:48.097602 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.172 seconds
[0m03:03:48.107236 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: Close
[0m03:03:48.159740 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.252 seconds
[0m03:03:48.166914 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: Close
[0m03:03:48.239395 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84ceacf5-9af2-41d2-8f42-47a7729fc52a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd66528fce0>]}
[0m03:03:48.242433 [info ] [Thread-4 (]: 3 of 4 OK created sql table model ANALYTICS_ANALYTICS.fact_prices .............. [[32mSUCCESS 1[0m in 1.60s]
[0m03:03:48.246589 [debug] [Thread-4 (]: Finished running node model.stock_analytics.fact_prices
[0m03:03:48.293738 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84ceacf5-9af2-41d2-8f42-47a7729fc52a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6651271d0>]}
[0m03:03:48.296522 [info ] [Thread-2 (]: 4 of 4 OK created sql table model ANALYTICS_ANALYTICS.indicators_ma_rsi ........ [[32mSUCCESS 1[0m in 1.65s]
[0m03:03:48.300229 [debug] [Thread-2 (]: Finished running node model.stock_analytics.indicators_ma_rsi
[0m03:03:49.123613 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.213 seconds
[0m03:03:49.134675 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: Close
[0m03:03:49.258242 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84ceacf5-9af2-41d2-8f42-47a7729fc52a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd6645cd310>]}
[0m03:03:49.261035 [info ] [Thread-3 (]: 2 of 4 OK created sql table model ANALYTICS_ANALYTICS.dim_calendar ............. [[32mSUCCESS 1[0m in 2.63s]
[0m03:03:49.264368 [debug] [Thread-3 (]: Finished running node model.stock_analytics.dim_calendar
[0m03:03:49.271952 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:03:49.278646 [debug] [MainThread]: Connection 'model.stock_analytics.stg_market_data' was properly closed.
[0m03:03:49.280825 [debug] [MainThread]: Connection 'model.stock_analytics.indicators_ma_rsi' was properly closed.
[0m03:03:49.284753 [debug] [MainThread]: Connection 'model.stock_analytics.dim_calendar' was properly closed.
[0m03:03:49.289529 [debug] [MainThread]: Connection 'model.stock_analytics.fact_prices' was properly closed.
[0m03:03:49.295318 [info ] [MainThread]: 
[0m03:03:49.298281 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 5.87 seconds (5.87s).
[0m03:03:49.309349 [debug] [MainThread]: Command end result
[0m03:03:49.458346 [info ] [MainThread]: 
[0m03:03:49.459916 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:03:49.462189 [info ] [MainThread]: 
[0m03:03:49.464640 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m03:03:49.477922 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 15.656514, "process_user_time": 14.402499, "process_kernel_time": 1.077367, "process_mem_max_rss": "226020", "process_out_blocks": "2865", "process_in_blocks": "0"}
[0m03:03:49.479835 [debug] [MainThread]: Command `dbt run` succeeded at 03:03:49.479567 after 15.66 seconds
[0m03:03:49.486109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd679a3df70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd678e79d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd678e78fe0>]}
[0m03:03:49.490773 [debug] [MainThread]: Flushing usage events
[0m03:03:54.975846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2101586b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f210074b650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2100de6de0>]}


============================== 03:03:55.050570 | 09e03c0e-05a5-4108-aef3-17891cf980f2 ==============================
[0m03:03:55.050570 [info ] [MainThread]: Running with dbt=1.8.8
[0m03:03:55.053546 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --target prod --profiles-dir /opt/airflow/dbt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m03:03:57.231333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '09e03c0e-05a5-4108-aef3-17891cf980f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20ecd4bd10>]}
[0m03:03:57.326389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '09e03c0e-05a5-4108-aef3-17891cf980f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21006ffaa0>]}
[0m03:03:57.327951 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:03:57.358795 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m03:03:57.653752 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:03:57.654832 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:03:57.755557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '09e03c0e-05a5-4108-aef3-17891cf980f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2100319970>]}
[0m03:03:57.994440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '09e03c0e-05a5-4108-aef3-17891cf980f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20ec70a690>]}
[0m03:03:57.995816 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m03:03:57.997284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '09e03c0e-05a5-4108-aef3-17891cf980f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20ec94dfa0>]}
[0m03:03:58.003106 [info ] [MainThread]: 
[0m03:03:58.006330 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:03:58.014794 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m03:03:58.057181 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m03:03:58.058318 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m03:03:58.059308 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:03:58.553394 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.494 seconds
[0m03:03:58.558498 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m03:03:58.736962 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS)
[0m03:03:58.739214 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m03:03:58.769201 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"
[0m03:03:58.779272 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS limit 10000
[0m03:03:58.780814 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m03:03:58.781704 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:03:58.782844 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m03:03:58.788694 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:03:59.239397 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.457 seconds
[0m03:03:59.245269 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: Close
[0m03:03:59.261012 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.472 seconds
[0m03:03:59.267361 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m03:03:59.402547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '09e03c0e-05a5-4108-aef3-17891cf980f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20eef9b5f0>]}
[0m03:03:59.405561 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m03:03:59.407666 [info ] [MainThread]: 
[0m03:03:59.456263 [debug] [Thread-1 (]: Began running node snapshot.stock_analytics.snap_market_data
[0m03:03:59.460881 [info ] [Thread-1 (]: 1 of 1 START snapshot ANALYTICS.snap_market_data ............................... [RUN]
[0m03:03:59.465123 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS, now snapshot.stock_analytics.snap_market_data)
[0m03:03:59.467745 [debug] [Thread-1 (]: Began compiling node snapshot.stock_analytics.snap_market_data
[0m03:03:59.507759 [debug] [Thread-1 (]: Began executing node snapshot.stock_analytics.snap_market_data
[0m03:03:59.750737 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:03:59.752192 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
/* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        
    

    select *,
        md5(coalesce(cast(snapshot_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data

    ) sbq



    ) as __dbt_sbq
    where false
    limit 0
[0m03:03:59.753564 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:00.206617 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.453 seconds
[0m03:04:00.215453 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:04:00.216749 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
/* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m03:04:00.299822 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.082 seconds
[0m03:04:00.302802 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.stock_analytics.snap_market_data"
[0m03:04:00.311732 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:04:00.313380 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS.snap_market_data
         as
        (
    

    select *,
        md5(coalesce(cast(snapshot_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
        to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
        nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to
    from (
        



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data

    ) sbq



        );
[0m03:04:00.929832 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.615 seconds
[0m03:04:00.982710 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: Close
[0m03:04:01.123781 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '09e03c0e-05a5-4108-aef3-17891cf980f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20ecae4050>]}
[0m03:04:01.126276 [info ] [Thread-1 (]: 1 of 1 OK snapshotted ANALYTICS.snap_market_data ............................... [[32mSUCCESS 1[0m in 1.66s]
[0m03:04:01.128752 [debug] [Thread-1 (]: Finished running node snapshot.stock_analytics.snap_market_data
[0m03:04:01.143258 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:04:01.146611 [debug] [MainThread]: Connection 'snapshot.stock_analytics.snap_market_data' was properly closed.
[0m03:04:01.148301 [debug] [MainThread]: Connection 'list_USER_DB_HEDGEHOG_ANALYTICS' was properly closed.
[0m03:04:01.161992 [info ] [MainThread]: 
[0m03:04:01.163858 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 3.16 seconds (3.16s).
[0m03:04:01.171093 [debug] [MainThread]: Command end result
[0m03:04:01.294642 [info ] [MainThread]: 
[0m03:04:01.297153 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:04:01.299542 [info ] [MainThread]: 
[0m03:04:01.301449 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m03:04:01.305997 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 6.439796, "process_user_time": 7.128403, "process_kernel_time": 1.322686, "process_mem_max_rss": "217712", "process_out_blocks": "1905", "process_in_blocks": "0"}
[0m03:04:01.311744 [debug] [MainThread]: Command `dbt snapshot` succeeded at 03:04:01.311103 after 6.45 seconds
[0m03:04:01.316056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21031d0530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2100ee58e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20eca7cbc0>]}
[0m03:04:01.318344 [debug] [MainThread]: Flushing usage events
[0m03:04:06.275144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b4ddef7a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b4bad8ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b4bc0e360>]}


============================== 03:04:06.290950 | 39568ef8-a6ca-4ca7-83b6-a833e8ee372a ==============================
[0m03:04:06.290950 [info ] [MainThread]: Running with dbt=1.8.8
[0m03:04:06.293200 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --target prod --profiles-dir /opt/airflow/dbt', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:04:08.305760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '39568ef8-a6ca-4ca7-83b6-a833e8ee372a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b33ca61b0>]}
[0m03:04:08.409159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '39568ef8-a6ca-4ca7-83b6-a833e8ee372a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b4b098e30>]}
[0m03:04:08.410942 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:04:08.444825 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m03:04:08.799554 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:04:08.800606 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:04:08.917119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '39568ef8-a6ca-4ca7-83b6-a833e8ee372a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b33752d80>]}
[0m03:04:09.321879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '39568ef8-a6ca-4ca7-83b6-a833e8ee372a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b336840b0>]}
[0m03:04:09.323524 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m03:04:09.325051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '39568ef8-a6ca-4ca7-83b6-a833e8ee372a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b33c33ec0>]}
[0m03:04:09.332235 [info ] [MainThread]: 
[0m03:04:09.335744 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:04:09.360418 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS'
[0m03:04:09.368446 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m03:04:09.451265 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m03:04:09.447446 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"
[0m03:04:09.453746 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m03:04:09.455317 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS limit 10000
[0m03:04:09.456924 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:04:09.458416 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:04:10.084104 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.626 seconds
[0m03:04:10.090170 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: Close
[0m03:04:10.100201 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.643 seconds
[0m03:04:10.104701 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m03:04:10.225858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '39568ef8-a6ca-4ca7-83b6-a833e8ee372a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b33bfbc20>]}
[0m03:04:10.227533 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m03:04:10.228960 [info ] [MainThread]: 
[0m03:04:10.262308 [debug] [Thread-1 (]: Began running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m03:04:10.264337 [debug] [Thread-2 (]: Began running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m03:04:10.266242 [debug] [Thread-3 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m03:04:10.267645 [info ] [Thread-1 (]: 1 of 7 START test not_null_fact_prices_date .................................... [RUN]
[0m03:04:10.280184 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS, now test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5)
[0m03:04:10.281803 [debug] [Thread-1 (]: Began compiling node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m03:04:10.273864 [debug] [Thread-4 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m03:04:10.275121 [info ] [Thread-2 (]: 2 of 7 START test not_null_fact_prices_symbol .................................. [RUN]
[0m03:04:10.277436 [info ] [Thread-3 (]: 3 of 7 START test not_null_indicators_ma_rsi_date .............................. [RUN]
[0m03:04:10.308946 [info ] [Thread-4 (]: 4 of 7 START test not_null_indicators_ma_rsi_symbol ............................ [RUN]
[0m03:04:10.320194 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1)
[0m03:04:10.344924 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207'
[0m03:04:10.368049 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94'
[0m03:04:10.375209 [debug] [Thread-2 (]: Began compiling node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m03:04:10.381425 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m03:04:10.384148 [debug] [Thread-3 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m03:04:10.386154 [debug] [Thread-4 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m03:04:10.400329 [debug] [Thread-2 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m03:04:10.409539 [debug] [Thread-3 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m03:04:10.419274 [debug] [Thread-4 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m03:04:10.423461 [debug] [Thread-1 (]: Began executing node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m03:04:10.439464 [debug] [Thread-3 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m03:04:10.453443 [debug] [Thread-2 (]: Began executing node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m03:04:10.515323 [debug] [Thread-4 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m03:04:10.551658 [debug] [Thread-2 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m03:04:10.553800 [debug] [Thread-4 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m03:04:10.555347 [debug] [Thread-3 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m03:04:10.561319 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m03:04:10.567799 [debug] [Thread-3 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m03:04:10.569477 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.indicators_ma_rsi
where date is null



      
    ) dbt_internal_test
[0m03:04:10.571089 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m03:04:10.573012 [debug] [Thread-4 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m03:04:10.580558 [debug] [Thread-1 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m03:04:10.583529 [debug] [Thread-2 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m03:04:10.586850 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.indicators_ma_rsi
where symbol is null



      
    ) dbt_internal_test
[0m03:04:10.601118 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m03:04:10.595129 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.fact_prices
where symbol is null



      
    ) dbt_internal_test
[0m03:04:10.591940 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.fact_prices
where date is null



      
    ) dbt_internal_test
[0m03:04:10.609600 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:04:10.613532 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:04:11.264619 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.692 seconds
[0m03:04:11.313125 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: Close
[0m03:04:11.317564 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.708 seconds
[0m03:04:11.319922 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.706 seconds
[0m03:04:11.332343 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.731 seconds
[0m03:04:11.355087 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: Close
[0m03:04:11.416110 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: Close
[0m03:04:11.429290 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: Close
[0m03:04:11.537151 [info ] [Thread-3 (]: 3 of 7 PASS not_null_indicators_ma_rsi_date .................................... [[32mPASS[0m in 1.19s]
[0m03:04:11.543525 [debug] [Thread-3 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m03:04:11.545972 [debug] [Thread-3 (]: Began running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m03:04:11.549526 [info ] [Thread-3 (]: 5 of 7 START test not_null_snap_market_data_snapshot_key ....................... [RUN]
[0m03:04:11.553920 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207, now test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0)
[0m03:04:11.556259 [info ] [Thread-2 (]: 2 of 7 PASS not_null_fact_prices_symbol ........................................ [[32mPASS[0m in 1.24s]
[0m03:04:11.557889 [debug] [Thread-3 (]: Began compiling node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m03:04:11.561101 [debug] [Thread-2 (]: Finished running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m03:04:11.573753 [debug] [Thread-3 (]: Writing injected SQL for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m03:04:11.575157 [debug] [Thread-2 (]: Began running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m03:04:11.577816 [info ] [Thread-2 (]: 6 of 7 START test not_null_stg_market_data_date ................................ [RUN]
[0m03:04:11.580087 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1, now test.stock_analytics.not_null_stg_market_data_date.fb73c94489)
[0m03:04:11.583223 [debug] [Thread-2 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m03:04:11.585884 [debug] [Thread-3 (]: Began executing node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m03:04:11.600286 [debug] [Thread-2 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m03:04:11.610390 [debug] [Thread-3 (]: Writing runtime sql for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m03:04:11.612864 [info ] [Thread-4 (]: 4 of 7 PASS not_null_indicators_ma_rsi_symbol .................................. [[32mPASS[0m in 1.24s]
[0m03:04:11.616792 [debug] [Thread-4 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m03:04:11.619383 [debug] [Thread-4 (]: Began running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m03:04:11.623970 [info ] [Thread-4 (]: 7 of 7 START test not_null_stg_market_data_symbol .............................. [RUN]
[0m03:04:11.626453 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94, now test.stock_analytics.not_null_stg_market_data_symbol.478198cf66)
[0m03:04:11.631330 [info ] [Thread-1 (]: 1 of 7 PASS not_null_fact_prices_date .......................................... [[32mPASS[0m in 1.35s]
[0m03:04:11.634736 [debug] [Thread-2 (]: Began executing node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m03:04:11.635898 [debug] [Thread-4 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m03:04:11.638782 [debug] [Thread-1 (]: Finished running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m03:04:11.641248 [debug] [Thread-3 (]: Using snowflake connection "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m03:04:11.650494 [debug] [Thread-2 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m03:04:11.706368 [debug] [Thread-3 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select snapshot_key
from USER_DB_HEDGEHOG.ANALYTICS.snap_market_data
where snapshot_key is null



      
    ) dbt_internal_test
[0m03:04:11.718612 [debug] [Thread-4 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m03:04:11.723235 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m03:04:11.739736 [debug] [Thread-2 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m03:04:11.761062 [debug] [Thread-4 (]: Began executing node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m03:04:11.768495 [debug] [Thread-2 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
where date is null



      
    ) dbt_internal_test
[0m03:04:11.803219 [debug] [Thread-4 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m03:04:11.804056 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:04:11.816060 [debug] [Thread-4 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m03:04:11.818765 [debug] [Thread-4 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
where symbol is null



      
    ) dbt_internal_test
[0m03:04:11.820854 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m03:04:12.250500 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.446 seconds
[0m03:04:12.255465 [debug] [Thread-2 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: Close
[0m03:04:12.282527 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.462 seconds
[0m03:04:12.286058 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.563 seconds
[0m03:04:12.293017 [debug] [Thread-4 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: Close
[0m03:04:12.299052 [debug] [Thread-3 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: Close
[0m03:04:12.402001 [info ] [Thread-2 (]: 6 of 7 PASS not_null_stg_market_data_date ...................................... [[32mPASS[0m in 0.82s]
[0m03:04:12.404559 [debug] [Thread-2 (]: Finished running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m03:04:12.422138 [info ] [Thread-4 (]: 7 of 7 PASS not_null_stg_market_data_symbol .................................... [[32mPASS[0m in 0.79s]
[0m03:04:12.425268 [info ] [Thread-3 (]: 5 of 7 PASS not_null_snap_market_data_snapshot_key ............................. [[32mPASS[0m in 0.87s]
[0m03:04:12.427830 [debug] [Thread-4 (]: Finished running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m03:04:12.431183 [debug] [Thread-3 (]: Finished running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m03:04:12.446428 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:04:12.450973 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5' was properly closed.
[0m03:04:12.453055 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_date.fb73c94489' was properly closed.
[0m03:04:12.454434 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0' was properly closed.
[0m03:04:12.457775 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_symbol.478198cf66' was properly closed.
[0m03:04:12.459176 [info ] [MainThread]: 
[0m03:04:12.460738 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 3.12 seconds (3.12s).
[0m03:04:12.469506 [debug] [MainThread]: Command end result
[0m03:04:12.582904 [info ] [MainThread]: 
[0m03:04:12.584281 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:04:12.586366 [info ] [MainThread]: 
[0m03:04:12.588406 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m03:04:12.594842 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 6.442953, "process_user_time": 8.483033, "process_kernel_time": 0.927609, "process_mem_max_rss": "221792", "process_out_blocks": "1943", "process_in_blocks": "0"}
[0m03:04:12.602032 [debug] [MainThread]: Command `dbt test` succeeded at 03:04:12.601689 after 6.45 seconds
[0m03:04:12.604223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b4ddef7a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b4e2c87d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4b4c625ac0>]}
[0m03:04:12.606266 [debug] [MainThread]: Flushing usage events
[0m03:38:45.227256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b2db5ffe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b2d88c800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b2d88cf20>]}


============================== 03:38:45.333533 | edd2d884-d4b5-4513-8a98-7b92fa98d2ff ==============================
[0m03:38:45.333533 [info ] [MainThread]: Running with dbt=1.8.8
[0m03:38:45.357312 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m03:38:48.058033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'edd2d884-d4b5-4513-8a98-7b92fa98d2ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b2e1ea570>]}
[0m03:38:48.168537 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m03:38:48.185596 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m03:38:48.195936 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 4.4247684, "process_user_time": 11.742381, "process_kernel_time": 0.831463, "process_mem_max_rss": "169768", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m03:38:48.206077 [debug] [MainThread]: Command `dbt deps` succeeded at 03:38:48.204865 after 4.44 seconds
[0m03:38:48.210069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b2e4e1100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b3138b4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b2e2c06e0>]}
[0m03:38:48.214256 [debug] [MainThread]: Flushing usage events
[0m03:39:21.762915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f922c41e300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f922c41e270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f922c41dcd0>]}


============================== 03:39:21.816964 | b8532786-7f58-4777-9612-197ad4ad2a42 ==============================
[0m03:39:21.816964 [info ] [MainThread]: Running with dbt=1.8.8
[0m03:39:21.824266 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --target prod --profiles-dir /opt/airflow/dbt', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:39:30.050431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8532786-7f58-4777-9612-197ad4ad2a42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9218bfc5f0>]}
[0m03:39:30.560665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8532786-7f58-4777-9612-197ad4ad2a42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f921909a210>]}
[0m03:39:30.567170 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:39:30.683667 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m03:39:32.903240 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:39:32.906314 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:39:33.420849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8532786-7f58-4777-9612-197ad4ad2a42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92189050d0>]}
[0m03:39:34.991451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8532786-7f58-4777-9612-197ad4ad2a42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f922db423c0>]}
[0m03:39:35.000679 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m03:39:35.019197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8532786-7f58-4777-9612-197ad4ad2a42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f921893ed20>]}
[0m03:39:35.045032 [info ] [MainThread]: 
[0m03:39:35.050560 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:39:35.097752 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m03:39:35.303271 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m03:39:35.312460 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m03:39:35.316717 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:39:36.706914 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 1.390 seconds
[0m03:39:36.721317 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m03:39:36.905942 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS)
[0m03:39:36.927186 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m03:39:37.152540 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"
[0m03:39:37.158122 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m03:39:37.162408 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS limit 10000
[0m03:39:37.166892 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m03:39:37.171044 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:39:37.175864 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:39:38.082046 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.911 seconds
[0m03:39:38.097401 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: Close
[0m03:39:38.128352 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.953 seconds
[0m03:39:38.145766 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m03:39:38.336723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8532786-7f58-4777-9612-197ad4ad2a42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f921872b980>]}
[0m03:39:38.345417 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m03:39:38.352671 [info ] [MainThread]: 
[0m03:39:38.427074 [debug] [Thread-1 (]: Began running node model.stock_analytics.stg_market_data
[0m03:39:38.436777 [info ] [Thread-1 (]: 1 of 4 START sql view model ANALYTICS_ANALYTICS.stg_market_data ................ [RUN]
[0m03:39:38.442960 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now model.stock_analytics.stg_market_data)
[0m03:39:38.447989 [debug] [Thread-1 (]: Began compiling node model.stock_analytics.stg_market_data
[0m03:39:38.508873 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_analytics.stg_market_data"
[0m03:39:38.522244 [debug] [Thread-1 (]: Began executing node model.stock_analytics.stg_market_data
[0m03:39:38.797196 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_analytics.stg_market_data"
[0m03:39:38.811639 [debug] [Thread-1 (]: Using snowflake connection "model.stock_analytics.stg_market_data"
[0m03:39:38.817418 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.stg_market_data"} */
create or replace   view USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
  
   as (
    -- Staging view over RAW.MARKET_DATA
-- Keep it simple to avoid casting issues: RAW table already has proper types.

with src as (
  select * from USER_DB_HEDGEHOG.RAW.market_data
)

select
  date::date        as date,
  upper(symbol)     as symbol,
  open              as open,
  high              as high,
  low               as low,
  close             as close,
  volume            as volume
from src
  );
[0m03:39:38.826070 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:39:39.701158 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.877 seconds
[0m03:39:40.304989 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: Close
[0m03:39:40.475610 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8532786-7f58-4777-9612-197ad4ad2a42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f922cfffd40>]}
[0m03:39:40.487806 [info ] [Thread-1 (]: 1 of 4 OK created sql view model ANALYTICS_ANALYTICS.stg_market_data ........... [[32mSUCCESS 1[0m in 2.02s]
[0m03:39:40.497927 [debug] [Thread-1 (]: Finished running node model.stock_analytics.stg_market_data
[0m03:39:40.508970 [debug] [Thread-3 (]: Began running node model.stock_analytics.dim_calendar
[0m03:39:40.521968 [debug] [Thread-2 (]: Began running node model.stock_analytics.indicators_ma_rsi
[0m03:39:40.516056 [debug] [Thread-4 (]: Began running node model.stock_analytics.fact_prices
[0m03:39:40.528227 [info ] [Thread-3 (]: 2 of 4 START sql table model ANALYTICS_ANALYTICS.dim_calendar .................. [RUN]
[0m03:39:40.539041 [info ] [Thread-2 (]: 4 of 4 START sql table model ANALYTICS_ANALYTICS.indicators_ma_rsi ............. [RUN]
[0m03:39:40.549466 [info ] [Thread-4 (]: 3 of 4 START sql table model ANALYTICS_ANALYTICS.fact_prices ................... [RUN]
[0m03:39:40.558745 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.stock_analytics.dim_calendar'
[0m03:39:40.568735 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS, now model.stock_analytics.indicators_ma_rsi)
[0m03:39:40.583805 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.stock_analytics.fact_prices'
[0m03:39:40.602399 [debug] [Thread-2 (]: Began compiling node model.stock_analytics.indicators_ma_rsi
[0m03:39:40.593291 [debug] [Thread-3 (]: Began compiling node model.stock_analytics.dim_calendar
[0m03:39:40.617573 [debug] [Thread-4 (]: Began compiling node model.stock_analytics.fact_prices
[0m03:39:40.666027 [debug] [Thread-2 (]: Writing injected SQL for node "model.stock_analytics.indicators_ma_rsi"
[0m03:39:40.719910 [debug] [Thread-3 (]: Writing injected SQL for node "model.stock_analytics.dim_calendar"
[0m03:39:40.713614 [debug] [Thread-4 (]: Writing injected SQL for node "model.stock_analytics.fact_prices"
[0m03:39:40.730754 [debug] [Thread-2 (]: Began executing node model.stock_analytics.indicators_ma_rsi
[0m03:39:40.775975 [debug] [Thread-4 (]: Began executing node model.stock_analytics.fact_prices
[0m03:39:40.795789 [debug] [Thread-3 (]: Began executing node model.stock_analytics.dim_calendar
[0m03:39:42.158830 [debug] [Thread-2 (]: Writing runtime sql for node "model.stock_analytics.indicators_ma_rsi"
[0m03:39:42.211794 [debug] [Thread-4 (]: Writing runtime sql for node "model.stock_analytics.fact_prices"
[0m03:39:42.299161 [debug] [Thread-3 (]: Writing runtime sql for node "model.stock_analytics.dim_calendar"
[0m03:39:42.307256 [debug] [Thread-4 (]: Using snowflake connection "model.stock_analytics.fact_prices"
[0m03:39:42.339385 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.fact_prices"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.fact_prices
         as
        (-- Fact table: daily prices per symbol.

select
  m.date,
  m.symbol,
  m.open,
  m.high,
  m.low,
  m.close,
  m.volume
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data m
        );
[0m03:39:42.349311 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m03:39:42.357844 [debug] [Thread-2 (]: Using snowflake connection "model.stock_analytics.indicators_ma_rsi"
[0m03:39:42.385730 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.indicators_ma_rsi"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.indicators_ma_rsi
         as
        (-- Indicators: Moving Averages and RSI (14-day)
--
-- This is used for the BI dashboard (Lab 2 requirement).

with src as (
  select * from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
),
ma as (
  select
    date,
    symbol,
    close,
    avg(close) over (
      partition by symbol
      order by date
      rows between 6 preceding and current row
    ) as ma_7,
    avg(close) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as ma_14,
    avg(close) over (
      partition by symbol
      order by date
      rows between 29 preceding and current row
    ) as ma_30,
    lag(close) over (
      partition by symbol
      order by date
    ) as prev_close
  from src
),
gains_losses as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    iff(prev_close is null, null, greatest(close - prev_close, 0)) as gain,
    iff(prev_close is null, null, greatest(prev_close - close, 0)) as loss
  from ma
),
rsi_window as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    avg(gain) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_gain_14,
    avg(loss) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_loss_14
  from gains_losses
)

select
  date,
  symbol,
  close,
  ma_7,
  ma_14,
  ma_30,
  case
    when avg_loss_14 is null or avg_loss_14 = 0 then null
    else 100 - (100 / (1 + (avg_gain_14 / avg_loss_14)))
  end as rsi_14
from rsi_window
        );
[0m03:39:42.554642 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:39:42.605157 [debug] [Thread-3 (]: Using snowflake connection "model.stock_analytics.dim_calendar"
[0m03:39:42.644518 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.dim_calendar"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.dim_calendar
         as
        (-- Simple calendar table covering ~2 years from the min date in staging data.

with bounds as (
  select
    min(date) as min_date
  from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
),
base as (
  select
    dateadd(day, seq4(), min_date) as date
  from bounds,
       table(generator(rowcount => 730)) -- 2 years
)

select
  date,
  year(date)              as year,
  month(date)             as month,
  day(date)               as day_of_month,
  dayname(date)           as day_name,
  week(date)              as week_of_year,
  to_char(date, 'YYYY-MM-DD') as date_key
from base
        );
[0m03:39:42.653175 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m03:39:44.960457 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.411 seconds
[0m03:39:44.986877 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.636 seconds
[0m03:39:45.015144 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 2.362 seconds
[0m03:39:45.006260 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: Close
[0m03:39:45.049177 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: Close
[0m03:39:45.085250 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: Close
[0m03:39:45.253673 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8532786-7f58-4777-9612-197ad4ad2a42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9218523e00>]}
[0m03:39:45.266994 [info ] [Thread-2 (]: 4 of 4 OK created sql table model ANALYTICS_ANALYTICS.indicators_ma_rsi ........ [[32mSUCCESS 1[0m in 4.68s]
[0m03:39:45.297800 [debug] [Thread-2 (]: Finished running node model.stock_analytics.indicators_ma_rsi
[0m03:39:45.308591 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8532786-7f58-4777-9612-197ad4ad2a42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9218526bd0>]}
[0m03:39:45.338573 [info ] [Thread-4 (]: 3 of 4 OK created sql table model ANALYTICS_ANALYTICS.fact_prices .............. [[32mSUCCESS 1[0m in 4.72s]
[0m03:39:45.344545 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8532786-7f58-4777-9612-197ad4ad2a42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9218526960>]}
[0m03:39:45.352930 [debug] [Thread-4 (]: Finished running node model.stock_analytics.fact_prices
[0m03:39:45.361634 [info ] [Thread-3 (]: 2 of 4 OK created sql table model ANALYTICS_ANALYTICS.dim_calendar ............. [[32mSUCCESS 1[0m in 4.78s]
[0m03:39:45.381068 [debug] [Thread-3 (]: Finished running node model.stock_analytics.dim_calendar
[0m03:39:45.405068 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:39:45.408520 [debug] [MainThread]: Connection 'model.stock_analytics.indicators_ma_rsi' was properly closed.
[0m03:39:45.412539 [debug] [MainThread]: Connection 'model.stock_analytics.stg_market_data' was properly closed.
[0m03:39:45.416603 [debug] [MainThread]: Connection 'model.stock_analytics.dim_calendar' was properly closed.
[0m03:39:45.420580 [debug] [MainThread]: Connection 'model.stock_analytics.fact_prices' was properly closed.
[0m03:39:45.428582 [info ] [MainThread]: 
[0m03:39:45.435745 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 10.38 seconds (10.38s).
[0m03:39:45.447590 [debug] [MainThread]: Command end result
[0m03:39:47.519452 [info ] [MainThread]: 
[0m03:39:47.528805 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:39:47.543182 [info ] [MainThread]: 
[0m03:39:47.556869 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m03:39:47.571395 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 26.68367, "process_user_time": 43.239487, "process_kernel_time": 4.635642, "process_mem_max_rss": "220340", "process_out_blocks": "1941", "process_in_blocks": "0"}
[0m03:39:47.578387 [debug] [MainThread]: Command `dbt run` succeeded at 03:39:47.577490 after 26.69 seconds
[0m03:39:47.582940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9230477110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f92189e7ef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9218578d10>]}
[0m03:39:47.587983 [debug] [MainThread]: Flushing usage events
[0m03:40:24.848726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9523c745f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9523f960c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95264a8b60>]}


============================== 03:40:24.899669 | c5d36a57-352d-4d72-9083-ff06d61030bc ==============================
[0m03:40:24.899669 [info ] [MainThread]: Running with dbt=1.8.8
[0m03:40:24.906651 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --target prod --profiles-dir /opt/airflow/dbt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m03:40:40.568141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c5d36a57-352d-4d72-9083-ff06d61030bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95251dbbf0>]}
[0m03:40:41.679556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c5d36a57-352d-4d72-9083-ff06d61030bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f951016f1a0>]}
[0m03:40:41.688975 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:40:42.039816 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m03:40:44.754628 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:40:44.759187 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:40:45.332954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c5d36a57-352d-4d72-9083-ff06d61030bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950beb6cf0>]}
[0m03:40:47.075550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c5d36a57-352d-4d72-9083-ff06d61030bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950bb92bd0>]}
[0m03:40:47.083349 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m03:40:47.088801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5d36a57-352d-4d72-9083-ff06d61030bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950be83410>]}
[0m03:40:47.113772 [info ] [MainThread]: 
[0m03:40:47.122454 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:40:47.133422 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m03:40:47.302734 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m03:40:47.307577 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m03:40:47.311218 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:40:48.285928 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.975 seconds
[0m03:40:48.298407 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m03:40:48.522520 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS)
[0m03:40:48.539439 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m03:40:48.698880 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m03:40:48.704242 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"
[0m03:40:48.708618 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m03:40:48.712844 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS limit 10000
[0m03:40:48.719409 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:40:48.724842 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:40:49.713180 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.988 seconds
[0m03:40:49.731057 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.012 seconds
[0m03:40:49.762573 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: Close
[0m03:40:49.794678 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m03:40:50.078751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5d36a57-352d-4d72-9083-ff06d61030bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9511f14e30>]}
[0m03:40:50.093831 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m03:40:50.102406 [info ] [MainThread]: 
[0m03:40:50.188710 [debug] [Thread-1 (]: Began running node snapshot.stock_analytics.snap_market_data
[0m03:40:50.195160 [info ] [Thread-1 (]: 1 of 1 START snapshot ANALYTICS.snap_market_data ............................... [RUN]
[0m03:40:50.202471 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now snapshot.stock_analytics.snap_market_data)
[0m03:40:50.206927 [debug] [Thread-1 (]: Began compiling node snapshot.stock_analytics.snap_market_data
[0m03:40:50.286031 [debug] [Thread-1 (]: Began executing node snapshot.stock_analytics.snap_market_data
[0m03:40:50.899469 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:50.905285 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        select close, volume from (
                



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m03:40:50.910848 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:40:52.005479 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 1.095 seconds
[0m03:40:52.112130 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:52.122781 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m03:40:52.319970 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.187 seconds
[0m03:40:52.426320 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:52.431820 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m03:40:52.563544 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.126 seconds
[0m03:40:53.000492 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:53.007140 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
create or replace temporary table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
         as
        (

    with snapshot_query as (

        



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data


    ),

    snapshotted_data as (

        select *,
            snapshot_key as dbt_unique_key

        from "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(snapshot_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m03:40:54.069215 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.054 seconds
[0m03:40:54.100942 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:54.106628 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m03:40:54.278683 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.166 seconds
[0m03:40:54.306537 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:54.311546 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m03:40:54.506070 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.189 seconds
[0m03:40:54.545318 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:54.557035 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m03:40:54.735022 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.170 seconds
[0m03:40:54.778965 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:54.785180 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m03:40:54.954708 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.161 seconds
[0m03:40:55.029874 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:55.054820 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m03:40:55.188322 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.128 seconds
[0m03:40:55.419830 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:55.436188 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
/* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        

    with snapshot_query as (

        



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data


    ),

    snapshotted_data as (

        select *,
            snapshot_key as dbt_unique_key

        from "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(snapshot_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

    ) as __dbt_sbq
    where false
    limit 0
[0m03:40:55.812252 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.362 seconds
[0m03:40:55.844941 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:55.849524 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
/* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m03:40:55.953274 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.097 seconds
[0m03:40:55.958461 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.stock_analytics.snap_market_data"
[0m03:40:55.982115 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:55.986847 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
BEGIN
[0m03:40:56.227144 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.235 seconds
[0m03:40:56.231295 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:56.235651 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
merge into "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA" as DBT_INTERNAL_DEST
    using "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SNAPSHOT_KEY", "DATE", "SYMBOL", "CLOSE", "VOLUME", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SNAPSHOT_KEY", "DATE", "SYMBOL", "CLOSE", "VOLUME", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m03:40:56.846262 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.606 seconds
[0m03:40:56.853312 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m03:40:56.860314 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
COMMIT
[0m03:40:57.250941 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.385 seconds
[0m03:40:57.483951 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: Close
[0m03:40:57.635692 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5d36a57-352d-4d72-9083-ff06d61030bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f952447fbf0>]}
[0m03:40:57.642343 [info ] [Thread-1 (]: 1 of 1 OK snapshotted ANALYTICS.snap_market_data ............................... [[32mSUCCESS 0[0m in 7.43s]
[0m03:40:57.652013 [debug] [Thread-1 (]: Finished running node snapshot.stock_analytics.snap_market_data
[0m03:40:57.675703 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:40:57.681888 [debug] [MainThread]: Connection 'list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS' was properly closed.
[0m03:40:57.686692 [debug] [MainThread]: Connection 'snapshot.stock_analytics.snap_market_data' was properly closed.
[0m03:40:57.690824 [info ] [MainThread]: 
[0m03:40:57.696314 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 10.57 seconds (10.57s).
[0m03:40:57.704436 [debug] [MainThread]: Command end result
[0m03:40:58.143953 [info ] [MainThread]: 
[0m03:40:58.150787 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:40:58.158689 [info ] [MainThread]: 
[0m03:40:58.165639 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m03:40:58.187743 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 34.197186, "process_user_time": 46.73467, "process_kernel_time": 4.413829, "process_mem_max_rss": "218144", "process_out_blocks": "1928", "process_in_blocks": "0"}
[0m03:40:58.195507 [debug] [MainThread]: Command `dbt snapshot` succeeded at 03:40:58.193970 after 34.21 seconds
[0m03:40:58.201322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9524085d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f950a9860c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9524649280>]}
[0m03:40:58.205557 [debug] [MainThread]: Flushing usage events
[0m03:41:50.621413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f591ee63590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f591ec52ba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f591fa0d160>]}


============================== 03:41:50.695298 | bfb0aafa-b13c-4777-abd1-7b0f6f31561a ==============================
[0m03:41:50.695298 [info ] [MainThread]: Running with dbt=1.8.8
[0m03:41:50.708060 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --target prod --profiles-dir /opt/airflow/dbt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m03:42:07.031671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bfb0aafa-b13c-4777-abd1-7b0f6f31561a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f591f9afa70>]}
[0m03:42:07.834924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bfb0aafa-b13c-4777-abd1-7b0f6f31561a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f590dd2e1b0>]}
[0m03:42:07.880465 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m03:42:08.458044 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m03:42:11.221633 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m03:42:11.226084 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m03:42:11.897488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bfb0aafa-b13c-4777-abd1-7b0f6f31561a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5907c69c10>]}
[0m03:42:14.777677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bfb0aafa-b13c-4777-abd1-7b0f6f31561a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59062ac380>]}
[0m03:42:14.785708 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m03:42:14.789505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bfb0aafa-b13c-4777-abd1-7b0f6f31561a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5906288b00>]}
[0m03:42:14.822222 [info ] [MainThread]: 
[0m03:42:14.827901 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m03:42:14.873345 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS'
[0m03:42:14.887636 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m03:42:15.230330 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"
[0m03:42:15.226389 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m03:42:15.236991 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS limit 10000
[0m03:42:15.242417 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m03:42:15.250034 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:42:15.256540 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:42:16.695485 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.438 seconds
[0m03:42:16.972766 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.723 seconds
[0m03:42:17.094815 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m03:42:17.299348 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: Close
[0m03:42:17.789930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bfb0aafa-b13c-4777-abd1-7b0f6f31561a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f591fa75130>]}
[0m03:42:17.809050 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m03:42:17.827944 [info ] [MainThread]: 
[0m03:42:18.018819 [debug] [Thread-1 (]: Began running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m03:42:18.026639 [debug] [Thread-2 (]: Began running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m03:42:18.045390 [debug] [Thread-4 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m03:42:18.051292 [info ] [Thread-1 (]: 1 of 7 START test not_null_fact_prices_date .................................... [RUN]
[0m03:42:18.078952 [debug] [Thread-3 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m03:42:18.082197 [info ] [Thread-2 (]: 2 of 7 START test not_null_fact_prices_symbol .................................. [RUN]
[0m03:42:18.095961 [info ] [Thread-4 (]: 4 of 7 START test not_null_indicators_ma_rsi_symbol ............................ [RUN]
[0m03:42:18.103379 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS, now test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5)
[0m03:42:18.112052 [info ] [Thread-3 (]: 3 of 7 START test not_null_indicators_ma_rsi_date .............................. [RUN]
[0m03:42:18.121993 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1)
[0m03:42:18.128598 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94'
[0m03:42:18.134041 [debug] [Thread-1 (]: Began compiling node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m03:42:18.151008 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207'
[0m03:42:18.159036 [debug] [Thread-2 (]: Began compiling node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m03:42:18.166619 [debug] [Thread-4 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m03:42:18.200091 [debug] [Thread-3 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m03:42:18.609362 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m03:42:18.629084 [debug] [Thread-4 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m03:42:18.647927 [debug] [Thread-2 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m03:42:18.604887 [debug] [Thread-3 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m03:42:18.670651 [debug] [Thread-1 (]: Began executing node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m03:42:18.678910 [debug] [Thread-4 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m03:42:18.692619 [debug] [Thread-2 (]: Began executing node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m03:42:18.728789 [debug] [Thread-3 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m03:42:19.523492 [debug] [Thread-2 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m03:42:19.829140 [debug] [Thread-2 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m03:42:20.022843 [debug] [Thread-4 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m03:42:20.131608 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m03:42:20.070233 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.fact_prices
where symbol is null



      
    ) dbt_internal_test
[0m03:42:20.083472 [debug] [Thread-3 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m03:42:20.141741 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:42:20.177500 [debug] [Thread-4 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m03:42:20.205684 [debug] [Thread-1 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m03:42:20.283271 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.indicators_ma_rsi
where symbol is null



      
    ) dbt_internal_test
[0m03:42:20.418597 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.fact_prices
where date is null



      
    ) dbt_internal_test
[0m03:42:20.395803 [debug] [Thread-3 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m03:42:20.435562 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m03:42:20.449911 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:42:20.472619 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.indicators_ma_rsi
where date is null



      
    ) dbt_internal_test
[0m03:42:20.518630 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m03:42:22.031544 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.890 seconds
[0m03:42:22.235480 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.800 seconds
[0m03:42:22.230521 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: Close
[0m03:42:22.259684 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: Close
[0m03:42:22.394558 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.949 seconds
[0m03:42:22.419787 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: Close
[0m03:42:22.448404 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.933 seconds
[0m03:42:22.474082 [info ] [Thread-2 (]: 2 of 7 PASS not_null_fact_prices_symbol ........................................ [[32mPASS[0m in 4.35s]
[0m03:42:22.504673 [debug] [Thread-2 (]: Finished running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m03:42:22.520215 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: Close
[0m03:42:22.539503 [debug] [Thread-2 (]: Began running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m03:42:22.530389 [info ] [Thread-4 (]: 4 of 7 PASS not_null_indicators_ma_rsi_symbol .................................. [[32mPASS[0m in 4.40s]
[0m03:42:22.567289 [info ] [Thread-2 (]: 5 of 7 START test not_null_snap_market_data_snapshot_key ....................... [RUN]
[0m03:42:22.579276 [debug] [Thread-4 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m03:42:22.595518 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1, now test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0)
[0m03:42:22.602948 [debug] [Thread-4 (]: Began running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m03:42:22.614618 [debug] [Thread-2 (]: Began compiling node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m03:42:22.633103 [info ] [Thread-4 (]: 6 of 7 START test not_null_stg_market_data_date ................................ [RUN]
[0m03:42:22.681458 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94, now test.stock_analytics.not_null_stg_market_data_date.fb73c94489)
[0m03:42:22.694950 [debug] [Thread-4 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m03:42:22.692379 [debug] [Thread-2 (]: Writing injected SQL for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m03:42:22.767494 [debug] [Thread-2 (]: Began executing node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m03:42:22.722997 [info ] [Thread-1 (]: 1 of 7 PASS not_null_fact_prices_date .......................................... [[32mPASS[0m in 4.62s]
[0m03:42:22.778021 [info ] [Thread-3 (]: 3 of 7 PASS not_null_indicators_ma_rsi_date .................................... [[32mPASS[0m in 4.63s]
[0m03:42:22.899369 [debug] [Thread-1 (]: Finished running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m03:42:22.916192 [debug] [Thread-4 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m03:42:22.959885 [debug] [Thread-3 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m03:42:23.028088 [debug] [Thread-2 (]: Writing runtime sql for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m03:42:23.017577 [debug] [Thread-1 (]: Began running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m03:42:23.073421 [debug] [Thread-4 (]: Began executing node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m03:42:23.081529 [info ] [Thread-1 (]: 7 of 7 START test not_null_stg_market_data_symbol .............................. [RUN]
[0m03:42:23.115852 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5, now test.stock_analytics.not_null_stg_market_data_symbol.478198cf66)
[0m03:42:23.135669 [debug] [Thread-2 (]: Using snowflake connection "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m03:42:23.163563 [debug] [Thread-1 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m03:42:23.172818 [debug] [Thread-4 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m03:42:23.181470 [debug] [Thread-2 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select snapshot_key
from USER_DB_HEDGEHOG.ANALYTICS.snap_market_data
where snapshot_key is null



      
    ) dbt_internal_test
[0m03:42:23.229153 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m03:42:23.341013 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m03:42:23.279673 [debug] [Thread-4 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m03:42:23.476913 [debug] [Thread-4 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
where date is null



      
    ) dbt_internal_test
[0m03:42:23.480687 [debug] [Thread-1 (]: Began executing node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m03:42:23.487645 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m03:42:23.800556 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m03:42:24.022069 [debug] [Thread-1 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m03:42:24.059966 [debug] [Thread-1 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
where symbol is null



      
    ) dbt_internal_test
[0m03:42:24.074995 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:42:25.466325 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.240 seconds
[0m03:42:25.490861 [debug] [Thread-2 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: Close
[0m03:42:25.637077 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.150 seconds
[0m03:42:25.680865 [debug] [Thread-4 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: Close
[0m03:42:25.737252 [info ] [Thread-2 (]: 5 of 7 PASS not_null_snap_market_data_snapshot_key ............................. [[32mPASS[0m in 3.14s]
[0m03:42:25.748586 [debug] [Thread-2 (]: Finished running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m03:42:25.834983 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.750 seconds
[0m03:42:25.902108 [debug] [Thread-1 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: Close
[0m03:42:25.942432 [info ] [Thread-4 (]: 6 of 7 PASS not_null_stg_market_data_date ...................................... [[32mPASS[0m in 3.25s]
[0m03:42:25.951314 [debug] [Thread-4 (]: Finished running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m03:42:26.131764 [info ] [Thread-1 (]: 7 of 7 PASS not_null_stg_market_data_symbol .................................... [[32mPASS[0m in 3.01s]
[0m03:42:26.140435 [debug] [Thread-1 (]: Finished running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m03:42:26.186302 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:42:26.192578 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_symbol.478198cf66' was properly closed.
[0m03:42:26.198168 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0' was properly closed.
[0m03:42:26.203289 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_date.fb73c94489' was properly closed.
[0m03:42:26.207776 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207' was properly closed.
[0m03:42:26.220749 [info ] [MainThread]: 
[0m03:42:26.232977 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 11.39 seconds (11.39s).
[0m03:42:26.272430 [debug] [MainThread]: Command end result
[0m03:42:27.996198 [info ] [MainThread]: 
[0m03:42:28.131198 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:42:28.189870 [info ] [MainThread]: 
[0m03:42:28.205869 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m03:42:28.241580 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 38.607933, "process_user_time": 66.54812, "process_kernel_time": 8.142607, "process_mem_max_rss": "222176", "process_out_blocks": "1943", "process_in_blocks": "0"}
[0m03:42:28.248784 [debug] [MainThread]: Command `dbt test` succeeded at 03:42:28.247800 after 38.62 seconds
[0m03:42:28.359939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f591ee63590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f59066a67b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f590dd9ce00>]}
[0m03:42:28.443949 [debug] [MainThread]: Flushing usage events
[0m06:14:35.900758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f71395431d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7139ba5370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7139542210>]}


============================== 06:14:35.916373 | a0216d3d-a55d-4d6c-b775-a5c056fc7970 ==============================
[0m06:14:35.916373 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:14:35.919348 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:14:36.627794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a0216d3d-a55d-4d6c-b775-a5c056fc7970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7138f313d0>]}
[0m06:14:36.662698 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:14:36.671270 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:14:36.673802 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 1.0104233, "process_user_time": 5.14389, "process_kernel_time": 2.402782, "process_mem_max_rss": "169952", "process_in_blocks": "8528", "process_out_blocks": "2195"}
[0m06:14:36.675677 [debug] [MainThread]: Command `dbt deps` succeeded at 06:14:36.675345 after 1.01 seconds
[0m06:14:36.677471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7139ba5370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7138c97320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f713b5c3680>]}
[0m06:14:36.679381 [debug] [MainThread]: Flushing usage events
[0m06:14:43.488989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feed7e31fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feed7dafe30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feed7e320c0>]}


============================== 06:14:43.498548 | a52b7e96-2f27-4b4f-b4ab-535b0d7a5907 ==============================
[0m06:14:43.498548 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:14:43.500293 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --target prod --profiles-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:14:45.665937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a52b7e96-2f27-4b4f-b4ab-535b0d7a5907', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feed7b8b7d0>]}
[0m06:14:45.775608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a52b7e96-2f27-4b4f-b4ab-535b0d7a5907', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feec40ddc70>]}
[0m06:14:45.777911 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:14:45.803483 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m06:14:46.046173 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m06:14:46.047777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a52b7e96-2f27-4b4f-b4ab-535b0d7a5907', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feebfcb9f10>]}
[0m06:14:49.124474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a52b7e96-2f27-4b4f-b4ab-535b0d7a5907', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feebefa14c0>]}
[0m06:14:49.343269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a52b7e96-2f27-4b4f-b4ab-535b0d7a5907', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feebfae57c0>]}
[0m06:14:49.344529 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m06:14:49.345918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a52b7e96-2f27-4b4f-b4ab-535b0d7a5907', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feed8c83860>]}
[0m06:14:49.350082 [info ] [MainThread]: 
[0m06:14:49.351624 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:14:49.363037 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m06:14:49.393770 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m06:14:49.395353 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m06:14:49.396441 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:14:50.115314 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.719 seconds
[0m06:14:50.119516 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m06:14:50.290379 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now create_USER_DB_HEDGEHOG__ANALYTICS)
[0m06:14:50.292084 [debug] [ThreadPool]: Creating schema "database: "USER_DB_HEDGEHOG"
schema: "_ANALYTICS"
"
[0m06:14:50.302719 [debug] [ThreadPool]: Using snowflake connection "create_USER_DB_HEDGEHOG__ANALYTICS"
[0m06:14:50.304131 [debug] [ThreadPool]: On create_USER_DB_HEDGEHOG__ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "create_USER_DB_HEDGEHOG__ANALYTICS"} */
create schema if not exists USER_DB_HEDGEHOG._ANALYTICS
[0m06:14:50.305105 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:14:50.824221 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.519 seconds
[0m06:14:50.828925 [debug] [ThreadPool]: On create_USER_DB_HEDGEHOG__ANALYTICS: Close
[0m06:14:50.967876 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_USER_DB_HEDGEHOG__ANALYTICS, now list_USER_DB_HEDGEHOG_ANALYTICS)
[0m06:14:50.984013 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG__ANALYTICS'
[0m06:14:51.007121 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m06:14:51.014281 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m06:14:51.024914 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:14:51.027510 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG__ANALYTICS"
[0m06:14:51.033303 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG__ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG__ANALYTICS"} */
show objects in USER_DB_HEDGEHOG._ANALYTICS limit 10000
[0m06:14:51.045020 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:14:51.695482 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.650 seconds
[0m06:14:51.701810 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG__ANALYTICS: Close
[0m06:14:51.797790 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.772 seconds
[0m06:14:51.805698 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m06:14:51.973313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a52b7e96-2f27-4b4f-b4ab-535b0d7a5907', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feebf09e360>]}
[0m06:14:51.975552 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m06:14:51.976996 [info ] [MainThread]: 
[0m06:14:52.001334 [debug] [Thread-1 (]: Began running node model.stock_analytics.stg_market_data
[0m06:14:52.003167 [info ] [Thread-1 (]: 1 of 4 START sql view model _ANALYTICS.stg_market_data ......................... [RUN]
[0m06:14:52.004765 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now model.stock_analytics.stg_market_data)
[0m06:14:52.006943 [debug] [Thread-1 (]: Began compiling node model.stock_analytics.stg_market_data
[0m06:14:52.022895 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_analytics.stg_market_data"
[0m06:14:52.028860 [debug] [Thread-1 (]: Began executing node model.stock_analytics.stg_market_data
[0m06:14:52.087402 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_analytics.stg_market_data"
[0m06:14:52.094089 [debug] [Thread-1 (]: Using snowflake connection "model.stock_analytics.stg_market_data"
[0m06:14:52.095349 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.stg_market_data"} */
create or replace   view USER_DB_HEDGEHOG._ANALYTICS.stg_market_data
  
   as (
    -- Staging view over RAW.MARKET_DATA
-- Keep it simple to avoid casting issues: RAW table already has proper types.

with src as (
  select * from USER_DB_HEDGEHOG.RAW.market_data
)

select
  date::date        as date,
  upper(symbol)     as symbol,
  open              as open,
  high              as high,
  low               as low,
  close             as close,
  volume            as volume
from src
  );
[0m06:14:52.096401 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:14:52.813012 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.716 seconds
[0m06:14:52.877390 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: Close
[0m06:14:53.003680 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a52b7e96-2f27-4b4f-b4ab-535b0d7a5907', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feed8393b00>]}
[0m06:14:53.005872 [info ] [Thread-1 (]: 1 of 4 OK created sql view model _ANALYTICS.stg_market_data .................... [[32mSUCCESS 1[0m in 1.00s]
[0m06:14:53.008459 [debug] [Thread-1 (]: Finished running node model.stock_analytics.stg_market_data
[0m06:14:53.011739 [debug] [Thread-3 (]: Began running node model.stock_analytics.dim_calendar
[0m06:14:53.012994 [debug] [Thread-4 (]: Began running node model.stock_analytics.fact_prices
[0m06:14:53.014703 [debug] [Thread-2 (]: Began running node model.stock_analytics.indicators_ma_rsi
[0m06:14:53.016155 [info ] [Thread-3 (]: 2 of 4 START sql table model _ANALYTICS.dim_calendar ........................... [RUN]
[0m06:14:53.018426 [info ] [Thread-4 (]: 3 of 4 START sql table model _ANALYTICS.fact_prices ............................ [RUN]
[0m06:14:53.020374 [info ] [Thread-2 (]: 4 of 4 START sql table model _ANALYTICS.indicators_ma_rsi ...................... [RUN]
[0m06:14:53.022514 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.stock_analytics.dim_calendar'
[0m06:14:53.024264 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.stock_analytics.fact_prices'
[0m06:14:53.025683 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG__ANALYTICS, now model.stock_analytics.indicators_ma_rsi)
[0m06:14:53.027311 [debug] [Thread-3 (]: Began compiling node model.stock_analytics.dim_calendar
[0m06:14:53.028621 [debug] [Thread-4 (]: Began compiling node model.stock_analytics.fact_prices
[0m06:14:53.030185 [debug] [Thread-2 (]: Began compiling node model.stock_analytics.indicators_ma_rsi
[0m06:14:53.037271 [debug] [Thread-3 (]: Writing injected SQL for node "model.stock_analytics.dim_calendar"
[0m06:14:53.043420 [debug] [Thread-4 (]: Writing injected SQL for node "model.stock_analytics.fact_prices"
[0m06:14:53.049647 [debug] [Thread-2 (]: Writing injected SQL for node "model.stock_analytics.indicators_ma_rsi"
[0m06:14:53.056521 [debug] [Thread-3 (]: Began executing node model.stock_analytics.dim_calendar
[0m06:14:53.064371 [debug] [Thread-2 (]: Began executing node model.stock_analytics.indicators_ma_rsi
[0m06:14:53.065990 [debug] [Thread-4 (]: Began executing node model.stock_analytics.fact_prices
[0m06:14:53.142810 [debug] [Thread-3 (]: Writing runtime sql for node "model.stock_analytics.dim_calendar"
[0m06:14:53.144233 [debug] [Thread-4 (]: Writing runtime sql for node "model.stock_analytics.fact_prices"
[0m06:14:53.155975 [debug] [Thread-2 (]: Writing runtime sql for node "model.stock_analytics.indicators_ma_rsi"
[0m06:14:53.163864 [debug] [Thread-3 (]: Using snowflake connection "model.stock_analytics.dim_calendar"
[0m06:14:53.165510 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.dim_calendar"} */
create or replace transient table USER_DB_HEDGEHOG._ANALYTICS.dim_calendar
         as
        (-- Simple calendar table covering ~2 years from the min date in staging data.

with bounds as (
  select
    min(date) as min_date
  from USER_DB_HEDGEHOG._ANALYTICS.stg_market_data
),
base as (
  select
    dateadd(day, seq4(), min_date) as date
  from bounds,
       table(generator(rowcount => 730)) -- 2 years
)

select
  date,
  year(date)              as year,
  month(date)             as month,
  day(date)               as day_of_month,
  dayname(date)           as day_name,
  week(date)              as week_of_year,
  to_char(date, 'YYYY-MM-DD') as date_key
from base
        );
[0m06:14:53.167698 [debug] [Thread-4 (]: Using snowflake connection "model.stock_analytics.fact_prices"
[0m06:14:53.168646 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m06:14:53.174546 [debug] [Thread-2 (]: Using snowflake connection "model.stock_analytics.indicators_ma_rsi"
[0m06:14:53.175980 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.fact_prices"} */
create or replace transient table USER_DB_HEDGEHOG._ANALYTICS.fact_prices
         as
        (-- Fact table: daily prices per symbol.

select
  m.date,
  m.symbol,
  m.open,
  m.high,
  m.low,
  m.close,
  m.volume
from USER_DB_HEDGEHOG._ANALYTICS.stg_market_data m
        );
[0m06:14:53.180753 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.indicators_ma_rsi"} */
create or replace transient table USER_DB_HEDGEHOG._ANALYTICS.indicators_ma_rsi
         as
        (-- Indicators: Moving Averages and RSI (14-day)
--
-- This is used for the BI dashboard (Lab 2 requirement).

with src as (
  select * from USER_DB_HEDGEHOG._ANALYTICS.stg_market_data
),
ma as (
  select
    date,
    symbol,
    close,
    avg(close) over (
      partition by symbol
      order by date
      rows between 6 preceding and current row
    ) as ma_7,
    avg(close) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as ma_14,
    avg(close) over (
      partition by symbol
      order by date
      rows between 29 preceding and current row
    ) as ma_30,
    lag(close) over (
      partition by symbol
      order by date
    ) as prev_close
  from src
),
gains_losses as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    iff(prev_close is null, null, greatest(close - prev_close, 0)) as gain,
    iff(prev_close is null, null, greatest(prev_close - close, 0)) as loss
  from ma
),
rsi_window as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    avg(gain) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_gain_14,
    avg(loss) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_loss_14
  from gains_losses
)

select
  date,
  symbol,
  close,
  ma_7,
  ma_14,
  ma_30,
  case
    when avg_loss_14 is null or avg_loss_14 = 0 then null
    else 100 - (100 / (1 + (avg_gain_14 / avg_loss_14)))
  end as rsi_14
from rsi_window
        );
[0m06:14:53.184914 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m06:14:53.189195 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:14:54.465659 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.277 seconds
[0m06:14:54.471555 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: Close
[0m06:14:54.545558 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.377 seconds
[0m06:14:54.551830 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: Close
[0m06:14:54.570915 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.386 seconds
[0m06:14:54.579031 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: Close
[0m06:14:54.603338 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a52b7e96-2f27-4b4f-b4ab-535b0d7a5907', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feebdc897f0>]}
[0m06:14:54.608932 [info ] [Thread-2 (]: 4 of 4 OK created sql table model _ANALYTICS.indicators_ma_rsi ................. [[32mSUCCESS 1[0m in 1.58s]
[0m06:14:54.611561 [debug] [Thread-2 (]: Finished running node model.stock_analytics.indicators_ma_rsi
[0m06:14:54.672756 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a52b7e96-2f27-4b4f-b4ab-535b0d7a5907', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feebdc88560>]}
[0m06:14:54.675418 [info ] [Thread-3 (]: 2 of 4 OK created sql table model _ANALYTICS.dim_calendar ...................... [[32mSUCCESS 1[0m in 1.65s]
[0m06:14:54.678224 [debug] [Thread-3 (]: Finished running node model.stock_analytics.dim_calendar
[0m06:14:54.907011 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a52b7e96-2f27-4b4f-b4ab-535b0d7a5907', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feebdcae930>]}
[0m06:14:54.909610 [info ] [Thread-4 (]: 3 of 4 OK created sql table model _ANALYTICS.fact_prices ....................... [[32mSUCCESS 1[0m in 1.88s]
[0m06:14:54.911949 [debug] [Thread-4 (]: Finished running node model.stock_analytics.fact_prices
[0m06:14:54.918467 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:14:54.920295 [debug] [MainThread]: Connection 'model.stock_analytics.stg_market_data' was properly closed.
[0m06:14:54.922106 [debug] [MainThread]: Connection 'model.stock_analytics.indicators_ma_rsi' was properly closed.
[0m06:14:54.923848 [debug] [MainThread]: Connection 'model.stock_analytics.dim_calendar' was properly closed.
[0m06:14:54.925934 [debug] [MainThread]: Connection 'model.stock_analytics.fact_prices' was properly closed.
[0m06:14:54.928349 [info ] [MainThread]: 
[0m06:14:54.929999 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 5.58 seconds (5.58s).
[0m06:14:54.935089 [debug] [MainThread]: Command end result
[0m06:14:55.034439 [info ] [MainThread]: 
[0m06:14:55.035926 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:14:55.037400 [info ] [MainThread]: 
[0m06:14:55.038567 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m06:14:55.040814 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.63988, "process_user_time": 11.042938, "process_kernel_time": 1.019833, "process_mem_max_rss": "226296", "process_in_blocks": "1512", "process_out_blocks": "2866"}
[0m06:14:55.043280 [debug] [MainThread]: Command `dbt run` succeeded at 06:14:55.042923 after 11.64 seconds
[0m06:14:55.044545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feebff3b590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feebefa8260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7feebf9ab740>]}
[0m06:14:55.045734 [debug] [MainThread]: Flushing usage events
[0m06:15:01.199264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd84de27e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd86eedc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd84de1970>]}


============================== 06:15:01.209830 | 3ae53b31-6c7a-4ef0-ad8f-1cd96fbcb90d ==============================
[0m06:15:01.209830 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:15:01.211733 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt snapshot --target prod --profiles-dir /opt/airflow/dbt', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m06:15:02.983208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3ae53b31-6c7a-4ef0-ad8f-1cd96fbcb90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd860bb6e0>]}
[0m06:15:03.081804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3ae53b31-6c7a-4ef0-ad8f-1cd96fbcb90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd70f7f170>]}
[0m06:15:03.083425 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:15:03.112412 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m06:15:03.421352 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:15:03.423330 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:15:03.558245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3ae53b31-6c7a-4ef0-ad8f-1cd96fbcb90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd70c67a70>]}
[0m06:15:03.831442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3ae53b31-6c7a-4ef0-ad8f-1cd96fbcb90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd70c77440>]}
[0m06:15:03.833384 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m06:15:03.835222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ae53b31-6c7a-4ef0-ad8f-1cd96fbcb90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd70a9ede0>]}
[0m06:15:03.839784 [info ] [MainThread]: 
[0m06:15:03.841750 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:15:03.844767 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m06:15:03.890908 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m06:15:03.892697 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m06:15:03.894221 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:15:04.367322 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.473 seconds
[0m06:15:04.372162 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m06:15:04.515731 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG__ANALYTICS)
[0m06:15:04.524701 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m06:15:04.545352 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG__ANALYTICS"
[0m06:15:04.552468 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG__ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG__ANALYTICS"} */
show objects in USER_DB_HEDGEHOG._ANALYTICS limit 10000
[0m06:15:04.556911 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m06:15:04.557862 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:15:04.559338 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m06:15:04.562777 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:15:04.991767 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.433 seconds
[0m06:15:04.996294 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG__ANALYTICS: Close
[0m06:15:05.110692 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.547 seconds
[0m06:15:05.116554 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m06:15:05.245584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ae53b31-6c7a-4ef0-ad8f-1cd96fbcb90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd70d303b0>]}
[0m06:15:05.247480 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m06:15:05.249101 [info ] [MainThread]: 
[0m06:15:05.269415 [debug] [Thread-1 (]: Began running node snapshot.stock_analytics.snap_market_data
[0m06:15:05.271374 [info ] [Thread-1 (]: 1 of 1 START snapshot ANALYTICS.snap_market_data ............................... [RUN]
[0m06:15:05.273447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now snapshot.stock_analytics.snap_market_data)
[0m06:15:05.275473 [debug] [Thread-1 (]: Began compiling node snapshot.stock_analytics.snap_market_data
[0m06:15:05.297387 [debug] [Thread-1 (]: Began executing node snapshot.stock_analytics.snap_market_data
[0m06:15:05.407513 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:05.408842 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        select close, volume from (
                



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m06:15:05.409995 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:15:05.871328 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.461 seconds
[0m06:15:05.892503 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:05.894213 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m06:15:06.016093 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.120 seconds
[0m06:15:06.038415 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:06.039659 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m06:15:06.173112 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.132 seconds
[0m06:15:06.242543 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:06.244276 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
create or replace temporary table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
         as
        (

    with snapshot_query as (

        



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data


    ),

    snapshotted_data as (

        select *,
            snapshot_key as dbt_unique_key

        from "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(snapshot_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m06:15:07.254080 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.008 seconds
[0m06:15:07.262775 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:07.264153 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m06:15:07.363415 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.098 seconds
[0m06:15:07.373440 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:07.374937 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m06:15:07.473679 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.097 seconds
[0m06:15:07.484835 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:07.486392 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m06:15:07.617701 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.129 seconds
[0m06:15:07.627522 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:07.628809 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m06:15:07.706283 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.076 seconds
[0m06:15:07.734674 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:07.738063 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m06:15:07.815530 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.076 seconds
[0m06:15:07.887188 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:07.890059 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
/* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        

    with snapshot_query as (

        



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data


    ),

    snapshotted_data as (

        select *,
            snapshot_key as dbt_unique_key

        from "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(snapshot_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

    ) as __dbt_sbq
    where false
    limit 0
[0m06:15:08.294284 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.402 seconds
[0m06:15:08.304389 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:08.305756 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
/* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m06:15:08.397582 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.090 seconds
[0m06:15:08.400608 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.stock_analytics.snap_market_data"
[0m06:15:08.410605 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:08.412212 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
BEGIN
[0m06:15:08.558726 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.144 seconds
[0m06:15:08.561100 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:08.563044 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
merge into "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA" as DBT_INTERNAL_DEST
    using "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SNAPSHOT_KEY", "DATE", "SYMBOL", "CLOSE", "VOLUME", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SNAPSHOT_KEY", "DATE", "SYMBOL", "CLOSE", "VOLUME", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m06:15:09.134567 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.570 seconds
[0m06:15:09.136182 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:15:09.137328 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
COMMIT
[0m06:15:09.605945 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.467 seconds
[0m06:15:09.675394 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: Close
[0m06:15:09.829181 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ae53b31-6c7a-4ef0-ad8f-1cd96fbcb90d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd8535fa70>]}
[0m06:15:09.831549 [info ] [Thread-1 (]: 1 of 1 OK snapshotted ANALYTICS.snap_market_data ............................... [[32mSUCCESS 0[0m in 4.55s]
[0m06:15:09.834077 [debug] [Thread-1 (]: Finished running node snapshot.stock_analytics.snap_market_data
[0m06:15:09.839599 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:15:09.840886 [debug] [MainThread]: Connection 'list_USER_DB_HEDGEHOG__ANALYTICS' was properly closed.
[0m06:15:09.841986 [debug] [MainThread]: Connection 'snapshot.stock_analytics.snap_market_data' was properly closed.
[0m06:15:09.843112 [info ] [MainThread]: 
[0m06:15:09.844623 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 6.00 seconds (6.00s).
[0m06:15:09.846829 [debug] [MainThread]: Command end result
[0m06:15:09.930029 [info ] [MainThread]: 
[0m06:15:09.931394 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:15:09.932480 [info ] [MainThread]: 
[0m06:15:09.933652 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m06:15:09.935619 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 8.846664, "process_user_time": 7.38674, "process_kernel_time": 0.667367, "process_mem_max_rss": "218252", "process_out_blocks": "1927", "process_in_blocks": "0"}
[0m06:15:09.936928 [debug] [MainThread]: Command `dbt snapshot` succeeded at 06:15:09.936670 after 8.85 seconds
[0m06:15:09.938009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd86eedc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd84b543b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fdd852f7440>]}
[0m06:15:09.938883 [debug] [MainThread]: Flushing usage events
[0m06:15:15.283416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a7d4fe540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a7efc08c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a7cd25eb0>]}


============================== 06:15:15.294471 | 5abcdf8e-02f2-405e-974c-93454967b057 ==============================
[0m06:15:15.294471 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:15:15.296457 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --target prod --profiles-dir /opt/airflow/dbt', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:15:16.777347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5abcdf8e-02f2-405e-974c-93454967b057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a69096570>]}
[0m06:15:16.872150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5abcdf8e-02f2-405e-974c-93454967b057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a69508a40>]}
[0m06:15:16.873602 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:15:16.893563 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m06:15:17.195705 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:15:17.196920 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:15:17.293844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5abcdf8e-02f2-405e-974c-93454967b057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a7dbd9130>]}
[0m06:15:17.575396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5abcdf8e-02f2-405e-974c-93454967b057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a68a84350>]}
[0m06:15:17.577405 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m06:15:17.578647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5abcdf8e-02f2-405e-974c-93454967b057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a7dc85940>]}
[0m06:15:17.584677 [info ] [MainThread]: 
[0m06:15:17.586615 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:15:17.597299 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG__ANALYTICS'
[0m06:15:17.608613 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m06:15:17.669133 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m06:15:17.668564 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG__ANALYTICS"
[0m06:15:17.670658 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m06:15:17.672024 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG__ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG__ANALYTICS"} */
show objects in USER_DB_HEDGEHOG._ANALYTICS limit 10000
[0m06:15:17.673138 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:15:17.674182 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:15:18.249846 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.576 seconds
[0m06:15:18.254979 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG__ANALYTICS: Close
[0m06:15:18.309743 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.637 seconds
[0m06:15:18.314492 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m06:15:18.436333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5abcdf8e-02f2-405e-974c-93454967b057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a68b98920>]}
[0m06:15:18.438889 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m06:15:18.444190 [info ] [MainThread]: 
[0m06:15:18.493730 [debug] [Thread-1 (]: Began running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m06:15:18.525618 [info ] [Thread-1 (]: 1 of 7 START test not_null_fact_prices_date .................................... [RUN]
[0m06:15:18.534859 [debug] [Thread-2 (]: Began running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m06:15:18.542672 [debug] [Thread-3 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m06:15:18.546506 [debug] [Thread-4 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m06:15:18.552170 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5)
[0m06:15:18.559715 [info ] [Thread-2 (]: 2 of 7 START test not_null_fact_prices_symbol .................................. [RUN]
[0m06:15:18.569443 [info ] [Thread-3 (]: 3 of 7 START test not_null_indicators_ma_rsi_date .............................. [RUN]
[0m06:15:18.573223 [info ] [Thread-4 (]: 4 of 7 START test not_null_indicators_ma_rsi_symbol ............................ [RUN]
[0m06:15:18.575597 [debug] [Thread-1 (]: Began compiling node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m06:15:18.578094 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG__ANALYTICS, now test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1)
[0m06:15:18.580584 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207'
[0m06:15:18.582843 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94'
[0m06:15:18.624506 [debug] [Thread-2 (]: Began compiling node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m06:15:18.642481 [debug] [Thread-3 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m06:15:18.661598 [debug] [Thread-4 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m06:15:18.669663 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m06:15:18.681951 [debug] [Thread-2 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m06:15:18.694118 [debug] [Thread-3 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m06:15:18.705729 [debug] [Thread-4 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m06:15:18.713957 [debug] [Thread-2 (]: Began executing node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m06:15:18.716567 [debug] [Thread-3 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m06:15:18.744495 [debug] [Thread-1 (]: Began executing node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m06:15:18.847470 [debug] [Thread-4 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m06:15:18.894175 [debug] [Thread-3 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m06:15:18.897805 [debug] [Thread-4 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m06:15:18.901232 [debug] [Thread-2 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m06:15:18.904522 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m06:15:18.914084 [debug] [Thread-3 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m06:15:18.917308 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG._ANALYTICS.indicators_ma_rsi
where date is null



      
    ) dbt_internal_test
[0m06:15:18.925377 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m06:15:18.930597 [debug] [Thread-2 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m06:15:18.934917 [debug] [Thread-1 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m06:15:18.940324 [debug] [Thread-4 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m06:15:18.945542 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG._ANALYTICS.fact_prices
where symbol is null



      
    ) dbt_internal_test
[0m06:15:18.950460 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG._ANALYTICS.fact_prices
where date is null



      
    ) dbt_internal_test
[0m06:15:18.954462 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG._ANALYTICS.indicators_ma_rsi
where symbol is null



      
    ) dbt_internal_test
[0m06:15:18.958324 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:15:18.962920 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:15:18.967128 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m06:15:19.818361 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.860 seconds
[0m06:15:19.862768 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.938 seconds
[0m06:15:19.864411 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: Close
[0m06:15:19.880964 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: Close
[0m06:15:19.954097 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.987 seconds
[0m06:15:19.981480 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: Close
[0m06:15:20.014726 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.052 seconds
[0m06:15:20.048360 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: Close
[0m06:15:20.189589 [info ] [Thread-3 (]: 3 of 7 PASS not_null_indicators_ma_rsi_date .................................... [[32mPASS[0m in 1.60s]
[0m06:15:20.200235 [debug] [Thread-3 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m06:15:20.206291 [debug] [Thread-3 (]: Began running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m06:15:20.226665 [info ] [Thread-3 (]: 5 of 7 START test not_null_snap_market_data_snapshot_key ....................... [RUN]
[0m06:15:20.220749 [info ] [Thread-4 (]: 4 of 7 PASS not_null_indicators_ma_rsi_symbol .................................. [[32mPASS[0m in 1.64s]
[0m06:15:20.230581 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207, now test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0)
[0m06:15:20.261663 [debug] [Thread-3 (]: Began compiling node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m06:15:20.257378 [debug] [Thread-4 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m06:15:20.279615 [debug] [Thread-4 (]: Began running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m06:15:20.323264 [info ] [Thread-4 (]: 6 of 7 START test not_null_stg_market_data_date ................................ [RUN]
[0m06:15:20.343182 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94, now test.stock_analytics.not_null_stg_market_data_date.fb73c94489)
[0m06:15:20.346536 [debug] [Thread-4 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m06:15:20.335584 [debug] [Thread-3 (]: Writing injected SQL for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m06:15:20.372234 [debug] [Thread-4 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m06:15:20.394629 [debug] [Thread-3 (]: Began executing node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m06:15:20.418678 [info ] [Thread-1 (]: 1 of 7 PASS not_null_fact_prices_date .......................................... [[32mPASS[0m in 1.87s]
[0m06:15:20.421009 [debug] [Thread-4 (]: Began executing node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m06:15:20.429020 [debug] [Thread-3 (]: Writing runtime sql for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m06:15:20.431667 [debug] [Thread-1 (]: Finished running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m06:15:20.446244 [debug] [Thread-4 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m06:15:20.449719 [debug] [Thread-1 (]: Began running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m06:15:20.466111 [debug] [Thread-3 (]: Using snowflake connection "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m06:15:20.475383 [info ] [Thread-1 (]: 7 of 7 START test not_null_stg_market_data_symbol .............................. [RUN]
[0m06:15:20.479213 [debug] [Thread-3 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select snapshot_key
from USER_DB_HEDGEHOG.ANALYTICS.snap_market_data
where snapshot_key is null



      
    ) dbt_internal_test
[0m06:15:20.481511 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5, now test.stock_analytics.not_null_stg_market_data_symbol.478198cf66)
[0m06:15:20.484643 [debug] [Thread-4 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m06:15:20.487641 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m06:15:20.489703 [debug] [Thread-1 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m06:15:20.492561 [debug] [Thread-4 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG._ANALYTICS.stg_market_data
where date is null



      
    ) dbt_internal_test
[0m06:15:20.515967 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m06:15:20.529641 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m06:15:20.552259 [info ] [Thread-2 (]: 2 of 7 PASS not_null_fact_prices_symbol ........................................ [[32mPASS[0m in 1.97s]
[0m06:15:20.560843 [debug] [Thread-1 (]: Began executing node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m06:15:20.566662 [debug] [Thread-2 (]: Finished running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m06:15:20.605299 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m06:15:20.648897 [debug] [Thread-1 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m06:15:20.663334 [debug] [Thread-1 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG._ANALYTICS.stg_market_data
where symbol is null



      
    ) dbt_internal_test
[0m06:15:20.669066 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:15:21.153215 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.638 seconds
[0m06:15:21.161492 [debug] [Thread-4 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: Close
[0m06:15:21.286637 [info ] [Thread-4 (]: 6 of 7 PASS not_null_stg_market_data_date ...................................... [[32mPASS[0m in 0.94s]
[0m06:15:21.294111 [debug] [Thread-4 (]: Finished running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m06:15:21.394488 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.727 seconds
[0m06:15:21.401277 [debug] [Thread-1 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: Close
[0m06:15:21.554185 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.066 seconds
[0m06:15:21.563572 [debug] [Thread-3 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: Close
[0m06:15:21.614849 [info ] [Thread-1 (]: 7 of 7 PASS not_null_stg_market_data_symbol .................................... [[32mPASS[0m in 1.13s]
[0m06:15:21.617694 [debug] [Thread-1 (]: Finished running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m06:15:21.710040 [info ] [Thread-3 (]: 5 of 7 PASS not_null_snap_market_data_snapshot_key ............................. [[32mPASS[0m in 1.48s]
[0m06:15:21.714006 [debug] [Thread-3 (]: Finished running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m06:15:21.727835 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:15:21.731004 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1' was properly closed.
[0m06:15:21.733698 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_symbol.478198cf66' was properly closed.
[0m06:15:21.735018 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0' was properly closed.
[0m06:15:21.741646 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_date.fb73c94489' was properly closed.
[0m06:15:21.745134 [info ] [MainThread]: 
[0m06:15:21.747542 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 4.16 seconds (4.16s).
[0m06:15:21.767786 [debug] [MainThread]: Command end result
[0m06:15:22.190779 [info ] [MainThread]: 
[0m06:15:22.199033 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:15:22.210533 [info ] [MainThread]: 
[0m06:15:22.214911 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m06:15:22.220689 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 7.0316486, "process_user_time": 8.085817, "process_kernel_time": 0.997301, "process_mem_max_rss": "222232", "process_out_blocks": "1941", "process_in_blocks": "0"}
[0m06:15:22.223315 [debug] [MainThread]: Command `dbt test` succeeded at 06:15:22.222957 after 7.03 seconds
[0m06:15:22.225210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a7d4fe540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a7cf021e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a693a6ea0>]}
[0m06:15:22.228569 [debug] [MainThread]: Flushing usage events
[0m06:27:12.971993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd349a4bf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd34a707da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd34a7a6a20>]}


============================== 06:27:12.982270 | 1bf09cb2-7403-4a0a-8a42-5664014496df ==============================
[0m06:27:12.982270 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:27:12.984270 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt clean', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:27:13.184448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1bf09cb2-7403-4a0a-8a42-5664014496df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd348143440>]}
[0m06:27:13.258013 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.3720091, "process_user_time": 3.31591, "process_kernel_time": 0.203098, "process_mem_max_rss": "103312", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m06:27:13.260787 [debug] [MainThread]: Command `dbt clean` succeeded at 06:27:13.260307 after 0.38 seconds
[0m06:27:13.263643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd349a4bf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd34bc3b350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd34819fc20>]}
[0m06:27:13.268033 [debug] [MainThread]: Flushing usage events
[0m06:27:48.656465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f330a370fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3308e63f80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f33084163c0>]}


============================== 06:27:48.665763 | 25f33b6d-c9c2-47c5-93ed-4b4433655307 ==============================
[0m06:27:48.665763 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:27:48.667263 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m06:27:48.842371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '25f33b6d-c9c2-47c5-93ed-4b4433655307', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3308838b90>]}
[0m06:27:48.859474 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:27:48.863767 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:27:48.865851 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.2959033, "process_user_time": 3.052939, "process_kernel_time": 0.178934, "process_mem_max_rss": "103476", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m06:27:48.868124 [debug] [MainThread]: Command `dbt deps` succeeded at 06:27:48.867877 after 0.30 seconds
[0m06:27:48.872236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f330c63f080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3308ffe7b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3308eaaae0>]}
[0m06:27:48.874327 [debug] [MainThread]: Flushing usage events
[0m06:28:10.251227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38d2dedb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38d4c1ade0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38d2dee660>]}


============================== 06:28:10.259907 | 01361ba4-069a-4e9d-8d2b-85ca19d4713d ==============================
[0m06:28:10.259907 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:28:10.261185 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --target prod --profiles-dir /opt/airflow/dbt', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m06:28:11.881756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01361ba4-069a-4e9d-8d2b-85ca19d4713d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38cb5adc70>]}
[0m06:28:11.963423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01361ba4-069a-4e9d-8d2b-85ca19d4713d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38c2b30230>]}
[0m06:28:11.964830 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:28:12.017511 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m06:28:12.022602 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m06:28:12.025679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '01361ba4-069a-4e9d-8d2b-85ca19d4713d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38bb53dd60>]}
[0m06:28:14.910869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01361ba4-069a-4e9d-8d2b-85ca19d4713d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38ba868440>]}
[0m06:28:15.127684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01361ba4-069a-4e9d-8d2b-85ca19d4713d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38ba7ffd10>]}
[0m06:28:15.128836 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m06:28:15.130046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01361ba4-069a-4e9d-8d2b-85ca19d4713d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38ba62ca40>]}
[0m06:28:15.135586 [info ] [MainThread]: 
[0m06:28:15.138534 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:28:15.151539 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m06:28:15.192144 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m06:28:15.194797 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m06:28:15.196310 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:28:15.719590 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.523 seconds
[0m06:28:15.724371 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m06:28:15.856326 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS)
[0m06:28:15.865919 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS'
[0m06:28:15.895948 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"
[0m06:28:15.890825 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m06:28:15.897329 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS limit 10000
[0m06:28:15.898658 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m06:28:15.899831 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:28:15.900988 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:28:16.471604 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.572 seconds
[0m06:28:16.486105 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: Close
[0m06:28:16.492456 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.591 seconds
[0m06:28:16.510027 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m06:28:16.640742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01361ba4-069a-4e9d-8d2b-85ca19d4713d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38d47f4fe0>]}
[0m06:28:16.646077 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m06:28:16.650996 [info ] [MainThread]: 
[0m06:28:16.696013 [debug] [Thread-1 (]: Began running node model.stock_analytics.stg_market_data
[0m06:28:16.698508 [info ] [Thread-1 (]: 1 of 4 START sql view model ANALYTICS_ANALYTICS.stg_market_data ................ [RUN]
[0m06:28:16.701617 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS, now model.stock_analytics.stg_market_data)
[0m06:28:16.703117 [debug] [Thread-1 (]: Began compiling node model.stock_analytics.stg_market_data
[0m06:28:16.728736 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_analytics.stg_market_data"
[0m06:28:16.740012 [debug] [Thread-1 (]: Began executing node model.stock_analytics.stg_market_data
[0m06:28:16.838948 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_analytics.stg_market_data"
[0m06:28:16.847279 [debug] [Thread-1 (]: Using snowflake connection "model.stock_analytics.stg_market_data"
[0m06:28:16.849326 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.stg_market_data"} */
create or replace   view USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
  
   as (
    -- Staging view over RAW.MARKET_DATA
-- Keep it simple to avoid casting issues: RAW table already has proper types.

with src as (
  select * from USER_DB_HEDGEHOG.RAW.market_data
)

select
  date::date        as date,
  upper(symbol)     as symbol,
  open              as open,
  high              as high,
  low               as low,
  close             as close,
  volume            as volume
from src
  );
[0m06:28:16.850928 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:28:17.508023 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.656 seconds
[0m06:28:17.561895 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: Close
[0m06:28:17.674859 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01361ba4-069a-4e9d-8d2b-85ca19d4713d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38bb5d0350>]}
[0m06:28:17.677366 [info ] [Thread-1 (]: 1 of 4 OK created sql view model ANALYTICS_ANALYTICS.stg_market_data ........... [[32mSUCCESS 1[0m in 0.97s]
[0m06:28:17.680279 [debug] [Thread-1 (]: Finished running node model.stock_analytics.stg_market_data
[0m06:28:17.683832 [debug] [Thread-3 (]: Began running node model.stock_analytics.dim_calendar
[0m06:28:17.685235 [debug] [Thread-4 (]: Began running node model.stock_analytics.fact_prices
[0m06:28:17.691404 [debug] [Thread-2 (]: Began running node model.stock_analytics.indicators_ma_rsi
[0m06:28:17.693705 [info ] [Thread-3 (]: 2 of 4 START sql table model ANALYTICS_ANALYTICS.dim_calendar .................. [RUN]
[0m06:28:17.695954 [info ] [Thread-4 (]: 3 of 4 START sql table model ANALYTICS_ANALYTICS.fact_prices ................... [RUN]
[0m06:28:17.700948 [info ] [Thread-2 (]: 4 of 4 START sql table model ANALYTICS_ANALYTICS.indicators_ma_rsi ............. [RUN]
[0m06:28:17.704641 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.stock_analytics.dim_calendar'
[0m06:28:17.707715 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.stock_analytics.fact_prices'
[0m06:28:17.710868 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now model.stock_analytics.indicators_ma_rsi)
[0m06:28:17.712795 [debug] [Thread-3 (]: Began compiling node model.stock_analytics.dim_calendar
[0m06:28:17.714724 [debug] [Thread-4 (]: Began compiling node model.stock_analytics.fact_prices
[0m06:28:17.718589 [debug] [Thread-2 (]: Began compiling node model.stock_analytics.indicators_ma_rsi
[0m06:28:17.726941 [debug] [Thread-3 (]: Writing injected SQL for node "model.stock_analytics.dim_calendar"
[0m06:28:17.736519 [debug] [Thread-4 (]: Writing injected SQL for node "model.stock_analytics.fact_prices"
[0m06:28:17.750024 [debug] [Thread-2 (]: Writing injected SQL for node "model.stock_analytics.indicators_ma_rsi"
[0m06:28:17.756713 [debug] [Thread-4 (]: Began executing node model.stock_analytics.fact_prices
[0m06:28:17.771851 [debug] [Thread-3 (]: Began executing node model.stock_analytics.dim_calendar
[0m06:28:17.793046 [debug] [Thread-2 (]: Began executing node model.stock_analytics.indicators_ma_rsi
[0m06:28:17.870461 [debug] [Thread-4 (]: Writing runtime sql for node "model.stock_analytics.fact_prices"
[0m06:28:17.879661 [debug] [Thread-2 (]: Writing runtime sql for node "model.stock_analytics.indicators_ma_rsi"
[0m06:28:17.894418 [debug] [Thread-3 (]: Writing runtime sql for node "model.stock_analytics.dim_calendar"
[0m06:28:17.900942 [debug] [Thread-4 (]: Using snowflake connection "model.stock_analytics.fact_prices"
[0m06:28:17.905180 [debug] [Thread-2 (]: Using snowflake connection "model.stock_analytics.indicators_ma_rsi"
[0m06:28:17.906394 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.fact_prices"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.fact_prices
         as
        (-- Fact table: daily prices per symbol.

select
  m.date,
  m.symbol,
  m.open,
  m.high,
  m.low,
  m.close,
  m.volume
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data m
        );
[0m06:28:17.910584 [debug] [Thread-3 (]: Using snowflake connection "model.stock_analytics.dim_calendar"
[0m06:28:17.912164 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.indicators_ma_rsi"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.indicators_ma_rsi
         as
        (-- Indicators: Moving Averages and RSI (14-day)
--
-- This is used for the BI dashboard (Lab 2 requirement).

with src as (
  select * from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
),
ma as (
  select
    date,
    symbol,
    close,
    avg(close) over (
      partition by symbol
      order by date
      rows between 6 preceding and current row
    ) as ma_7,
    avg(close) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as ma_14,
    avg(close) over (
      partition by symbol
      order by date
      rows between 29 preceding and current row
    ) as ma_30,
    lag(close) over (
      partition by symbol
      order by date
    ) as prev_close
  from src
),
gains_losses as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    iff(prev_close is null, null, greatest(close - prev_close, 0)) as gain,
    iff(prev_close is null, null, greatest(prev_close - close, 0)) as loss
  from ma
),
rsi_window as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    avg(gain) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_gain_14,
    avg(loss) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_loss_14
  from gains_losses
)

select
  date,
  symbol,
  close,
  ma_7,
  ma_14,
  ma_30,
  case
    when avg_loss_14 is null or avg_loss_14 = 0 then null
    else 100 - (100 / (1 + (avg_gain_14 / avg_loss_14)))
  end as rsi_14
from rsi_window
        );
[0m06:28:17.914224 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m06:28:17.915994 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.dim_calendar"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.dim_calendar
         as
        (-- Simple calendar table covering ~2 years from the min date in staging data.

with bounds as (
  select
    min(date) as min_date
  from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
),
base as (
  select
    dateadd(day, seq4(), min_date) as date
  from bounds,
       table(generator(rowcount => 730)) -- 2 years
)

select
  date,
  year(date)              as year,
  month(date)             as month,
  day(date)               as day_of_month,
  dayname(date)           as day_name,
  week(date)              as week_of_year,
  to_char(date, 'YYYY-MM-DD') as date_key
from base
        );
[0m06:28:17.917719 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:28:17.921871 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m06:28:19.789444 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.867 seconds
[0m06:28:19.792878 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.879 seconds
[0m06:28:19.798978 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: Close
[0m06:28:19.804773 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: Close
[0m06:28:19.921196 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01361ba4-069a-4e9d-8d2b-85ca19d4713d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38bb3b9250>]}
[0m06:28:19.923518 [info ] [Thread-3 (]: 2 of 4 OK created sql table model ANALYTICS_ANALYTICS.dim_calendar ............. [[32mSUCCESS 1[0m in 2.22s]
[0m06:28:19.926733 [debug] [Thread-3 (]: Finished running node model.stock_analytics.dim_calendar
[0m06:28:19.946022 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01361ba4-069a-4e9d-8d2b-85ca19d4713d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38bb2c6900>]}
[0m06:28:19.951801 [info ] [Thread-4 (]: 3 of 4 OK created sql table model ANALYTICS_ANALYTICS.fact_prices .............. [[32mSUCCESS 1[0m in 2.24s]
[0m06:28:19.955037 [debug] [Thread-4 (]: Finished running node model.stock_analytics.fact_prices
[0m06:28:19.962694 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.045 seconds
[0m06:28:19.976486 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: Close
[0m06:28:20.088842 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01361ba4-069a-4e9d-8d2b-85ca19d4713d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38c13a9130>]}
[0m06:28:20.091974 [info ] [Thread-2 (]: 4 of 4 OK created sql table model ANALYTICS_ANALYTICS.indicators_ma_rsi ........ [[32mSUCCESS 1[0m in 2.38s]
[0m06:28:20.107276 [debug] [Thread-2 (]: Finished running node model.stock_analytics.indicators_ma_rsi
[0m06:28:20.136558 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:28:20.138538 [debug] [MainThread]: Connection 'model.stock_analytics.indicators_ma_rsi' was properly closed.
[0m06:28:20.140445 [debug] [MainThread]: Connection 'model.stock_analytics.stg_market_data' was properly closed.
[0m06:28:20.141814 [debug] [MainThread]: Connection 'model.stock_analytics.dim_calendar' was properly closed.
[0m06:28:20.144356 [debug] [MainThread]: Connection 'model.stock_analytics.fact_prices' was properly closed.
[0m06:28:20.146125 [info ] [MainThread]: 
[0m06:28:20.148975 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 5.01 seconds (5.01s).
[0m06:28:20.157524 [debug] [MainThread]: Command end result
[0m06:28:20.283895 [info ] [MainThread]: 
[0m06:28:20.285954 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:28:20.289090 [info ] [MainThread]: 
[0m06:28:20.290462 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m06:28:20.301632 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.137101, "process_user_time": 9.135016, "process_kernel_time": 0.868524, "process_mem_max_rss": "225716", "process_out_blocks": "2866", "process_in_blocks": "0"}
[0m06:28:20.306056 [debug] [MainThread]: Command `dbt run` succeeded at 06:28:20.305509 after 10.14 seconds
[0m06:28:20.308067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38d3217740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38c0adcb30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f38c2b4d160>]}
[0m06:28:20.309438 [debug] [MainThread]: Flushing usage events
[0m06:32:21.356671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4227db7e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f42258fc470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4225e1b5f0>]}


============================== 06:32:21.369260 | 2891d18f-ab47-48d8-b0c1-2319ebb88857 ==============================
[0m06:32:21.369260 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:32:21.371468 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt clean', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:32:21.558722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2891d18f-ab47-48d8-b0c1-2319ebb88857', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4225236450>]}
[0m06:32:21.612439 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.3827263, "process_user_time": 5.299797, "process_kernel_time": 0.315797, "process_mem_max_rss": "103276", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m06:32:21.615604 [debug] [MainThread]: Command `dbt clean` succeeded at 06:32:21.614398 after 0.39 seconds
[0m06:32:21.622397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4225612de0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4225254c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f42252574a0>]}
[0m06:32:21.625624 [debug] [MainThread]: Flushing usage events
[0m06:32:30.083223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec022876b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec029eb110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec02f7eba0>]}


============================== 06:32:30.100623 | e20b86f4-27bb-4e76-9cdc-ee721ae407db ==============================
[0m06:32:30.100623 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:32:30.103046 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m06:32:30.339549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e20b86f4-27bb-4e76-9cdc-ee721ae407db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec024e5f10>]}
[0m06:32:30.356347 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:32:30.360108 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:32:30.362428 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.39832455, "process_user_time": 3.334885, "process_kernel_time": 0.166035, "process_mem_max_rss": "103220", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m06:32:30.363746 [debug] [MainThread]: Command `dbt deps` succeeded at 06:32:30.363574 after 0.40 seconds
[0m06:32:30.365486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec022876b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec01dc3530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fec0475cb60>]}
[0m06:32:30.369954 [debug] [MainThread]: Flushing usage events
[0m06:32:42.257111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f691f0addf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f691fcb1a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f691f1bc350>]}


============================== 06:32:42.266262 | 3e9681d2-5e8e-4a93-a89c-b8c768366e08 ==============================
[0m06:32:42.266262 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:32:42.267661 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --target prod --profiles-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:32:43.904466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3e9681d2-5e8e-4a93-a89c-b8c768366e08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69073c12b0>]}
[0m06:32:44.014089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3e9681d2-5e8e-4a93-a89c-b8c768366e08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f691ff4f4a0>]}
[0m06:32:44.016864 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:32:44.067602 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m06:32:44.074087 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m06:32:44.076149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3e9681d2-5e8e-4a93-a89c-b8c768366e08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f690732c8c0>]}
[0m06:32:47.538343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3e9681d2-5e8e-4a93-a89c-b8c768366e08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f690665d1f0>]}
[0m06:32:47.858834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3e9681d2-5e8e-4a93-a89c-b8c768366e08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f69066700e0>]}
[0m06:32:47.862522 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m06:32:47.864576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3e9681d2-5e8e-4a93-a89c-b8c768366e08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f691f05bb60>]}
[0m06:32:47.870742 [info ] [MainThread]: 
[0m06:32:47.878511 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:32:47.896731 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m06:32:47.937321 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m06:32:47.938571 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m06:32:47.939643 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:32:48.360738 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m06:32:48.362219 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m06:32:48.363291 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_schemas
[0m06:32:48.364344 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m06:32:48.365610 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: No close available on handle
[0m06:32:48.367636 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:32:48.368821 [debug] [MainThread]: Connection 'list_USER_DB_HEDGEHOG' was properly closed.
[0m06:32:48.369812 [info ] [MainThread]: 
[0m06:32:48.371208 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.49 seconds (0.49s).
[0m06:32:48.373269 [error] [MainThread]: Encountered an error:
Runtime Error
  Database error while listing schemas in database "USER_DB_HEDGEHOG"
  Database Error
    250001 (08001): Failed to connect to DB: sfedu02-lvb17920.snowflakecomputing.com:443. Incorrect username or password was specified.
[0m06:32:48.376353 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.2188544, "process_user_time": 8.780345, "process_kernel_time": 0.762368, "process_mem_max_rss": "220840", "process_in_blocks": "16", "process_out_blocks": "1908", "command_success": false}
[0m06:32:48.383685 [debug] [MainThread]: Command `dbt run` failed at 06:32:48.383406 after 6.23 seconds
[0m06:32:48.387581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f691f803aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6906f00aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6906f00b60>]}
[0m06:32:48.389283 [debug] [MainThread]: Flushing usage events
[0m06:33:21.768851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd40962e990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd40c099c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd40962fb30>]}


============================== 06:33:21.778835 | d6cb0b96-4af0-42e0-8b14-221cb3a623dd ==============================
[0m06:33:21.778835 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:33:21.780431 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --target prod --profiles-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m06:33:23.283367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd6cb0b96-4af0-42e0-8b14-221cb3a623dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd40836df70>]}
[0m06:33:23.363547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd6cb0b96-4af0-42e0-8b14-221cb3a623dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f4b17ef0>]}
[0m06:33:23.365060 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:33:23.395129 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m06:33:23.653867 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:33:23.655306 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:33:23.744651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd6cb0b96-4af0-42e0-8b14-221cb3a623dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f490ae70>]}
[0m06:33:23.949481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd6cb0b96-4af0-42e0-8b14-221cb3a623dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f47bb500>]}
[0m06:33:23.950704 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m06:33:23.951811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6cb0b96-4af0-42e0-8b14-221cb3a623dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f45dcb30>]}
[0m06:33:23.956222 [info ] [MainThread]: 
[0m06:33:23.959822 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:33:23.979176 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m06:33:24.018350 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m06:33:24.020303 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m06:33:24.022214 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:33:24.536111 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.514 seconds
[0m06:33:24.539793 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m06:33:24.660602 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m06:33:24.671852 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS)
[0m06:33:24.699864 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"
[0m06:33:24.695593 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m06:33:24.701043 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS limit 10000
[0m06:33:24.702216 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m06:33:24.703574 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:33:24.704776 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:33:25.223252 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.518 seconds
[0m06:33:25.229213 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m06:33:25.423965 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.720 seconds
[0m06:33:25.429577 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS: Close
[0m06:33:25.550293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6cb0b96-4af0-42e0-8b14-221cb3a623dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f4b65160>]}
[0m06:33:25.552570 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m06:33:25.554414 [info ] [MainThread]: 
[0m06:33:25.593390 [debug] [Thread-1 (]: Began running node model.stock_analytics.stg_market_data
[0m06:33:25.595848 [info ] [Thread-1 (]: 1 of 4 START sql view model ANALYTICS_ANALYTICS.stg_market_data ................ [RUN]
[0m06:33:25.598645 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS_ANALYTICS, now model.stock_analytics.stg_market_data)
[0m06:33:25.600752 [debug] [Thread-1 (]: Began compiling node model.stock_analytics.stg_market_data
[0m06:33:25.620896 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_analytics.stg_market_data"
[0m06:33:25.631943 [debug] [Thread-1 (]: Began executing node model.stock_analytics.stg_market_data
[0m06:33:25.701964 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_analytics.stg_market_data"
[0m06:33:25.710317 [debug] [Thread-1 (]: Using snowflake connection "model.stock_analytics.stg_market_data"
[0m06:33:25.711387 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.stg_market_data"} */
create or replace   view USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
  
   as (
    -- Staging view over RAW.MARKET_DATA
-- Keep it simple to avoid casting issues: RAW table already has proper types.

with src as (
  select * from USER_DB_HEDGEHOG.RAW.market_data
)

select
  date::date        as date,
  upper(symbol)     as symbol,
  open              as open,
  high              as high,
  low               as low,
  close             as close,
  volume            as volume
from src
  );
[0m06:33:25.712389 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:33:26.297308 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.584 seconds
[0m06:33:26.364804 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: Close
[0m06:33:26.496497 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6cb0b96-4af0-42e0-8b14-221cb3a623dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f4ab0920>]}
[0m06:33:26.498631 [info ] [Thread-1 (]: 1 of 4 OK created sql view model ANALYTICS_ANALYTICS.stg_market_data ........... [[32mSUCCESS 1[0m in 0.89s]
[0m06:33:26.513011 [debug] [Thread-1 (]: Finished running node model.stock_analytics.stg_market_data
[0m06:33:26.541812 [debug] [Thread-3 (]: Began running node model.stock_analytics.dim_calendar
[0m06:33:26.543671 [debug] [Thread-4 (]: Began running node model.stock_analytics.fact_prices
[0m06:33:26.545063 [debug] [Thread-2 (]: Began running node model.stock_analytics.indicators_ma_rsi
[0m06:33:26.546379 [info ] [Thread-3 (]: 2 of 4 START sql table model ANALYTICS_ANALYTICS.dim_calendar .................. [RUN]
[0m06:33:26.548986 [info ] [Thread-4 (]: 3 of 4 START sql table model ANALYTICS_ANALYTICS.fact_prices ................... [RUN]
[0m06:33:26.551551 [info ] [Thread-2 (]: 4 of 4 START sql table model ANALYTICS_ANALYTICS.indicators_ma_rsi ............. [RUN]
[0m06:33:26.557730 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.stock_analytics.dim_calendar'
[0m06:33:26.559949 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.stock_analytics.fact_prices'
[0m06:33:26.563190 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now model.stock_analytics.indicators_ma_rsi)
[0m06:33:26.565029 [debug] [Thread-3 (]: Began compiling node model.stock_analytics.dim_calendar
[0m06:33:26.566413 [debug] [Thread-4 (]: Began compiling node model.stock_analytics.fact_prices
[0m06:33:26.567689 [debug] [Thread-2 (]: Began compiling node model.stock_analytics.indicators_ma_rsi
[0m06:33:26.578241 [debug] [Thread-3 (]: Writing injected SQL for node "model.stock_analytics.dim_calendar"
[0m06:33:26.584039 [debug] [Thread-4 (]: Writing injected SQL for node "model.stock_analytics.fact_prices"
[0m06:33:26.594141 [debug] [Thread-2 (]: Writing injected SQL for node "model.stock_analytics.indicators_ma_rsi"
[0m06:33:26.601628 [debug] [Thread-3 (]: Began executing node model.stock_analytics.dim_calendar
[0m06:33:26.611572 [debug] [Thread-2 (]: Began executing node model.stock_analytics.indicators_ma_rsi
[0m06:33:26.626687 [debug] [Thread-4 (]: Began executing node model.stock_analytics.fact_prices
[0m06:33:26.767195 [debug] [Thread-3 (]: Writing runtime sql for node "model.stock_analytics.dim_calendar"
[0m06:33:26.769699 [debug] [Thread-2 (]: Writing runtime sql for node "model.stock_analytics.indicators_ma_rsi"
[0m06:33:26.785945 [debug] [Thread-4 (]: Writing runtime sql for node "model.stock_analytics.fact_prices"
[0m06:33:26.797420 [debug] [Thread-3 (]: Using snowflake connection "model.stock_analytics.dim_calendar"
[0m06:33:26.799447 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.dim_calendar"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.dim_calendar
         as
        (-- Simple calendar table covering ~2 years from the min date in staging data.

with bounds as (
  select
    min(date) as min_date
  from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
),
base as (
  select
    dateadd(day, seq4(), min_date) as date
  from bounds,
       table(generator(rowcount => 730)) -- 2 years
)

select
  date,
  year(date)              as year,
  month(date)             as month,
  day(date)               as day_of_month,
  dayname(date)           as day_name,
  week(date)              as week_of_year,
  to_char(date, 'YYYY-MM-DD') as date_key
from base
        );
[0m06:33:26.813692 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m06:33:26.818007 [debug] [Thread-4 (]: Using snowflake connection "model.stock_analytics.fact_prices"
[0m06:33:26.822416 [debug] [Thread-2 (]: Using snowflake connection "model.stock_analytics.indicators_ma_rsi"
[0m06:33:26.829596 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.fact_prices"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.fact_prices
         as
        (-- Fact table: daily prices per symbol.

select
  m.date,
  m.symbol,
  m.open,
  m.high,
  m.low,
  m.close,
  m.volume
from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data m
        );
[0m06:33:26.837237 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.indicators_ma_rsi"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.indicators_ma_rsi
         as
        (-- Indicators: Moving Averages and RSI (14-day)
--
-- This is used for the BI dashboard (Lab 2 requirement).

with src as (
  select * from USER_DB_HEDGEHOG.ANALYTICS_ANALYTICS.stg_market_data
),
ma as (
  select
    date,
    symbol,
    close,
    avg(close) over (
      partition by symbol
      order by date
      rows between 6 preceding and current row
    ) as ma_7,
    avg(close) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as ma_14,
    avg(close) over (
      partition by symbol
      order by date
      rows between 29 preceding and current row
    ) as ma_30,
    lag(close) over (
      partition by symbol
      order by date
    ) as prev_close
  from src
),
gains_losses as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    iff(prev_close is null, null, greatest(close - prev_close, 0)) as gain,
    iff(prev_close is null, null, greatest(prev_close - close, 0)) as loss
  from ma
),
rsi_window as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    avg(gain) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_gain_14,
    avg(loss) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_loss_14
  from gains_losses
)

select
  date,
  symbol,
  close,
  ma_7,
  ma_14,
  ma_30,
  case
    when avg_loss_14 is null or avg_loss_14 = 0 then null
    else 100 - (100 / (1 + (avg_gain_14 / avg_loss_14)))
  end as rsi_14
from rsi_window
        );
[0m06:33:26.841701 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m06:33:26.846343 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:33:28.532849 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.692 seconds
[0m06:33:28.539216 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: Close
[0m06:33:28.547130 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.734 seconds
[0m06:33:28.551740 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: Close
[0m06:33:28.583681 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.738 seconds
[0m06:33:28.591563 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: Close
[0m06:33:28.657439 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6cb0b96-4af0-42e0-8b14-221cb3a623dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f441a150>]}
[0m06:33:28.659197 [info ] [Thread-3 (]: 2 of 4 OK created sql table model ANALYTICS_ANALYTICS.dim_calendar ............. [[32mSUCCESS 1[0m in 2.10s]
[0m06:33:28.661982 [debug] [Thread-3 (]: Finished running node model.stock_analytics.dim_calendar
[0m06:33:28.676429 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6cb0b96-4af0-42e0-8b14-221cb3a623dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f43dff50>]}
[0m06:33:28.678295 [info ] [Thread-4 (]: 3 of 4 OK created sql table model ANALYTICS_ANALYTICS.fact_prices .............. [[32mSUCCESS 1[0m in 2.12s]
[0m06:33:28.680677 [debug] [Thread-4 (]: Finished running node model.stock_analytics.fact_prices
[0m06:33:28.732897 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6cb0b96-4af0-42e0-8b14-221cb3a623dd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f443a2a0>]}
[0m06:33:28.736766 [info ] [Thread-2 (]: 4 of 4 OK created sql table model ANALYTICS_ANALYTICS.indicators_ma_rsi ........ [[32mSUCCESS 1[0m in 2.17s]
[0m06:33:28.742533 [debug] [Thread-2 (]: Finished running node model.stock_analytics.indicators_ma_rsi
[0m06:33:28.759997 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:33:28.762685 [debug] [MainThread]: Connection 'model.stock_analytics.stg_market_data' was properly closed.
[0m06:33:28.764391 [debug] [MainThread]: Connection 'model.stock_analytics.indicators_ma_rsi' was properly closed.
[0m06:33:28.766305 [debug] [MainThread]: Connection 'model.stock_analytics.dim_calendar' was properly closed.
[0m06:33:28.767849 [debug] [MainThread]: Connection 'model.stock_analytics.fact_prices' was properly closed.
[0m06:33:28.770863 [info ] [MainThread]: 
[0m06:33:28.774702 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 4.81 seconds (4.81s).
[0m06:33:28.782823 [debug] [MainThread]: Command end result
[0m06:33:29.132468 [info ] [MainThread]: 
[0m06:33:29.134179 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:33:29.138559 [info ] [MainThread]: 
[0m06:33:29.141960 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m06:33:29.148126 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.4729147, "process_user_time": 6.760718, "process_kernel_time": 0.846011, "process_mem_max_rss": "220368", "process_out_blocks": "1942", "process_in_blocks": "0"}
[0m06:33:29.152417 [debug] [MainThread]: Command `dbt run` succeeded at 06:33:29.151371 after 7.48 seconds
[0m06:33:29.158290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd408ee1340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd4089ed010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3f43956d0>]}
[0m06:33:29.164225 [debug] [MainThread]: Flushing usage events
[0m06:51:30.081495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb67e1a7020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb67eb5b560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb67e571e80>]}


============================== 06:51:30.091692 | 84e7b4b7-53d4-4947-a321-f0318e1ad219 ==============================
[0m06:51:30.091692 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:51:30.093291 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt clean', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:51:30.282925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84e7b4b7-53d4-4947-a321-f0318e1ad219', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb67e7ee000>]}
[0m06:51:30.339908 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.34551302, "process_user_time": 3.189422, "process_kernel_time": 0.250371, "process_mem_max_rss": "103180", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m06:51:30.343952 [debug] [MainThread]: Command `dbt clean` succeeded at 06:51:30.342918 after 0.35 seconds
[0m06:51:30.349797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb67e4c44a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb681e67320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb67e13c410>]}
[0m06:51:30.352643 [debug] [MainThread]: Flushing usage events
[0m06:51:38.628408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd1c871910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd1c8c2090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd1cf05ca0>]}


============================== 06:51:38.637058 | 1140a283-4dca-4a5e-b0cd-d54bf01d3832 ==============================
[0m06:51:38.637058 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:51:38.638673 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m06:51:38.812993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1140a283-4dca-4a5e-b0cd-d54bf01d3832', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd1c495be0>]}
[0m06:51:38.829510 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:51:38.833978 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m06:51:38.836240 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.30537987, "process_user_time": 3.410476, "process_kernel_time": 0.204547, "process_mem_max_rss": "103288", "process_out_blocks": "3", "process_in_blocks": "0"}
[0m06:51:38.838460 [debug] [MainThread]: Command `dbt deps` succeeded at 06:51:38.838215 after 0.31 seconds
[0m06:51:38.841241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd1c871910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd1cac6c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fbd1c495fd0>]}
[0m06:51:38.848748 [debug] [MainThread]: Flushing usage events
[0m06:51:52.399555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2067e78e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f20686becf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2067e78b30>]}


============================== 06:51:52.408351 | c69b3d91-528a-487a-aac8-8c66b322fdc1 ==============================
[0m06:51:52.408351 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:51:52.409991 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --target prod --profiles-dir /opt/airflow/dbt', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:51:54.194872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c69b3d91-528a-487a-aac8-8c66b322fdc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f206882a2a0>]}
[0m06:51:54.283428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c69b3d91-528a-487a-aac8-8c66b322fdc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2054edce90>]}
[0m06:51:54.285100 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:51:54.333539 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m06:51:54.336931 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m06:51:54.339168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c69b3d91-528a-487a-aac8-8c66b322fdc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f206846da00>]}
[0m06:51:57.279710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c69b3d91-528a-487a-aac8-8c66b322fdc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f204f4c1340>]}
[0m06:51:57.579977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c69b3d91-528a-487a-aac8-8c66b322fdc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f204f5f7860>]}
[0m06:51:57.583562 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m06:51:57.586894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c69b3d91-528a-487a-aac8-8c66b322fdc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f204f5d49b0>]}
[0m06:51:57.598857 [info ] [MainThread]: 
[0m06:51:57.602188 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:51:57.630051 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m06:51:57.680177 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m06:51:57.681372 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m06:51:57.682455 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:51:58.351502 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.669 seconds
[0m06:51:58.357615 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m06:51:58.477024 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS)
[0m06:51:58.499640 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m06:51:58.500917 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m06:51:58.502973 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:51:58.996612 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.494 seconds
[0m06:51:59.008139 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m06:51:59.135975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c69b3d91-528a-487a-aac8-8c66b322fdc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2067611eb0>]}
[0m06:51:59.138370 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m06:51:59.147210 [info ] [MainThread]: 
[0m06:51:59.199595 [debug] [Thread-1 (]: Began running node model.stock_analytics.stg_market_data
[0m06:51:59.202934 [info ] [Thread-1 (]: 1 of 4 START sql view model ANALYTICS.stg_market_data .......................... [RUN]
[0m06:51:59.214443 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now model.stock_analytics.stg_market_data)
[0m06:51:59.220043 [debug] [Thread-1 (]: Began compiling node model.stock_analytics.stg_market_data
[0m06:51:59.254748 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_analytics.stg_market_data"
[0m06:51:59.265309 [debug] [Thread-1 (]: Began executing node model.stock_analytics.stg_market_data
[0m06:51:59.421784 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_analytics.stg_market_data"
[0m06:51:59.434042 [debug] [Thread-1 (]: Using snowflake connection "model.stock_analytics.stg_market_data"
[0m06:51:59.435889 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.stg_market_data"} */
create or replace   view USER_DB_HEDGEHOG.ANALYTICS.stg_market_data
  
   as (
    -- Staging view over RAW.MARKET_DATA
-- Keep it simple to avoid casting issues: RAW table already has proper types.

with src as (
  select * from USER_DB_HEDGEHOG.RAW.market_data
)

select
  date::date        as date,
  upper(symbol)     as symbol,
  open              as open,
  high              as high,
  low               as low,
  close             as close,
  volume            as volume
from src
  );
[0m06:51:59.438327 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:52:00.012570 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.574 seconds
[0m06:52:00.088053 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: Close
[0m06:52:00.217552 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c69b3d91-528a-487a-aac8-8c66b322fdc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f205423c890>]}
[0m06:52:00.220298 [info ] [Thread-1 (]: 1 of 4 OK created sql view model ANALYTICS.stg_market_data ..................... [[32mSUCCESS 1[0m in 1.00s]
[0m06:52:00.223388 [debug] [Thread-1 (]: Finished running node model.stock_analytics.stg_market_data
[0m06:52:00.227341 [debug] [Thread-3 (]: Began running node model.stock_analytics.dim_calendar
[0m06:52:00.231469 [debug] [Thread-4 (]: Began running node model.stock_analytics.fact_prices
[0m06:52:00.235408 [debug] [Thread-2 (]: Began running node model.stock_analytics.indicators_ma_rsi
[0m06:52:00.237663 [info ] [Thread-3 (]: 2 of 4 START sql table model ANALYTICS.dim_calendar ............................ [RUN]
[0m06:52:00.243855 [info ] [Thread-4 (]: 3 of 4 START sql table model ANALYTICS.fact_prices ............................. [RUN]
[0m06:52:00.247136 [info ] [Thread-2 (]: 4 of 4 START sql table model ANALYTICS.indicators_ma_rsi ....................... [RUN]
[0m06:52:00.251137 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.stock_analytics.dim_calendar'
[0m06:52:00.253891 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.stock_analytics.fact_prices'
[0m06:52:00.259771 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.stock_analytics.indicators_ma_rsi'
[0m06:52:00.263330 [debug] [Thread-3 (]: Began compiling node model.stock_analytics.dim_calendar
[0m06:52:00.265446 [debug] [Thread-4 (]: Began compiling node model.stock_analytics.fact_prices
[0m06:52:00.267877 [debug] [Thread-2 (]: Began compiling node model.stock_analytics.indicators_ma_rsi
[0m06:52:00.283650 [debug] [Thread-3 (]: Writing injected SQL for node "model.stock_analytics.dim_calendar"
[0m06:52:00.298255 [debug] [Thread-4 (]: Writing injected SQL for node "model.stock_analytics.fact_prices"
[0m06:52:00.311480 [debug] [Thread-2 (]: Writing injected SQL for node "model.stock_analytics.indicators_ma_rsi"
[0m06:52:00.319276 [debug] [Thread-3 (]: Began executing node model.stock_analytics.dim_calendar
[0m06:52:00.327588 [debug] [Thread-4 (]: Began executing node model.stock_analytics.fact_prices
[0m06:52:00.329886 [debug] [Thread-2 (]: Began executing node model.stock_analytics.indicators_ma_rsi
[0m06:52:00.477691 [debug] [Thread-3 (]: Writing runtime sql for node "model.stock_analytics.dim_calendar"
[0m06:52:00.605433 [debug] [Thread-2 (]: Writing runtime sql for node "model.stock_analytics.indicators_ma_rsi"
[0m06:52:00.672215 [debug] [Thread-4 (]: Writing runtime sql for node "model.stock_analytics.fact_prices"
[0m06:52:00.685693 [debug] [Thread-4 (]: Using snowflake connection "model.stock_analytics.fact_prices"
[0m06:52:00.695124 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.fact_prices"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS.fact_prices
         as
        (-- Fact table: daily prices per symbol.

select
  m.date,
  m.symbol,
  m.open,
  m.high,
  m.low,
  m.close,
  m.volume
from USER_DB_HEDGEHOG.ANALYTICS.stg_market_data m
        );
[0m06:52:00.698415 [debug] [Thread-3 (]: Using snowflake connection "model.stock_analytics.dim_calendar"
[0m06:52:00.709436 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.dim_calendar"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS.dim_calendar
         as
        (-- Simple calendar table covering ~2 years from the min date in staging data.

with bounds as (
  select
    min(date) as min_date
  from USER_DB_HEDGEHOG.ANALYTICS.stg_market_data
),
base as (
  select
    dateadd(day, seq4(), min_date) as date
  from bounds,
       table(generator(rowcount => 730)) -- 2 years
)

select
  date,
  year(date)              as year,
  month(date)             as month,
  day(date)               as day_of_month,
  dayname(date)           as day_name,
  week(date)              as week_of_year,
  to_char(date, 'YYYY-MM-DD') as date_key
from base
        );
[0m06:52:00.700451 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m06:52:00.712238 [debug] [Thread-2 (]: Using snowflake connection "model.stock_analytics.indicators_ma_rsi"
[0m06:52:00.714422 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m06:52:00.723040 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.indicators_ma_rsi"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS.indicators_ma_rsi
         as
        (-- Indicators: Moving Averages and RSI (14-day)
--
-- This is used for the BI dashboard (Lab 2 requirement).

with src as (
  select * from USER_DB_HEDGEHOG.ANALYTICS.stg_market_data
),
ma as (
  select
    date,
    symbol,
    close,
    avg(close) over (
      partition by symbol
      order by date
      rows between 6 preceding and current row
    ) as ma_7,
    avg(close) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as ma_14,
    avg(close) over (
      partition by symbol
      order by date
      rows between 29 preceding and current row
    ) as ma_30,
    lag(close) over (
      partition by symbol
      order by date
    ) as prev_close
  from src
),
gains_losses as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    iff(prev_close is null, null, greatest(close - prev_close, 0)) as gain,
    iff(prev_close is null, null, greatest(prev_close - close, 0)) as loss
  from ma
),
rsi_window as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    avg(gain) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_gain_14,
    avg(loss) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_loss_14
  from gains_losses
)

select
  date,
  symbol,
  close,
  ma_7,
  ma_14,
  ma_30,
  case
    when avg_loss_14 is null or avg_loss_14 = 0 then null
    else 100 - (100 / (1 + (avg_gain_14 / avg_loss_14)))
  end as rsi_14
from rsi_window
        );
[0m06:52:00.738262 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m06:52:02.469605 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.734 seconds
[0m06:52:02.473233 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.773 seconds
[0m06:52:02.478035 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: Close
[0m06:52:02.480578 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.766 seconds
[0m06:52:02.485287 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: Close
[0m06:52:02.493309 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: Close
[0m06:52:02.613038 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c69b3d91-528a-487a-aac8-8c66b322fdc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f204fefc5c0>]}
[0m06:52:02.618293 [info ] [Thread-3 (]: 2 of 4 OK created sql table model ANALYTICS.dim_calendar ....................... [[32mSUCCESS 1[0m in 2.36s]
[0m06:52:02.622872 [debug] [Thread-3 (]: Finished running node model.stock_analytics.dim_calendar
[0m06:52:02.625418 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c69b3d91-528a-487a-aac8-8c66b322fdc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f204ff3ea50>]}
[0m06:52:02.631271 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c69b3d91-528a-487a-aac8-8c66b322fdc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f204ff3e7b0>]}
[0m06:52:02.636096 [info ] [Thread-2 (]: 4 of 4 OK created sql table model ANALYTICS.indicators_ma_rsi .................. [[32mSUCCESS 1[0m in 2.37s]
[0m06:52:02.652404 [debug] [Thread-2 (]: Finished running node model.stock_analytics.indicators_ma_rsi
[0m06:52:02.644639 [info ] [Thread-4 (]: 3 of 4 OK created sql table model ANALYTICS.fact_prices ........................ [[32mSUCCESS 1[0m in 2.38s]
[0m06:52:02.657547 [debug] [Thread-4 (]: Finished running node model.stock_analytics.fact_prices
[0m06:52:02.667254 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:52:02.668891 [debug] [MainThread]: Connection 'model.stock_analytics.stg_market_data' was properly closed.
[0m06:52:02.670205 [debug] [MainThread]: Connection 'model.stock_analytics.dim_calendar' was properly closed.
[0m06:52:02.671573 [debug] [MainThread]: Connection 'model.stock_analytics.fact_prices' was properly closed.
[0m06:52:02.675394 [debug] [MainThread]: Connection 'model.stock_analytics.indicators_ma_rsi' was properly closed.
[0m06:52:02.678089 [info ] [MainThread]: 
[0m06:52:02.680110 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 5.08 seconds (5.08s).
[0m06:52:02.688896 [debug] [MainThread]: Command end result
[0m06:52:02.822344 [info ] [MainThread]: 
[0m06:52:02.823902 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:52:02.825509 [info ] [MainThread]: 
[0m06:52:02.827367 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m06:52:02.839187 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.523481, "process_user_time": 10.093751, "process_kernel_time": 0.730036, "process_mem_max_rss": "225512", "process_out_blocks": "2862", "process_in_blocks": "0"}
[0m06:52:02.856597 [debug] [MainThread]: Command `dbt run` succeeded at 06:52:02.855774 after 10.54 seconds
[0m06:52:02.863366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f206896fd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2067e79df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f205473fcb0>]}
[0m06:52:02.867572 [debug] [MainThread]: Flushing usage events
[0m06:52:32.181142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0498366510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f049baa7b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0498963b30>]}


============================== 06:52:32.190075 | b68e5c63-c8b4-4e53-9668-5d4416d252a2 ==============================
[0m06:52:32.190075 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:52:32.192095 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt snapshot --target prod --profiles-dir /opt/airflow/dbt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:52:33.796036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b68e5c63-c8b4-4e53-9668-5d4416d252a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0484993bf0>]}
[0m06:52:33.869727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b68e5c63-c8b4-4e53-9668-5d4416d252a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f04855e5eb0>]}
[0m06:52:33.871177 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:52:33.909917 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m06:52:34.167629 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:52:34.168554 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:52:34.249963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b68e5c63-c8b4-4e53-9668-5d4416d252a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0484970110>]}
[0m06:52:34.456710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b68e5c63-c8b4-4e53-9668-5d4416d252a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f048469f410>]}
[0m06:52:34.457820 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m06:52:34.458985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b68e5c63-c8b4-4e53-9668-5d4416d252a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f048481e5a0>]}
[0m06:52:34.463014 [info ] [MainThread]: 
[0m06:52:34.464917 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:52:34.474923 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m06:52:34.517992 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m06:52:34.520101 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m06:52:34.521830 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:52:34.988061 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.466 seconds
[0m06:52:34.992835 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m06:52:35.138954 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS)
[0m06:52:35.159004 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m06:52:35.160201 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m06:52:35.161194 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m06:52:35.565150 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.404 seconds
[0m06:52:35.571731 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m06:52:35.697192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b68e5c63-c8b4-4e53-9668-5d4416d252a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f04846810a0>]}
[0m06:52:35.699951 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m06:52:35.701911 [info ] [MainThread]: 
[0m06:52:35.733373 [debug] [Thread-1 (]: Began running node snapshot.stock_analytics.snap_market_data
[0m06:52:35.735711 [info ] [Thread-1 (]: 1 of 1 START snapshot ANALYTICS.snap_market_data ............................... [RUN]
[0m06:52:35.738854 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now snapshot.stock_analytics.snap_market_data)
[0m06:52:35.740648 [debug] [Thread-1 (]: Began compiling node snapshot.stock_analytics.snap_market_data
[0m06:52:35.774761 [debug] [Thread-1 (]: Began executing node snapshot.stock_analytics.snap_market_data
[0m06:52:35.942934 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:35.944084 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        select close, volume from (
                



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m06:52:35.945344 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:52:36.485964 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.540 seconds
[0m06:52:36.508706 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:36.510751 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m06:52:36.601669 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.089 seconds
[0m06:52:36.620583 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:36.622010 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m06:52:36.725864 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.102 seconds
[0m06:52:36.794643 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:36.796369 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
create or replace temporary table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
         as
        (

    with snapshot_query as (

        



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data


    ),

    snapshotted_data as (

        select *,
            snapshot_key as dbt_unique_key

        from "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(snapshot_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m06:52:37.713010 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.915 seconds
[0m06:52:37.721129 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:37.723086 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m06:52:37.817920 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.093 seconds
[0m06:52:37.828635 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:37.830200 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m06:52:37.925891 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.094 seconds
[0m06:52:37.937100 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:37.938795 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m06:52:38.055946 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.115 seconds
[0m06:52:38.066672 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:38.068576 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m06:52:38.185041 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.114 seconds
[0m06:52:38.218021 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:38.220219 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m06:52:38.330074 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.108 seconds
[0m06:52:38.373960 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:38.375836 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
/* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        

    with snapshot_query as (

        



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data


    ),

    snapshotted_data as (

        select *,
            snapshot_key as dbt_unique_key

        from "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(snapshot_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

    ) as __dbt_sbq
    where false
    limit 0
[0m06:52:38.760529 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.383 seconds
[0m06:52:38.770151 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:38.771837 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
/* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m06:52:38.854172 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.081 seconds
[0m06:52:38.855810 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.stock_analytics.snap_market_data"
[0m06:52:38.862812 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:38.864047 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
BEGIN
[0m06:52:39.026814 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.161 seconds
[0m06:52:39.029528 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:39.031470 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
merge into "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA" as DBT_INTERNAL_DEST
    using "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SNAPSHOT_KEY", "DATE", "SYMBOL", "CLOSE", "VOLUME", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SNAPSHOT_KEY", "DATE", "SYMBOL", "CLOSE", "VOLUME", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m06:52:39.744830 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.711 seconds
[0m06:52:39.747352 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m06:52:39.748944 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
COMMIT
[0m06:52:40.049015 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.298 seconds
[0m06:52:40.089733 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: Close
[0m06:52:40.204456 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b68e5c63-c8b4-4e53-9668-5d4416d252a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0484b506e0>]}
[0m06:52:40.206872 [info ] [Thread-1 (]: 1 of 1 OK snapshotted ANALYTICS.snap_market_data ............................... [[32mSUCCESS 0[0m in 4.46s]
[0m06:52:40.209516 [debug] [Thread-1 (]: Finished running node snapshot.stock_analytics.snap_market_data
[0m06:52:40.214922 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:52:40.219699 [debug] [MainThread]: Connection 'snapshot.stock_analytics.snap_market_data' was properly closed.
[0m06:52:40.222139 [info ] [MainThread]: 
[0m06:52:40.225001 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 5.76 seconds (5.76s).
[0m06:52:40.234160 [debug] [MainThread]: Command end result
[0m06:52:40.374720 [info ] [MainThread]: 
[0m06:52:40.381449 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:52:40.389515 [info ] [MainThread]: 
[0m06:52:40.391882 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m06:52:40.399362 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 8.300425, "process_user_time": 6.583657, "process_kernel_time": 0.733144, "process_mem_max_rss": "217068", "process_out_blocks": "1925", "process_in_blocks": "0"}
[0m06:52:40.403979 [debug] [MainThread]: Command `dbt snapshot` succeeded at 06:52:40.403610 after 8.31 seconds
[0m06:52:40.405954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f049985fa40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0484af1370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f04996ca420>]}
[0m06:52:40.407823 [debug] [MainThread]: Flushing usage events
[0m06:52:54.200743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f789df12840>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f789c0fefc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f789c727050>]}


============================== 06:52:54.209392 | 1e4ab662-675f-4608-bc7f-590473dddbc1 ==============================
[0m06:52:54.209392 [info ] [MainThread]: Running with dbt=1.8.8
[0m06:52:54.210931 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt test --target prod --profiles-dir /opt/airflow/dbt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m06:52:55.620804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e4ab662-675f-4608-bc7f-590473dddbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7883f857f0>]}
[0m06:52:55.701847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1e4ab662-675f-4608-bc7f-590473dddbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7883a61a00>]}
[0m06:52:55.703480 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m06:52:55.734449 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m06:52:55.992296 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m06:52:55.993462 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m06:52:56.100978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1e4ab662-675f-4608-bc7f-590473dddbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7883931a90>]}
[0m06:52:56.330002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1e4ab662-675f-4608-bc7f-590473dddbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7883518140>]}
[0m06:52:56.331286 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m06:52:56.332348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e4ab662-675f-4608-bc7f-590473dddbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f78835ef0e0>]}
[0m06:52:56.337686 [info ] [MainThread]: 
[0m06:52:56.347378 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m06:52:56.364105 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m06:52:56.407093 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m06:52:56.408305 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m06:52:56.409616 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:52:56.917522 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.508 seconds
[0m06:52:56.923282 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m06:52:57.044592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e4ab662-675f-4608-bc7f-590473dddbc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f78899ba720>]}
[0m06:52:57.046283 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m06:52:57.047626 [info ] [MainThread]: 
[0m06:52:57.073364 [debug] [Thread-1 (]: Began running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m06:52:57.074898 [debug] [Thread-2 (]: Began running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m06:52:57.077921 [debug] [Thread-3 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m06:52:57.079571 [info ] [Thread-1 (]: 1 of 7 START test not_null_fact_prices_date .................................... [RUN]
[0m06:52:57.081912 [debug] [Thread-4 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m06:52:57.083542 [info ] [Thread-2 (]: 2 of 7 START test not_null_fact_prices_symbol .................................. [RUN]
[0m06:52:57.085694 [info ] [Thread-3 (]: 3 of 7 START test not_null_indicators_ma_rsi_date .............................. [RUN]
[0m06:52:57.089667 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5)
[0m06:52:57.098039 [info ] [Thread-4 (]: 4 of 7 START test not_null_indicators_ma_rsi_symbol ............................ [RUN]
[0m06:52:57.100948 [debug] [Thread-2 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1'
[0m06:52:57.102989 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207'
[0m06:52:57.105392 [debug] [Thread-1 (]: Began compiling node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m06:52:57.117960 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94'
[0m06:52:57.120327 [debug] [Thread-2 (]: Began compiling node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m06:52:57.124031 [debug] [Thread-3 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m06:52:57.213657 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m06:52:57.154493 [debug] [Thread-4 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m06:52:57.225484 [debug] [Thread-3 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m06:52:57.226664 [debug] [Thread-2 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m06:52:57.236722 [debug] [Thread-4 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m06:52:57.240711 [debug] [Thread-1 (]: Began executing node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m06:52:57.260762 [debug] [Thread-3 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m06:52:57.282416 [debug] [Thread-2 (]: Began executing node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m06:52:57.297206 [debug] [Thread-4 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m06:52:57.308226 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m06:52:57.312944 [debug] [Thread-2 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m06:52:57.326464 [debug] [Thread-4 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m06:52:57.333282 [debug] [Thread-3 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m06:52:57.341587 [debug] [Thread-1 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m06:52:57.343989 [debug] [Thread-2 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m06:52:57.345326 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS.fact_prices
where date is null



      
    ) dbt_internal_test
[0m06:52:57.347771 [debug] [Thread-3 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m06:52:57.350548 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS.fact_prices
where symbol is null



      
    ) dbt_internal_test
[0m06:52:57.352481 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:52:57.354032 [debug] [Thread-4 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m06:52:57.354913 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS.indicators_ma_rsi
where date is null



      
    ) dbt_internal_test
[0m06:52:57.356087 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m06:52:57.362334 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS.indicators_ma_rsi
where symbol is null



      
    ) dbt_internal_test
[0m06:52:57.364548 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m06:52:57.370837 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m06:52:57.970604 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.600 seconds
[0m06:52:57.999871 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: Close
[0m06:52:58.001889 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.649 seconds
[0m06:52:58.011448 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: Close
[0m06:52:58.024939 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.669 seconds
[0m06:52:58.030338 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: Close
[0m06:52:58.033015 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.669 seconds
[0m06:52:58.041282 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: Close
[0m06:52:58.126016 [info ] [Thread-4 (]: 4 of 7 PASS not_null_indicators_ma_rsi_symbol .................................. [[32mPASS[0m in 1.01s]
[0m06:52:58.131771 [debug] [Thread-4 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m06:52:58.129454 [info ] [Thread-1 (]: 1 of 7 PASS not_null_fact_prices_date .......................................... [[32mPASS[0m in 1.04s]
[0m06:52:58.139598 [debug] [Thread-4 (]: Began running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m06:52:58.142735 [debug] [Thread-1 (]: Finished running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m06:52:58.144585 [info ] [Thread-4 (]: 5 of 7 START test not_null_snap_market_data_snapshot_key ....................... [RUN]
[0m06:52:58.146894 [debug] [Thread-1 (]: Began running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m06:52:58.148655 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94, now test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0)
[0m06:52:58.150388 [info ] [Thread-1 (]: 6 of 7 START test not_null_stg_market_data_date ................................ [RUN]
[0m06:52:58.156977 [debug] [Thread-4 (]: Began compiling node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m06:52:58.159879 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5, now test.stock_analytics.not_null_stg_market_data_date.fb73c94489)
[0m06:52:58.174015 [debug] [Thread-1 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m06:52:58.183912 [debug] [Thread-4 (]: Writing injected SQL for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m06:52:58.208393 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m06:52:58.218824 [info ] [Thread-2 (]: 2 of 7 PASS not_null_fact_prices_symbol ........................................ [[32mPASS[0m in 1.12s]
[0m06:52:58.222266 [info ] [Thread-3 (]: 3 of 7 PASS not_null_indicators_ma_rsi_date .................................... [[32mPASS[0m in 1.12s]
[0m06:52:58.227478 [debug] [Thread-2 (]: Finished running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m06:52:58.231472 [debug] [Thread-3 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m06:52:58.233632 [debug] [Thread-4 (]: Began executing node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m06:52:58.236652 [debug] [Thread-1 (]: Began executing node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m06:52:58.238566 [debug] [Thread-2 (]: Began running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m06:52:58.255840 [debug] [Thread-4 (]: Writing runtime sql for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m06:52:58.269034 [info ] [Thread-2 (]: 7 of 7 START test not_null_stg_market_data_symbol .............................. [RUN]
[0m06:52:58.267979 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m06:52:58.271931 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1, now test.stock_analytics.not_null_stg_market_data_symbol.478198cf66)
[0m06:52:58.275107 [debug] [Thread-2 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m06:52:58.297784 [debug] [Thread-4 (]: Using snowflake connection "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m06:52:58.301067 [debug] [Thread-1 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m06:52:58.312019 [debug] [Thread-4 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select snapshot_key
from USER_DB_HEDGEHOG.ANALYTICS.snap_market_data
where snapshot_key is null



      
    ) dbt_internal_test
[0m06:52:58.313836 [debug] [Thread-2 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m06:52:58.315061 [debug] [Thread-1 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS.stg_market_data
where date is null



      
    ) dbt_internal_test
[0m06:52:58.316830 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m06:52:58.319289 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m06:52:58.326470 [debug] [Thread-2 (]: Began executing node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m06:52:58.344255 [debug] [Thread-2 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m06:52:58.356255 [debug] [Thread-2 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m06:52:58.359360 [debug] [Thread-2 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS.stg_market_data
where symbol is null



      
    ) dbt_internal_test
[0m06:52:58.362761 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m06:52:58.852929 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.491 seconds
[0m06:52:58.859706 [debug] [Thread-2 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: Close
[0m06:52:58.920315 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.601 seconds
[0m06:52:58.925780 [debug] [Thread-1 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: Close
[0m06:52:58.992467 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.675 seconds
[0m06:52:59.002189 [debug] [Thread-4 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: Close
[0m06:52:58.995567 [info ] [Thread-2 (]: 7 of 7 PASS not_null_stg_market_data_symbol .................................... [[32mPASS[0m in 0.72s]
[0m06:52:59.014505 [debug] [Thread-2 (]: Finished running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m06:52:59.068493 [info ] [Thread-1 (]: 6 of 7 PASS not_null_stg_market_data_date ...................................... [[32mPASS[0m in 0.91s]
[0m06:52:59.072811 [debug] [Thread-1 (]: Finished running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m06:52:59.139369 [info ] [Thread-4 (]: 5 of 7 PASS not_null_snap_market_data_snapshot_key ............................. [[32mPASS[0m in 0.99s]
[0m06:52:59.143292 [debug] [Thread-4 (]: Finished running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m06:52:59.158157 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:52:59.162377 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_date.fb73c94489' was properly closed.
[0m06:52:59.166812 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_symbol.478198cf66' was properly closed.
[0m06:52:59.168796 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207' was properly closed.
[0m06:52:59.170500 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0' was properly closed.
[0m06:52:59.172389 [info ] [MainThread]: 
[0m06:52:59.175006 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 2.83 seconds (2.83s).
[0m06:52:59.186618 [debug] [MainThread]: Command end result
[0m06:52:59.345795 [info ] [MainThread]: 
[0m06:52:59.347847 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:52:59.349843 [info ] [MainThread]: 
[0m06:52:59.351904 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m06:52:59.358143 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 5.241995, "process_user_time": 6.637831, "process_kernel_time": 0.77142, "process_mem_max_rss": "221772", "process_out_blocks": "1938", "process_in_blocks": "0"}
[0m06:52:59.363324 [debug] [MainThread]: Command `dbt test` succeeded at 06:52:59.362858 after 5.25 seconds
[0m06:52:59.365209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f789df12840>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f789aec9f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f789e16c440>]}
[0m06:52:59.367026 [debug] [MainThread]: Flushing usage events
[0m19:27:33.938683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f71bb33c9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f71ba88a1b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f71ba70a660>]}


============================== 19:27:33.950673 | b8b87ed0-bcd0-46c3-a3fe-f0630a2a58e8 ==============================
[0m19:27:33.950673 [info ] [MainThread]: Running with dbt=1.8.8
[0m19:27:33.952458 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt deps --profiles-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m19:27:34.787221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8b87ed0-bcd0-46c3-a3fe-f0630a2a58e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f71bba1b9b0>]}
[0m19:27:34.835991 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m19:27:34.845691 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m19:27:34.858463 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 1.0499111, "process_user_time": 4.861171, "process_kernel_time": 0.697487, "process_mem_max_rss": "103384", "process_in_blocks": "88", "process_out_blocks": "3"}
[0m19:27:34.864472 [debug] [MainThread]: Command `dbt deps` succeeded at 19:27:34.862293 after 1.05 seconds
[0m19:27:34.867190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f71ba0da210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f71b9fafd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f71b9faed50>]}
[0m19:27:34.868546 [debug] [MainThread]: Flushing usage events
[0m19:27:51.960312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6d764ede0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6d8e29820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6d810f320>]}


============================== 19:27:51.974072 | f455bb72-fd43-4e17-a12b-83e0cf7bf013 ==============================
[0m19:27:51.974072 [info ] [MainThread]: Running with dbt=1.8.8
[0m19:27:51.975850 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --target prod --profiles-dir /opt/airflow/dbt', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:27:55.710535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f455bb72-fd43-4e17-a12b-83e0cf7bf013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6d714f920>]}
[0m19:27:55.808813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f455bb72-fd43-4e17-a12b-83e0cf7bf013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6c45c93a0>]}
[0m19:27:55.810622 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:27:55.853707 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m19:27:56.227279 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:27:56.229788 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:27:56.332706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f455bb72-fd43-4e17-a12b-83e0cf7bf013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6be612cf0>]}
[0m19:27:56.745049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f455bb72-fd43-4e17-a12b-83e0cf7bf013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6be3ce960>]}
[0m19:27:56.751322 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m19:27:56.758486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f455bb72-fd43-4e17-a12b-83e0cf7bf013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6be610350>]}
[0m19:27:56.795358 [info ] [MainThread]: 
[0m19:27:56.837245 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:27:56.917535 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m19:27:56.970550 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m19:27:56.971684 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m19:27:56.973011 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:27:57.595636 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.623 seconds
[0m19:27:57.602043 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m19:27:57.715971 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS)
[0m19:27:57.739654 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m19:27:57.741272 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m19:27:57.742438 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:27:58.213623 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.471 seconds
[0m19:27:58.220201 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m19:27:58.348284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f455bb72-fd43-4e17-a12b-83e0cf7bf013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6bf28b470>]}
[0m19:27:58.350022 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m19:27:58.351207 [info ] [MainThread]: 
[0m19:27:58.386205 [debug] [Thread-1 (]: Began running node model.stock_analytics.stg_market_data
[0m19:27:58.388539 [info ] [Thread-1 (]: 1 of 4 START sql view model ANALYTICS.stg_market_data .......................... [RUN]
[0m19:27:58.390348 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now model.stock_analytics.stg_market_data)
[0m19:27:58.392214 [debug] [Thread-1 (]: Began compiling node model.stock_analytics.stg_market_data
[0m19:27:58.419081 [debug] [Thread-1 (]: Writing injected SQL for node "model.stock_analytics.stg_market_data"
[0m19:27:58.426057 [debug] [Thread-1 (]: Began executing node model.stock_analytics.stg_market_data
[0m19:27:58.508765 [debug] [Thread-1 (]: Writing runtime sql for node "model.stock_analytics.stg_market_data"
[0m19:27:58.516514 [debug] [Thread-1 (]: Using snowflake connection "model.stock_analytics.stg_market_data"
[0m19:27:58.518175 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.stg_market_data"} */
create or replace   view USER_DB_HEDGEHOG.ANALYTICS.stg_market_data
  
   as (
    -- Staging view over RAW.MARKET_DATA
-- Keep it simple to avoid casting issues: RAW table already has proper types.

with src as (
  select * from USER_DB_HEDGEHOG.RAW.market_data
)

select
  date::date        as date,
  upper(symbol)     as symbol,
  open              as open,
  high              as high,
  low               as low,
  close             as close,
  volume            as volume
from src
  );
[0m19:27:58.519879 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:27:59.105824 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.586 seconds
[0m19:27:59.162437 [debug] [Thread-1 (]: On model.stock_analytics.stg_market_data: Close
[0m19:27:59.291025 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f455bb72-fd43-4e17-a12b-83e0cf7bf013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6d6c1bd10>]}
[0m19:27:59.293101 [info ] [Thread-1 (]: 1 of 4 OK created sql view model ANALYTICS.stg_market_data ..................... [[32mSUCCESS 1[0m in 0.90s]
[0m19:27:59.296053 [debug] [Thread-1 (]: Finished running node model.stock_analytics.stg_market_data
[0m19:27:59.300464 [debug] [Thread-3 (]: Began running node model.stock_analytics.dim_calendar
[0m19:27:59.303330 [debug] [Thread-4 (]: Began running node model.stock_analytics.fact_prices
[0m19:27:59.304629 [debug] [Thread-2 (]: Began running node model.stock_analytics.indicators_ma_rsi
[0m19:27:59.305865 [info ] [Thread-3 (]: 2 of 4 START sql table model ANALYTICS.dim_calendar ............................ [RUN]
[0m19:27:59.308214 [info ] [Thread-4 (]: 3 of 4 START sql table model ANALYTICS.fact_prices ............................. [RUN]
[0m19:27:59.310640 [info ] [Thread-2 (]: 4 of 4 START sql table model ANALYTICS.indicators_ma_rsi ....................... [RUN]
[0m19:27:59.314816 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.stock_analytics.dim_calendar'
[0m19:27:59.322868 [debug] [Thread-3 (]: Began compiling node model.stock_analytics.dim_calendar
[0m19:27:59.320183 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.stock_analytics.indicators_ma_rsi'
[0m19:27:59.318251 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.stock_analytics.fact_prices'
[0m19:27:59.340957 [debug] [Thread-2 (]: Began compiling node model.stock_analytics.indicators_ma_rsi
[0m19:27:59.343703 [debug] [Thread-3 (]: Writing injected SQL for node "model.stock_analytics.dim_calendar"
[0m19:27:59.345151 [debug] [Thread-4 (]: Began compiling node model.stock_analytics.fact_prices
[0m19:27:59.354340 [debug] [Thread-2 (]: Writing injected SQL for node "model.stock_analytics.indicators_ma_rsi"
[0m19:27:59.361347 [debug] [Thread-4 (]: Writing injected SQL for node "model.stock_analytics.fact_prices"
[0m19:27:59.366984 [debug] [Thread-3 (]: Began executing node model.stock_analytics.dim_calendar
[0m19:27:59.389738 [debug] [Thread-2 (]: Began executing node model.stock_analytics.indicators_ma_rsi
[0m19:27:59.402115 [debug] [Thread-4 (]: Began executing node model.stock_analytics.fact_prices
[0m19:27:59.463398 [debug] [Thread-3 (]: Writing runtime sql for node "model.stock_analytics.dim_calendar"
[0m19:27:59.488013 [debug] [Thread-4 (]: Writing runtime sql for node "model.stock_analytics.fact_prices"
[0m19:27:59.486326 [debug] [Thread-2 (]: Writing runtime sql for node "model.stock_analytics.indicators_ma_rsi"
[0m19:27:59.492555 [debug] [Thread-3 (]: Using snowflake connection "model.stock_analytics.dim_calendar"
[0m19:27:59.494157 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.dim_calendar"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS.dim_calendar
         as
        (-- Simple calendar table covering ~2 years from the min date in staging data.

with bounds as (
  select
    min(date) as min_date
  from USER_DB_HEDGEHOG.ANALYTICS.stg_market_data
),
base as (
  select
    dateadd(day, seq4(), min_date) as date
  from bounds,
       table(generator(rowcount => 730)) -- 2 years
)

select
  date,
  year(date)              as year,
  month(date)             as month,
  day(date)               as day_of_month,
  dayname(date)           as day_name,
  week(date)              as week_of_year,
  to_char(date, 'YYYY-MM-DD') as date_key
from base
        );
[0m19:27:59.499107 [debug] [Thread-2 (]: Using snowflake connection "model.stock_analytics.indicators_ma_rsi"
[0m19:27:59.500423 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m19:27:59.502760 [debug] [Thread-4 (]: Using snowflake connection "model.stock_analytics.fact_prices"
[0m19:27:59.505265 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.indicators_ma_rsi"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS.indicators_ma_rsi
         as
        (-- Indicators: Moving Averages and RSI (14-day)
--
-- This is used for the BI dashboard (Lab 2 requirement).

with src as (
  select * from USER_DB_HEDGEHOG.ANALYTICS.stg_market_data
),
ma as (
  select
    date,
    symbol,
    close,
    avg(close) over (
      partition by symbol
      order by date
      rows between 6 preceding and current row
    ) as ma_7,
    avg(close) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as ma_14,
    avg(close) over (
      partition by symbol
      order by date
      rows between 29 preceding and current row
    ) as ma_30,
    lag(close) over (
      partition by symbol
      order by date
    ) as prev_close
  from src
),
gains_losses as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    iff(prev_close is null, null, greatest(close - prev_close, 0)) as gain,
    iff(prev_close is null, null, greatest(prev_close - close, 0)) as loss
  from ma
),
rsi_window as (
  select
    date,
    symbol,
    close,
    ma_7,
    ma_14,
    ma_30,
    avg(gain) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_gain_14,
    avg(loss) over (
      partition by symbol
      order by date
      rows between 13 preceding and current row
    ) as avg_loss_14
  from gains_losses
)

select
  date,
  symbol,
  close,
  ma_7,
  ma_14,
  ma_30,
  case
    when avg_loss_14 is null or avg_loss_14 = 0 then null
    else 100 - (100 / (1 + (avg_gain_14 / avg_loss_14)))
  end as rsi_14
from rsi_window
        );
[0m19:27:59.510828 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "model.stock_analytics.fact_prices"} */
create or replace transient table USER_DB_HEDGEHOG.ANALYTICS.fact_prices
         as
        (-- Fact table: daily prices per symbol.

select
  m.date,
  m.symbol,
  m.open,
  m.high,
  m.low,
  m.close,
  m.volume
from USER_DB_HEDGEHOG.ANALYTICS.stg_market_data m
        );
[0m19:27:59.513657 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m19:27:59.517139 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:28:01.488005 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.987 seconds
[0m19:28:01.492439 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.976 seconds
[0m19:28:01.498172 [debug] [Thread-3 (]: On model.stock_analytics.dim_calendar: Close
[0m19:28:01.503144 [debug] [Thread-4 (]: On model.stock_analytics.fact_prices: Close
[0m19:28:01.608575 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.095 seconds
[0m19:28:01.615899 [debug] [Thread-2 (]: On model.stock_analytics.indicators_ma_rsi: Close
[0m19:28:01.620736 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f455bb72-fd43-4e17-a12b-83e0cf7bf013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6bd939190>]}
[0m19:28:01.626978 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f455bb72-fd43-4e17-a12b-83e0cf7bf013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6bd8e77a0>]}
[0m19:28:01.630498 [info ] [Thread-4 (]: 3 of 4 OK created sql table model ANALYTICS.fact_prices ........................ [[32mSUCCESS 1[0m in 2.30s]
[0m19:28:01.633532 [info ] [Thread-3 (]: 2 of 4 OK created sql table model ANALYTICS.dim_calendar ....................... [[32mSUCCESS 1[0m in 2.31s]
[0m19:28:01.636605 [debug] [Thread-4 (]: Finished running node model.stock_analytics.fact_prices
[0m19:28:01.640402 [debug] [Thread-3 (]: Finished running node model.stock_analytics.dim_calendar
[0m19:28:01.755560 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f455bb72-fd43-4e17-a12b-83e0cf7bf013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6bd893230>]}
[0m19:28:01.757726 [info ] [Thread-2 (]: 4 of 4 OK created sql table model ANALYTICS.indicators_ma_rsi .................. [[32mSUCCESS 1[0m in 2.44s]
[0m19:28:01.760805 [debug] [Thread-2 (]: Finished running node model.stock_analytics.indicators_ma_rsi
[0m19:28:01.771714 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:28:01.773145 [debug] [MainThread]: Connection 'model.stock_analytics.stg_market_data' was properly closed.
[0m19:28:01.774196 [debug] [MainThread]: Connection 'model.stock_analytics.dim_calendar' was properly closed.
[0m19:28:01.775633 [debug] [MainThread]: Connection 'model.stock_analytics.fact_prices' was properly closed.
[0m19:28:01.776688 [debug] [MainThread]: Connection 'model.stock_analytics.indicators_ma_rsi' was properly closed.
[0m19:28:01.778077 [info ] [MainThread]: 
[0m19:28:01.789998 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 4.95 seconds (4.95s).
[0m19:28:01.793693 [debug] [MainThread]: Command end result
[0m19:28:01.906462 [info ] [MainThread]: 
[0m19:28:01.909679 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:28:01.911990 [info ] [MainThread]: 
[0m19:28:01.914630 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m19:28:01.921144 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.056971, "process_user_time": 10.176798, "process_kernel_time": 2.107993, "process_mem_max_rss": "220228", "process_in_blocks": "1512", "process_out_blocks": "1938"}
[0m19:28:01.924144 [debug] [MainThread]: Command `dbt run` succeeded at 19:28:01.923778 after 10.06 seconds
[0m19:28:01.937455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6d6aab530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6d66c4b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc6bd93ebd0>]}
[0m19:28:01.940376 [debug] [MainThread]: Flushing usage events
[0m19:29:14.948470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9db92edfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9db9dc8200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9db9309e50>]}


============================== 19:29:14.968787 | 567aecc3-253f-4881-b1da-e1a097c3dc11 ==============================
[0m19:29:14.968787 [info ] [MainThread]: Running with dbt=1.8.8
[0m19:29:14.971702 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt snapshot --target prod --profiles-dir /opt/airflow/dbt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:29:17.710538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '567aecc3-253f-4881-b1da-e1a097c3dc11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da6eedd60>]}
[0m19:29:17.849964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '567aecc3-253f-4881-b1da-e1a097c3dc11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da5444830>]}
[0m19:29:17.852956 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:29:17.934608 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m19:29:18.432967 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:29:18.434199 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:29:18.602920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '567aecc3-253f-4881-b1da-e1a097c3dc11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da512be30>]}
[0m19:29:19.157236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '567aecc3-253f-4881-b1da-e1a097c3dc11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da4efda30>]}
[0m19:29:19.159101 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m19:29:19.161445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '567aecc3-253f-4881-b1da-e1a097c3dc11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da77d48c0>]}
[0m19:29:19.176742 [info ] [MainThread]: 
[0m19:29:19.199946 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:29:19.210213 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG'
[0m19:29:19.325224 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG"
[0m19:29:19.328811 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG"} */
show terse schemas in database USER_DB_HEDGEHOG
    limit 10000
[0m19:29:19.330187 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:29:19.905294 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.575 seconds
[0m19:29:19.909939 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG: Close
[0m19:29:20.080685 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG, now list_USER_DB_HEDGEHOG_ANALYTICS)
[0m19:29:20.108574 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m19:29:20.109996 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m19:29:20.110993 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:29:20.628335 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.517 seconds
[0m19:29:20.635078 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m19:29:20.789367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '567aecc3-253f-4881-b1da-e1a097c3dc11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da4deec60>]}
[0m19:29:20.791618 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m19:29:20.793295 [info ] [MainThread]: 
[0m19:29:20.822801 [debug] [Thread-1 (]: Began running node snapshot.stock_analytics.snap_market_data
[0m19:29:20.824526 [info ] [Thread-1 (]: 1 of 1 START snapshot ANALYTICS.snap_market_data ............................... [RUN]
[0m19:29:20.826465 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now snapshot.stock_analytics.snap_market_data)
[0m19:29:20.827868 [debug] [Thread-1 (]: Began compiling node snapshot.stock_analytics.snap_market_data
[0m19:29:20.856430 [debug] [Thread-1 (]: Began executing node snapshot.stock_analytics.snap_market_data
[0m19:29:21.084893 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:21.122306 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        select close, volume from (
                



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data

            ) subq
    ) as __dbt_sbq
    where false
    limit 0
[0m19:29:21.124313 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:29:21.652423 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.528 seconds
[0m19:29:21.685421 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:21.689401 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m19:29:21.793099 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.099 seconds
[0m19:29:21.822418 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:21.825204 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m19:29:21.936934 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.109 seconds
[0m19:29:22.034475 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:22.036691 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
create or replace temporary table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
         as
        (

    with snapshot_query as (

        



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data


    ),

    snapshotted_data as (

        select *,
            snapshot_key as dbt_unique_key

        from "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(snapshot_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

        );
[0m19:29:23.298064 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.258 seconds
[0m19:29:23.310259 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:23.312315 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m19:29:23.404702 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.091 seconds
[0m19:29:23.418487 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:23.420131 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m19:29:23.532703 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.111 seconds
[0m19:29:23.547816 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:23.550197 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m19:29:23.696433 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.144 seconds
[0m19:29:23.705532 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:23.706970 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
[0m19:29:23.792626 [debug] [Thread-1 (]: SQL status: SUCCESS 10 in 0.084 seconds
[0m19:29:23.811252 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:23.813460 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
describe table "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp"
[0m19:29:23.910606 [debug] [Thread-1 (]: SQL status: SUCCESS 12 in 0.096 seconds
[0m19:29:23.954431 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:23.956678 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
/* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        

    with snapshot_query as (

        



select
  concat(to_char(date, 'YYYY-MM-DD'), '::', symbol) as snapshot_key,
  date,
  symbol,
  close,
  volume,
  current_timestamp() as updated_at
from USER_DB_HEDGEHOG.RAW.market_data


    ),

    snapshotted_data as (

        select *,
            snapshot_key as dbt_unique_key

        from "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA"
        where dbt_valid_to is null

    ),

    insertions_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            nullif(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())), to_timestamp_ntz(convert_timezone('UTC', current_timestamp()))) as dbt_valid_to,
            md5(coalesce(cast(snapshot_key as varchar ), '')
         || '|' || coalesce(cast(to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select
            *,
            snapshot_key as dbt_unique_key,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to

        from snapshot_query
    ),

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where snapshotted_data.dbt_unique_key is null
           or (
                snapshotted_data.dbt_unique_key is not null
            and (
                (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
            )
        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data on snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
        where (
            (snapshotted_data."CLOSE" != source_data."CLOSE"
        or
        (
            ((snapshotted_data."CLOSE" is null) and not (source_data."CLOSE" is null))
            or
            ((not snapshotted_data."CLOSE" is null) and (source_data."CLOSE" is null))
        ) or snapshotted_data."VOLUME" != source_data."VOLUME"
        or
        (
            ((snapshotted_data."VOLUME" is null) and not (source_data."VOLUME" is null))
            or
            ((not snapshotted_data."VOLUME" is null) and (source_data."VOLUME" is null))
        ))
        )
    )

    select * from insertions
    union all
    select * from updates

    ) as __dbt_sbq
    where false
    limit 0
[0m19:29:24.635835 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.676 seconds
[0m19:29:24.675414 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:24.677508 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
/* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
select * from (
        select to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_snapshot_time
    ) as __dbt_sbq
    where false
    limit 0
[0m19:29:24.777597 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.098 seconds
[0m19:29:24.779432 [debug] [Thread-1 (]: Writing runtime sql for node "snapshot.stock_analytics.snap_market_data"
[0m19:29:24.789249 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:24.791270 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
BEGIN
[0m19:29:24.958190 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.165 seconds
[0m19:29:24.961127 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:24.962877 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
merge into "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA" as DBT_INTERNAL_DEST
    using "USER_DB_HEDGEHOG"."ANALYTICS"."SNAP_MARKET_DATA__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type in ('update', 'delete')
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("SNAPSHOT_KEY", "DATE", "SYMBOL", "CLOSE", "VOLUME", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("SNAPSHOT_KEY", "DATE", "SYMBOL", "CLOSE", "VOLUME", "UPDATED_AT", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")

;
[0m19:29:25.482717 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.517 seconds
[0m19:29:25.485225 [debug] [Thread-1 (]: Using snowflake connection "snapshot.stock_analytics.snap_market_data"
[0m19:29:25.487354 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "snapshot.stock_analytics.snap_market_data"} */
COMMIT
[0m19:29:25.825687 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.336 seconds
[0m19:29:25.902098 [debug] [Thread-1 (]: On snapshot.stock_analytics.snap_market_data: Close
[0m19:29:26.067077 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '567aecc3-253f-4881-b1da-e1a097c3dc11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da52e0170>]}
[0m19:29:26.069555 [info ] [Thread-1 (]: 1 of 1 OK snapshotted ANALYTICS.snap_market_data ............................... [[32mSUCCESS 0[0m in 5.24s]
[0m19:29:26.073508 [debug] [Thread-1 (]: Finished running node snapshot.stock_analytics.snap_market_data
[0m19:29:26.080353 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:29:26.083296 [debug] [MainThread]: Connection 'snapshot.stock_analytics.snap_market_data' was properly closed.
[0m19:29:26.085227 [info ] [MainThread]: 
[0m19:29:26.088266 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 6.91 seconds (6.91s).
[0m19:29:26.093759 [debug] [MainThread]: Command end result
[0m19:29:26.253633 [info ] [MainThread]: 
[0m19:29:26.255792 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:29:26.257466 [info ] [MainThread]: 
[0m19:29:26.264825 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:29:26.279918 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 11.473011, "process_user_time": 10.240591, "process_kernel_time": 0.960655, "process_mem_max_rss": "217600", "process_out_blocks": "1925", "process_in_blocks": "0"}
[0m19:29:26.287002 [debug] [MainThread]: Command `dbt snapshot` succeeded at 19:29:26.286595 after 11.48 seconds
[0m19:29:26.289844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9db99b0680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da6eecad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da5656600>]}
[0m19:29:26.292484 [debug] [MainThread]: Flushing usage events
[0m19:29:32.513501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f184ba13320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1849261af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f184961b350>]}


============================== 19:29:32.527663 | 5a8d432a-c0e9-48ae-8f9a-0d47ca256ee3 ==============================
[0m19:29:32.527663 [info ] [MainThread]: Running with dbt=1.8.8
[0m19:29:32.529493 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/stock_analytics/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt test --target prod --profiles-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:29:35.028554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5a8d432a-c0e9-48ae-8f9a-0d47ca256ee3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f184a42b5f0>]}
[0m19:29:35.211582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5a8d432a-c0e9-48ae-8f9a-0d47ca256ee3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f18377eb5f0>]}
[0m19:29:35.213539 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m19:29:35.294045 [debug] [MainThread]: checksum: dbfb813e9dbf08a0f983a8b86150e9e8be8f6dbbfbc1375a143fdaccdd421855, vars: {}, profile: , target: prod, version: 1.8.8
[0m19:29:36.189058 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:29:36.191008 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:29:36.400305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5a8d432a-c0e9-48ae-8f9a-0d47ca256ee3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f18487d5d30>]}
[0m19:29:36.834068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5a8d432a-c0e9-48ae-8f9a-0d47ca256ee3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1834d127e0>]}
[0m19:29:36.835348 [info ] [MainThread]: Found 4 models, 1 snapshot, 7 data tests, 1 source, 454 macros
[0m19:29:36.837094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5a8d432a-c0e9-48ae-8f9a-0d47ca256ee3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1835d61d00>]}
[0m19:29:36.848101 [info ] [MainThread]: 
[0m19:29:36.853893 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:29:36.876852 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_USER_DB_HEDGEHOG_ANALYTICS'
[0m19:29:36.941362 [debug] [ThreadPool]: Using snowflake connection "list_USER_DB_HEDGEHOG_ANALYTICS"
[0m19:29:36.942824 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "connection_name": "list_USER_DB_HEDGEHOG_ANALYTICS"} */
show objects in USER_DB_HEDGEHOG.ANALYTICS limit 10000
[0m19:29:36.944459 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:29:37.423174 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.479 seconds
[0m19:29:37.428953 [debug] [ThreadPool]: On list_USER_DB_HEDGEHOG_ANALYTICS: Close
[0m19:29:37.586292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5a8d432a-c0e9-48ae-8f9a-0d47ca256ee3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1834f8cbc0>]}
[0m19:29:37.588058 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m19:29:37.589506 [info ] [MainThread]: 
[0m19:29:37.623840 [debug] [Thread-1 (]: Began running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m19:29:37.624911 [debug] [Thread-2 (]: Began running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m19:29:37.625873 [debug] [Thread-3 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m19:29:37.627198 [debug] [Thread-4 (]: Began running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m19:29:37.628336 [info ] [Thread-1 (]: 1 of 7 START test not_null_fact_prices_date .................................... [RUN]
[0m19:29:37.631384 [info ] [Thread-2 (]: 2 of 7 START test not_null_fact_prices_symbol .................................. [RUN]
[0m19:29:37.636008 [info ] [Thread-3 (]: 3 of 7 START test not_null_indicators_ma_rsi_date .............................. [RUN]
[0m19:29:37.639466 [info ] [Thread-4 (]: 4 of 7 START test not_null_indicators_ma_rsi_symbol ............................ [RUN]
[0m19:29:37.641711 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_USER_DB_HEDGEHOG_ANALYTICS, now test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5)
[0m19:29:37.650575 [debug] [Thread-1 (]: Began compiling node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m19:29:37.646699 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207'
[0m19:29:37.649165 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94'
[0m19:29:37.644865 [debug] [Thread-2 (]: Acquiring new snowflake connection 'test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1'
[0m19:29:37.667559 [debug] [Thread-3 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m19:29:37.694339 [debug] [Thread-4 (]: Began compiling node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m19:29:37.698966 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m19:29:37.700499 [debug] [Thread-2 (]: Began compiling node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m19:29:37.711406 [debug] [Thread-3 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m19:29:37.719691 [debug] [Thread-4 (]: Writing injected SQL for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m19:29:37.729152 [debug] [Thread-2 (]: Writing injected SQL for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m19:29:37.734189 [debug] [Thread-3 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m19:29:37.736016 [debug] [Thread-1 (]: Began executing node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m19:29:37.744677 [debug] [Thread-4 (]: Began executing node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m19:29:37.746914 [debug] [Thread-2 (]: Began executing node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m19:29:37.835724 [debug] [Thread-4 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m19:29:37.839364 [debug] [Thread-3 (]: Writing runtime sql for node "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m19:29:37.841464 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m19:29:37.847079 [debug] [Thread-2 (]: Writing runtime sql for node "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m19:29:37.853595 [debug] [Thread-4 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"
[0m19:29:37.855458 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS.indicators_ma_rsi
where symbol is null



      
    ) dbt_internal_test
[0m19:29:37.857211 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:29:37.859224 [debug] [Thread-3 (]: Using snowflake connection "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"
[0m19:29:37.860819 [debug] [Thread-1 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"
[0m19:29:37.863379 [debug] [Thread-2 (]: Using snowflake connection "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"
[0m19:29:37.867436 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS.indicators_ma_rsi
where date is null



      
    ) dbt_internal_test
[0m19:29:37.870739 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS.fact_prices
where date is null



      
    ) dbt_internal_test
[0m19:29:37.873713 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS.fact_prices
where symbol is null



      
    ) dbt_internal_test
[0m19:29:37.876217 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m19:29:37.878274 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:29:37.880444 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m19:29:38.554839 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.675 seconds
[0m19:29:38.578190 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.702 seconds
[0m19:29:38.593144 [debug] [Thread-2 (]: On test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1: Close
[0m19:29:38.591015 [debug] [Thread-3 (]: On test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207: Close
[0m19:29:38.608662 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.731 seconds
[0m19:29:38.614465 [debug] [Thread-1 (]: On test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5: Close
[0m19:29:38.757150 [info ] [Thread-1 (]: 1 of 7 PASS not_null_fact_prices_date .......................................... [[32mPASS[0m in 1.11s]
[0m19:29:38.770716 [debug] [Thread-1 (]: Finished running node test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5
[0m19:29:38.768718 [info ] [Thread-3 (]: 3 of 7 PASS not_null_indicators_ma_rsi_date .................................... [[32mPASS[0m in 1.12s]
[0m19:29:38.780121 [info ] [Thread-2 (]: 2 of 7 PASS not_null_fact_prices_symbol ........................................ [[32mPASS[0m in 1.14s]
[0m19:29:38.828186 [debug] [Thread-2 (]: Finished running node test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1
[0m19:29:38.794298 [debug] [Thread-3 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207
[0m19:29:38.784096 [debug] [Thread-1 (]: Began running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m19:29:38.915273 [info ] [Thread-1 (]: 5 of 7 START test not_null_snap_market_data_snapshot_key ....................... [RUN]
[0m19:29:38.922099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_fact_prices_date.f48f5b2cf5, now test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0)
[0m19:29:38.844131 [debug] [Thread-2 (]: Began running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m19:29:38.951399 [info ] [Thread-2 (]: 6 of 7 START test not_null_stg_market_data_date ................................ [RUN]
[0m19:29:38.969627 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_fact_prices_symbol.85cfd5aed1, now test.stock_analytics.not_null_stg_market_data_date.fb73c94489)
[0m19:29:38.941984 [debug] [Thread-1 (]: Began compiling node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m19:29:38.863189 [debug] [Thread-3 (]: Began running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m19:29:38.973340 [debug] [Thread-2 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m19:29:38.976860 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.099 seconds
[0m19:29:39.002107 [info ] [Thread-3 (]: 7 of 7 START test not_null_stg_market_data_symbol .............................. [RUN]
[0m19:29:39.029685 [debug] [Thread-1 (]: Writing injected SQL for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m19:29:39.073285 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.stock_analytics.not_null_indicators_ma_rsi_date.5bbb6b2207, now test.stock_analytics.not_null_stg_market_data_symbol.478198cf66)
[0m19:29:39.062385 [debug] [Thread-4 (]: On test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94: Close
[0m19:29:39.077270 [debug] [Thread-2 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m19:29:39.082674 [debug] [Thread-3 (]: Began compiling node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m19:29:39.103087 [debug] [Thread-1 (]: Began executing node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m19:29:39.154184 [debug] [Thread-1 (]: Writing runtime sql for node "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m19:29:39.157478 [debug] [Thread-3 (]: Writing injected SQL for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m19:29:39.165529 [debug] [Thread-2 (]: Began executing node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m19:29:39.212673 [debug] [Thread-2 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m19:29:39.222320 [debug] [Thread-1 (]: Using snowflake connection "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"
[0m19:29:39.274438 [debug] [Thread-1 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select snapshot_key
from USER_DB_HEDGEHOG.ANALYTICS.snap_market_data
where snapshot_key is null



      
    ) dbt_internal_test
[0m19:29:39.259192 [debug] [Thread-3 (]: Began executing node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m19:29:39.284780 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:29:39.324091 [info ] [Thread-4 (]: 4 of 7 PASS not_null_indicators_ma_rsi_symbol .................................. [[32mPASS[0m in 1.67s]
[0m19:29:39.320447 [debug] [Thread-3 (]: Writing runtime sql for node "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m19:29:39.292283 [debug] [Thread-2 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"
[0m19:29:39.341965 [debug] [Thread-4 (]: Finished running node test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94
[0m19:29:39.399261 [debug] [Thread-2 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_date.fb73c94489"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from USER_DB_HEDGEHOG.ANALYTICS.stg_market_data
where date is null



      
    ) dbt_internal_test
[0m19:29:39.406328 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:29:39.413470 [debug] [Thread-3 (]: Using snowflake connection "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"
[0m19:29:39.433877 [debug] [Thread-3 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "stock_analytics", "target_name": "prod", "node_id": "test.stock_analytics.not_null_stg_market_data_symbol.478198cf66"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from USER_DB_HEDGEHOG.ANALYTICS.stg_market_data
where symbol is null



      
    ) dbt_internal_test
[0m19:29:39.452861 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:29:39.940275 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.655 seconds
[0m19:29:39.948303 [debug] [Thread-1 (]: On test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0: Close
[0m19:29:40.060603 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.608 seconds
[0m19:29:40.067516 [debug] [Thread-3 (]: On test.stock_analytics.not_null_stg_market_data_symbol.478198cf66: Close
[0m19:29:40.078063 [info ] [Thread-1 (]: 5 of 7 PASS not_null_snap_market_data_snapshot_key ............................. [[32mPASS[0m in 1.16s]
[0m19:29:40.082132 [debug] [Thread-1 (]: Finished running node test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0
[0m19:29:40.216184 [info ] [Thread-3 (]: 7 of 7 PASS not_null_stg_market_data_symbol .................................... [[32mPASS[0m in 1.14s]
[0m19:29:40.220817 [debug] [Thread-3 (]: Finished running node test.stock_analytics.not_null_stg_market_data_symbol.478198cf66
[0m19:29:40.241668 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.836 seconds
[0m19:29:40.247251 [debug] [Thread-2 (]: On test.stock_analytics.not_null_stg_market_data_date.fb73c94489: Close
[0m19:29:40.380320 [info ] [Thread-2 (]: 6 of 7 PASS not_null_stg_market_data_date ...................................... [[32mPASS[0m in 1.41s]
[0m19:29:40.383506 [debug] [Thread-2 (]: Finished running node test.stock_analytics.not_null_stg_market_data_date.fb73c94489
[0m19:29:40.406166 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:29:40.407884 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_snap_market_data_snapshot_key.4f02477ed0' was properly closed.
[0m19:29:40.409439 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_date.fb73c94489' was properly closed.
[0m19:29:40.411844 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_stg_market_data_symbol.478198cf66' was properly closed.
[0m19:29:40.413582 [debug] [MainThread]: Connection 'test.stock_analytics.not_null_indicators_ma_rsi_symbol.fcd5532f94' was properly closed.
[0m19:29:40.415159 [info ] [MainThread]: 
[0m19:29:40.418671 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 3.56 seconds (3.56s).
[0m19:29:40.430669 [debug] [MainThread]: Command end result
[0m19:29:40.578091 [info ] [MainThread]: 
[0m19:29:40.579767 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:29:40.582059 [info ] [MainThread]: 
[0m19:29:40.583461 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m19:29:40.589338 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 8.28666, "process_user_time": 10.551845, "process_kernel_time": 1.128507, "process_mem_max_rss": "221832", "process_out_blocks": "1939", "process_in_blocks": "0"}
[0m19:29:40.600456 [debug] [MainThread]: Command `dbt test` succeeded at 19:29:40.596452 after 8.29 seconds
[0m19:29:40.604022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f18496df020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f184a4f0e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f18487262a0>]}
[0m19:29:40.606230 [debug] [MainThread]: Flushing usage events
